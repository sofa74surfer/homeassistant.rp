platform: template
sensors:

# ####### ####################### #######
# ####### Wattage Sensoren H채user #######
# ####### ####################### #######

# Die H채user verbrauchen
# - Den Strom, der von UMG604 bezogen wird
# - Den Strom, der auf dem Dach produziert wird
# - abz체glich dem Strom, der von der Heizung verbraucht wird
# - abz체glich dem Strom, der von Shelly eMobility verbraucht wird
# Annahme: UMG604 zeigt einen negativen Wert, wenn wir mehr 
#          produzieren, als wir verbrauchen.

  hauser_power:
    friendly_name: "Hauser W"
    value_template: "{{ (
      (0 if states('sensor.janitza_umg604_power') == ('unknown' or 'unavailable') else states('sensor.janitza_umg604_power')|float) +
      (0 if states('sensor.solar_power') == ('unknown' or 'unavailable') else states('sensor.solar_power')|float) -
      (0 if states('sensor.heatpump_power') == ('unknown' or 'unavailable') else states('sensor.heatpump_power')|float) -
      (0 if states('sensor.shelly_emobility_power') == ('unknown' or 'unavailable') else states('sensor.shelly_emobility_power')|float) -
      (0 if states('sensor.mystrom_power') == ('unknown' or 'unavailable') else states('sensor.mystrom_power')|float) 
    )|round(0) }}"
    device_class: power
    unit_of_measurement: "W"
    attribute_templates:
      last_updated:  "{{ now() }}"
    unique_id: template.sensor_hauser_power

# {{ (
#       ( states('sensor.janitza_umg604_power') if states('sensor.janitza_umg604_state')|safe == ('unknown' or 'unavailable') else state_attr('sensor.janitza_umg604_state', '_P_SUM3')|first|float)
#       + ((
#       ( states('sensor.solar_power_19') if states('sensor.solarlog_19_power_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_19_power_ac')|float) +
#       ( states('sensor.solar_power_21') if states('sensor.solarlog_21_power_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_21_power_ac')|float) +
#       ( states('sensor.solar_power_23') if states('sensor.solarlog_23_power_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_23_power_ac')|float) +
#       ( states('sensor.solar_power_25') if states('sensor.solarlog_25_power_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_25_power_ac')|float) 
#       ))
#       - ((
#       ( states('sensor.solar_consumption_19') if states('sensor.solarlog_19_consumption_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_19_consumption_ac')|float) +
#       ( states('sensor.solar_consumption_21') if states('sensor.solarlog_21_consumption_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_21_consumption_ac')|float) +
#       ( states('sensor.solar_consumption_23') if states('sensor.solarlog_23_consumption_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_23_consumption_ac')|float) +
#       ( states('sensor.solar_consumption_25') if states('sensor.solarlog_25_consumption_ac')|safe == ('unknown' or 'unavailable') else states('sensor.solarlog_25_consumption_ac')|float) 
#       ))
#       - ((
#       ( 0 if states('sensor.zaptec_charger_zpr055424')|safe == ('unknown' or 'unavailable') else state_attr('sensor.zaptec_charger_zpr055424', 'total_charge_power')|float) +
#       ( 0 if states('sensor.zaptec_charger_zpr111423')|safe == ('unknown' or 'unavailable') else state_attr('sensor.zaptec_charger_zpr111423', 'total_charge_power')|float) +
#       ( 0 if states('sensor.zaptec_charger_zpr118007')|safe == ('unknown' or 'unavailable') else state_attr('sensor.zaptec_charger_zpr118007', 'total_charge_power')|float) +
#       ( 0 if states('sensor.zaptec_charger_zpr124763')|safe == ('unknown' or 'unavailable') else state_attr('sensor.zaptec_charger_zpr124763', 'total_charge_power')|float) +
#       ( 0 if states('sensor.zaptec_charger_zpr211132')|safe == ('unknown' or 'unavailable') else state_attr('sensor.zaptec_charger_zpr211132', 'total_charge_power')|float) 
#       ))
#       - ((
#       ((state_attr('sensor.mystrom_201_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_201_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_201_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_202_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_202_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_202_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_203_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_203_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_203_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_204_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_204_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_204_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_205_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_205_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_205_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_206_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_206_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_206_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_207_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_207_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_207_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_208_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_208_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_208_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_209_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_209_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_209_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_210_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_210_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_210_report', 'Ws')|replace('None', 0))|float) +
#       ((state_attr('sensor.mystrom_211_report', 'power')|replace('None', 0) if state_attr('sensor.mystrom_211_report', 'Ws')|safe == 'None' else state_attr('sensor.mystrom_211_report', 'Ws')|replace('None', 0))|float)
#       )) 
#       )|round(0) }}