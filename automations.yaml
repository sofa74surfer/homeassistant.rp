- id: '1675436816500'
  alias: Monitoring Zaptec Charger Count
  description: Überprüft, ob die Anzahl Zaptec Charger gemäss Ubiquiti der Menge der
    Cloud entspricht.
  triggers:
  - entity_id:
    - sensor.zaptec_counter
    enabled: false
    trigger: state
  - entity_id:
    - sensor.zaptec_counter_cloud
    enabled: false
    trigger: state
  - at: 08:00:00
    trigger: time
  conditions:
  - condition: not
    conditions:
    - condition: template
      value_template: '{{ states(''sensor.zaptec_counter'')|int == states(''sensor.zaptec_counter_cloud'')|int
        }}'
  actions:
  - data:
      title: 'HA-Alert Einstellhalle: Anzahl installierte Zaptec Station hat geändert'
      message: 'Installiert waren {{states(''sensor.zaptec_counter'')|int}} Stationen
        , neu sind es {{states(''sensor.zaptec_counter_cloud'')|int}} Stationen. '
    action: notify.administrator_rotseepark
  - data:
      value: '{{states(''sensor.zaptec_counter_cloud'')|int}}'
    target:
      entity_id: input_number.anzahl_zaptec_stationen
    action: input_number.set_value
  mode: single
- id: '1675599834353'
  alias: Monitoring Heatpump 19
  description: ''
  triggers:
  - entity_id:
    - sensor.luxtronik_19_param_state
    attribute: parameters
    trigger: state
  - hours: /4
    trigger: time_pattern
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_19_value_state'', ''values'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Value Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik19_asd
          state: 'off'
          for:
            hours: 0
            minutes: 4
            seconds: 0
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik19_vd1
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
          - condition: state
            entity_id: binary_sensor.luxtronik19_vd2
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Sensor luxtronik19_asd meldet ein Problem'
          message: Der Status des Sensor luxtronik19_asd ist {{ states('binary_sensor.luxtronik19_asd')
            }}  , jedoch sollte er ON sein, wenn der 1. oder  2. Verdichter läuft
      alias: Prüfe den Status von luxtronik19_asd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_evu
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Sensor luxtronik19_evu meldet ein Problem'
          message: Der Status des Sensor luxtronik19_evu ist {{ states('binary_sensor.luxtronik19_evu')
            }} , jedoch sollte die Energie Versorger Freigabe immer ON sein
      alias: Prüfe den Status von luxtronik19_evu
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_mot
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Sensor luxtronik19_mot meldet ein Problem'
          message: Der Status des Sensor luxtronik19_mot ist {{ states('binary_sensor.luxtronik19_mot')
            }} , jedoch sollte der Motorschutz immer ON sein
      alias: Prüfe den Status von luxtronik19_mot
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_hd
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Sensor luxtronik19_hd meldet ein Problem'
          message: Der Status des Sensor luxtronik19_hd ist {{ states('binary_sensor.luxtronik19_hd')
            }} , jedoch sollte der Hochdruck immer OFF sein
      alias: Prüfe den Status von luxtronik19_hd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_nd
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Sensor luxtronik19_nd meldet ein Problem'
          message: Der Status des Sensor luxtronik19_nd ist {{ states('binary_sensor.luxtronik19_nd')
            }} , jedoch sollte der Niederdruck immer ON sein
      alias: Prüfe den Status von luxtronik19_nd
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: sensor.luxtronik19_trl_soll
          state: '15'
          for:
            hours: 72
            minutes: 0
            seconds: 0
          alias: Rücklauf Soll seit 3 Tagen auf 15°C
        - condition: template
          value_template: '{{ (now().month == 5 and now().day > 15) or now().month
            == 6 }}'
          alias: Es ist ab Mitte Mai oder Juni
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_19
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_19
        alias: Schalte Heizphase aus
        action: input_boolean.turn_off
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus'') }}'
        target:
          entity_id: input_select.luxtronik_19_hz_operation_mode
        action: input_select.set_options
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 19: Die Heizphase ist beendet'
          message: none
      alias: Heizphase ausschalten im Mai/Juni wenn 72h lang Heizgrenze überschritten
        (Rücklauf Soll = 15 °C)
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ states(''sensor.luxtronik19_ta_mittel'')|int <= states(''sensor.luxtronik19_heizgrenze'')|int
            }}'
          alias: Mitteltemperatur kleiner als Heizgrenze
        - condition: template
          value_template: '{{ now().month == 10 or now().month == 11 }}'
          alias: Es ist Oktober oder November
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_19
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_19
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 19: Die Heizphase hat begonnen'
          message: none
      alias: Heizphase einschalten im Oktober/November wenn TA Mittel < Heizgrenze
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_ta_mittel
          above: 22
        - condition: template
          value_template: '{{ now().month == 6 or now().month == 7 }}'
          alias: Es ist Juni oder Juli
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_19
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_19
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 19: Die Kühlphase hat begonnen'
          message: none
      alias: Kühlphase einschalten im Juni/Juli wenn TA Mittel über 22 °C
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_ta_mittel
          below: 16
        - condition: template
          value_template: '{{ now().month == 9 }}'
          alias: Es ist September
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_19
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_19
        action: input_boolean.turn_off
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 19: Die Kühlphase ist beendet'
          message: Es ist September und TA-Mittel ist unterhalb 16 °C
      alias: Kühlphase ausschalten im September wenn TA Mittel unter 16 °C
      enabled: false
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Parameter Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heating_temperature'']
          != 0.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heating_temperature hat geändert'
          message: Der neue Wert für heating_temperature ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heating_temperature']}}
      alias: Prüfe den Parameter heating_temperature
    - alias: Prüfe nur, wenn BPU nicht läuft
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_bup
        state: 'off'
      then:
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: "{{state_attr('sensor.luxtronik_19_param_state', 'parameters')['warmwater_temperature']
              \n!= states('input_number.luxtronik_19_ww_solltemperatur')|int \n    and
              (state_attr('automation.schalte_ww_setze_ww_solltemperatur_haus_19_bei_anderung','current')|int
              == 0) \n}}"
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 19: Der Wert warmwater_temperature hat geändert'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_19_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature (ändert während der TDI)
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''warmwater_temperature'']
              != states(''input_number.luxtronik_ww_normaltemperatur'')|int }}'
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_19
            state: 'off'
            enabled: true
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 19: Der Wert warmwater_temperature hat geändert
              (während TDI)'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_19_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature Normabweichung (nicht während
          der TDI)
      - if:
        - condition: template
          value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Automatik"  and  state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Party" }}'
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 19: Der Wert warmwater_operation_mode_string
              hat geändert (ausserhalb TDI)'
            message: Der neue Wert für warmwater_operation_mode_string ist {{state_attr('sensor.luxtronik_19_param_state',
              'parameters')['warmwater_operation_mode_string']}}
        alias: Prüfe den Parameter warmwater_operation_mode_string
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{(state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heating_operation_mode''])|int
            != states(''input_select.luxtronik_19_hz_operation_mode'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heating_operation_mode hat geändert'
          message: Der neue Wert für heating_operation_mode ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heating_operation_mode']}}
      alias: Prüfe den Parameter heating_operation_mode
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heating_curve_end_point'']
          != 30.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heating_curve_end_point hat geändert'
          message: Der neue Wert für heating_curve_end_point ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heating_curve_end_point']}}
      alias: Prüfe den Parameter heating_curve_end_point
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heating_curve_parallel_offset'']
          != 20.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heating_curve_parallel_offset hat
            geändert'
          message: Der neue Wert für heating_curve_parallel_offset ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heating_curve_parallel_offset']}}
      alias: Prüfe den Parameter heating_curve_parallel_offset
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''deltaHeatingReduction'']
          != -15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert deltaHeatingReduction hat geändert'
          message: Der neue Wert für deltaHeatingReduction ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['deltaHeatingReduction']}}
      alias: Prüfe den Parameter deltaHeatingReduction
    - if:
      - condition: template
        value_template: "{{ (state_attr('sensor.luxtronik_19_param_state', 'parameters')['hotWaterTemperatureHysteresis']
          \n    != states('input_number.luxtronik_19_ww_hysterese')|int) \n    and
          (state_attr('automation.schalte_ww_setze_ww_hysterese_haus_19_bei_anderung','current')|int
          == 0) \n}}\n"
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterTemperatureHysteresis hat
            geändert'
          message: Der neue Wert für hotWaterTemperatureHysteresis ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterTemperatureHysteresis']}}
      alias: Prüfe den Parameter hotWaterTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_normalhysterese'')|float  and state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_maximalhysterese'')|float}}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert returnTemperatureHysteresis hat geändert'
          message: Der neue Wert für returnTemperatureHysteresis ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['returnTemperatureHysteresis']}}
      alias: Prüfe den Parameter returnTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''temperature_hot_water_target'']
          < states(''input_number.luxtronik_ww_normaltemperatur'')|int or state_attr(''sensor.luxtronik_19_param_state'',
          ''parameters'')[''temperature_hot_water_target''] > states(''input_number.luxtronik_ww_maximaltemperatur'')|int
          or state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''temperature_hot_water_target'']
          != states(''input_number.luxtronik_19_ww_solltemperatur'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert temperature_hot_water_target hat
            geändert'
          message: Der neue Wert für temperature_hot_water_target ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['temperature_hot_water_target']}}
      alias: 'Prüfe den Parameter temperature_hot_water_target '
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''thresholdHeatingLimit'']
          != 16 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert thresholdHeatingLimit hat geändert
            (ausserhalb TDI)'
          message: Der neue Wert für thresholdHeatingLimit ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['thresholdHeatingLimit']}}
      alias: Prüfe den Parameter thresholdHeatingLimit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''returnTemperatureTargetMin'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert returnTemperatureTargetMin hat geändert'
          message: Der neue Wert für returnTemperatureTargetMin ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['returnTemperatureTargetMin']}}
      alias: Prüfe den Parameter returnTemperatureTargetMin
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''temperature_hot_water_limit'']
          != 60 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert temperature_hot_water_limit hat geändert'
          message: Der neue Wert für temperature_hot_water_limit ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['temperature_hot_water_limit']}}
      alias: Prüfe den Parameter temperature_hot_water_limit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_19_param_state', 'parameters')['heatingOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter heatingOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für heatingOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableWeek']}}
      alias: Prüfe den Parameter heatingOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;01:45&#39;}, {&#39;on&#39;:
          &#39;04:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;12:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''heatingOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert heatingOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['heatingOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySaturday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_19_param_state', 'parameters')['hotWaterOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;16:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für hotWaterOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableWeek']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;02:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 19: Der Wert hotWaterOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_19_param_state',
            'parameters')['hotWaterOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySaturday
  mode: single
- id: '1675601828993'
  alias: Monitoring Heatpump 21
  description: ''
  triggers:
  - entity_id:
    - sensor.luxtronik_21_param_state
    attribute: parameters
    trigger: state
  - hours: /4
    trigger: time_pattern
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_21_value_state'', ''values'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Value Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik21_asd
          state: 'off'
          for:
            hours: 0
            minutes: 4
            seconds: 0
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik21_vd1
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
          - condition: state
            entity_id: binary_sensor.luxtronik21_vd2
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Sensor luxtronik21_asd meldet ein Problem'
          message: Der Status des Sensor luxtronik21_asd ist {{ states('binary_sensor.luxtronik21_asd')
            }}  , jedoch sollte er ON sein, wenn der 1. oder  2. Verdichter läuft
      alias: Prüfe den Status von luxtronik21_asd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_evu
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Sensor luxtronik21_evu meldet ein Problem'
          message: Der Status des Sensor luxtronik21_evu ist {{ states('binary_sensor.luxtronik21_evu')
            }} , jedoch sollte die Energie Versorger Freigabe immer ON sein
      alias: Prüfe den Status von luxtronik21_evu
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_mot
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Sensor luxtronik21_mot meldet ein Problem'
          message: Der Status des Sensor luxtronik21_mot ist {{ states('binary_sensor.luxtronik21_mot')
            }} , jedoch sollte der Motorschutz immer ON sein
      alias: Prüfe den Status von luxtronik21_mot
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_hd
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Sensor luxtronik21_hd meldet ein Problem'
          message: Der Status des Sensor luxtronik21_hd ist {{ states('binary_sensor.luxtronik21_hd')
            }} , jedoch sollte der Hochdruck immer OFF sein
      alias: Prüfe den Status von luxtronik21_hd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_nd
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Sensor luxtronik21_nd meldet ein Problem'
          message: Der Status des Sensor luxtronik21_nd ist {{ states('binary_sensor.luxtronik21_nd')
            }} , jedoch sollte der Niederdruck immer ON sein
      alias: Prüfe den Status von luxtronik21_nd
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: sensor.luxtronik21_trl_soll
          state: '15'
          for:
            hours: 72
            minutes: 0
            seconds: 0
          alias: Rücklauf Soll seit 3 Tagen auf 15°C
        - condition: template
          value_template: '{{ (now().month == 5 and now().day > 15) or now().month
            == 6 }}'
          alias: Es ist ab Mitte Mai oder Juni
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_21
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_21
        alias: Schalte Heizphase aus
        action: input_boolean.turn_off
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus'') }}'
        target:
          entity_id: input_select.luxtronik_21_hz_operation_mode
        action: input_select.set_options
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 21: Die Heizphase ist beendet'
          message: none
      alias: Heizphase ausschalten im Mai/Juni wenn 72h lang Heizgrenze überschritten
        (Rücklauf Soll = 15 °C)
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ states(''sensor.luxtronik21_ta_mittel'')|int <= states(''sensor.luxtronik21_heizgrenze'')|int
            }}'
          alias: Mitteltemperatur kleiner als Heizgrenze
        - condition: template
          value_template: '{{ now().month == 10 or now().month == 11 }}'
          alias: Es ist Oktober oder November
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_21
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_21
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 21: Die Heizphase hat begonnen'
          message: none
      alias: Heizphase einschalten im Oktober/November wenn TA Mittel < Heizgrenze
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik21_ta_mittel
          above: 22
        - condition: template
          value_template: '{{ now().month == 6 or now().month == 7 }}'
          alias: Es ist Juni oder Juli
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_21
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_21
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 21: Die Kühlphase hat begonnen'
          message: none
      alias: Kühlphase einschalten im Juni/Juli wenn TA Mittel über 22 °C
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik21_ta_mittel
          below: 16
        - condition: template
          value_template: '{{ now().month == 9 }}'
          alias: Es ist September
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_21
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_21
        action: input_boolean.turn_off
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 21: Die Kühlphase ist beendet'
          message: Es ist September und TA-Mittel ist unterhalb 16 °C
      alias: Kühlphase ausschalten im September wenn TA Mittel unter 16 °C
      enabled: false
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Parameter Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heating_temperature'']
          != 0.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heating_temperature hat geändert'
          message: Der neue Wert für heating_temperature ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heating_temperature']}}
      alias: Prüfe den Parameter heating_temperature
    - alias: Prüfe nur, wenn BPU nicht läuft
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_bup
        state: 'off'
      then:
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: "{{state_attr('sensor.luxtronik_21_param_state', 'parameters')['warmwater_temperature']
              \n!= states('input_number.luxtronik_21_ww_solltemperatur')|int \n    and
              (state_attr('automation.schalte_ww_setze_ww_solltemperatur_haus_21_bei_anderung','current')|int
              == 0) \n}}"
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 21: Der Wert warmwater_temperature hat geändert'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_21_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature (ändert während der TDI)
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''warmwater_temperature'']
              != states(''input_number.luxtronik_ww_normaltemperatur'')|int }}'
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_21
            state: 'off'
            enabled: true
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 21: Der Wert warmwater_temperature hat geändert
              (während TDI)'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_21_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature Normabweichung (nicht während
          der TDI)
      - if:
        - condition: template
          value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Automatik"  and  state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Party" }}'
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 21: Der Wert warmwater_operation_mode_string
              hat geändert (ausserhalb TDI)'
            message: Der neue Wert für warmwater_operation_mode_string ist {{state_attr('sensor.luxtronik_21_param_state',
              'parameters')['warmwater_operation_mode_string']}}
        alias: Prüfe den Parameter warmwater_operation_mode_string
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{(state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heating_operation_mode''])|int
            != states(''input_select.luxtronik_21_hz_operation_mode'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heating_operation_mode hat geändert'
          message: Der neue Wert für heating_operation_mode ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heating_operation_mode']}}
      alias: Prüfe den Parameter heating_operation_mode
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heating_curve_end_point'']
          != 30.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heating_curve_end_point hat geändert'
          message: Der neue Wert für heating_curve_end_point ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heating_curve_end_point']}}
      alias: Prüfe den Parameter heating_curve_end_point
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heating_curve_parallel_offset'']
          != 20.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heating_curve_parallel_offset hat
            geändert'
          message: Der neue Wert für heating_curve_parallel_offset ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heating_curve_parallel_offset']}}
      alias: Prüfe den Parameter heating_curve_parallel_offset
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''deltaHeatingReduction'']
          != -15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert deltaHeatingReduction hat geändert'
          message: Der neue Wert für deltaHeatingReduction ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['deltaHeatingReduction']}}
      alias: Prüfe den Parameter deltaHeatingReduction
    - if:
      - condition: template
        value_template: "{{ (state_attr('sensor.luxtronik_21_param_state', 'parameters')['hotWaterTemperatureHysteresis']
          \n    != states('input_number.luxtronik_21_ww_hysterese')|int) \n    and
          (state_attr('automation.schalte_ww_setze_ww_hysterese_haus_21_bei_anderung','current')|int
          == 0) \n}}\n"
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterTemperatureHysteresis hat
            geändert'
          message: Der neue Wert für hotWaterTemperatureHysteresis ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterTemperatureHysteresis']}}
      alias: Prüfe den Parameter hotWaterTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_normalhysterese'')|float  and state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_maximalhysterese'')|float}}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert returnTemperatureHysteresis hat geändert'
          message: Der neue Wert für returnTemperatureHysteresis ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['returnTemperatureHysteresis']}}
      alias: Prüfe den Parameter returnTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''temperature_hot_water_target'']
          < states(''input_number.luxtronik_ww_normaltemperatur'')|int or state_attr(''sensor.luxtronik_21_param_state'',
          ''parameters'')[''temperature_hot_water_target''] > states(''input_number.luxtronik_ww_maximaltemperatur'')|int
          or state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''temperature_hot_water_target'']
          != states(''input_number.luxtronik_21_ww_solltemperatur'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert temperature_hot_water_target hat
            geändert'
          message: Der neue Wert für temperature_hot_water_target ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['temperature_hot_water_target']}}
      alias: 'Prüfe den Parameter temperature_hot_water_target '
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''thresholdHeatingLimit'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert thresholdHeatingLimit hat geändert
            (ausserhalb TDI)'
          message: Der neue Wert für thresholdHeatingLimit ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['thresholdHeatingLimit']}}
      alias: Prüfe den Parameter thresholdHeatingLimit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''returnTemperatureTargetMin'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert returnTemperatureTargetMin hat geändert'
          message: Der neue Wert für returnTemperatureTargetMin ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['returnTemperatureTargetMin']}}
      alias: Prüfe den Parameter returnTemperatureTargetMin
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''temperature_hot_water_limit'']
          != 60 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert temperature_hot_water_limit hat geändert'
          message: Der neue Wert für temperature_hot_water_limit ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['temperature_hot_water_limit']}}
      alias: Prüfe den Parameter temperature_hot_water_limit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_21_param_state', 'parameters')['heatingOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter heatingOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für heatingOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableWeek']}}
      alias: Prüfe den Parameter heatingOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;01:45&#39;}, {&#39;on&#39;:
          &#39;04:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;12:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''heatingOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert heatingOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['heatingOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySaturday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_21_param_state', 'parameters')['hotWaterOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;16:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für hotWaterOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableWeek']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;02:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 21: Der Wert hotWaterOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_21_param_state',
            'parameters')['hotWaterOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySaturday
  mode: single
- id: '1675601874352'
  alias: Monitoring Heatpump 23
  description: ''
  triggers:
  - entity_id:
    - sensor.luxtronik_23_param_state
    attribute: parameters
    trigger: state
  - hours: /4
    trigger: time_pattern
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_23_value_state'', ''values'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Value Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik23_asd
          state: 'off'
          for:
            hours: 0
            minutes: 4
            seconds: 0
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik23_vd1
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
          - condition: state
            entity_id: binary_sensor.luxtronik23_vd2
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Sensor luxtronik23_asd meldet ein Problem'
          message: Der Status des Sensor luxtronik23_asd ist {{ states('binary_sensor.luxtronik23_asd')
            }}  , jedoch sollte er ON sein, wenn der 1. oder  2. Verdichter läuft
      alias: Prüfe den Status von luxtronik23_asd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_evu
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Sensor luxtronik23_evu meldet ein Problem'
          message: Der Status des Sensor luxtronik23_evu ist {{ states('binary_sensor.luxtronik23_evu')
            }} , jedoch sollte die Energie Versorger Freigabe immer ON sein
      alias: Prüfe den Status von luxtronik23_evu
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_mot
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Sensor luxtronik23_mot meldet ein Problem'
          message: Der Status des Sensor luxtronik23_mot ist {{ states('binary_sensor.luxtronik23_mot')
            }} , jedoch sollte der Motorschutz immer ON sein
      alias: Prüfe den Status von luxtronik23_mot
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_hd
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Sensor luxtronik23_hd meldet ein Problem'
          message: Der Status des Sensor luxtronik23_hd ist {{ states('binary_sensor.luxtronik23_hd')
            }} , jedoch sollte der Hochdruck immer OFF sein
      alias: Prüfe den Status von luxtronik23_hd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_nd
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Sensor luxtronik23_nd meldet ein Problem'
          message: Der Status des Sensor luxtronik23_nd ist {{ states('binary_sensor.luxtronik23_nd')
            }} , jedoch sollte der Niederdruck immer ON sein
      alias: Prüfe den Status von luxtronik23_nd
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: sensor.luxtronik23_trl_soll
          state: '15'
          for:
            hours: 72
            minutes: 0
            seconds: 0
          alias: Rücklauf Soll seit 3 Tagen auf 15°C
        - condition: template
          value_template: '{{ (now().month == 5 and now().day > 15) or now().month
            == 6 }}'
          alias: Es ist ab Mitte Mai oder Juni
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_23
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_23
        alias: Schalte Heizphase aus
        action: input_boolean.turn_off
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus'') }}'
        target:
          entity_id: input_select.luxtronik_23_hz_operation_mode
        action: input_select.set_options
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 23: Die Heizphase ist beendet'
          message: none
      alias: Heizphase ausschalten im Mai/Juni wenn 72h lang Heizgrenze überschritten
        (Rücklauf Soll = 15 °C)
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ states(''sensor.luxtronik23_ta_mittel'')|int <= states(''sensor.luxtronik23_heizgrenze'')|int
            }}'
          alias: Mitteltemperatur kleiner als Heizgrenze
        - condition: template
          value_template: '{{ now().month == 10 or now().month == 11 }}'
          alias: Es ist Oktober oder November
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_23
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_23
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 23: Die Heizphase hat begonnen'
          message: none
      alias: Heizphase einschalten im Oktober/November wenn TA Mittel < Heizgrenze
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik23_ta_mittel
          above: 22
        - condition: template
          value_template: '{{ now().month == 6 or now().month == 7 }}'
          alias: Es ist Juni oder Juli
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_23
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_23
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 23: Die Kühlphase hat begonnen'
          message: none
      alias: Kühlphase einschalten im Juni/Juli wenn TA Mittel über 22 °C
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik23_ta_mittel
          below: 16
        - condition: template
          value_template: '{{ now().month == 9 }}'
          alias: Es ist September
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_23
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_23
        action: input_boolean.turn_off
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 23: Die Kühlphase ist beendet'
          message: Es ist September und TA-Mittel ist unterhalb 16 °C
      alias: Kühlphase ausschalten im September wenn TA Mittel unter 16 °C
      enabled: false
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Parameter Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heating_temperature'']
          != 0.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heating_temperature hat geändert'
          message: Der neue Wert für heating_temperature ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heating_temperature']}}
      alias: Prüfe den Parameter heating_temperature
    - alias: Prüfe nur, wenn BPU nicht läuft
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_bup
        state: 'off'
      then:
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: "{{state_attr('sensor.luxtronik_23_param_state', 'parameters')['warmwater_temperature']
              \n!= states('input_number.luxtronik_23_ww_solltemperatur')|int \n    and
              (state_attr('automation.schalte_ww_setze_ww_solltemperatur_haus_23_bei_anderung','current')|int
              == 0) \n}}"
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 23: Der Wert warmwater_temperature hat geändert'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_23_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature (ändert während der TDI)
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''warmwater_temperature'']
              != states(''input_number.luxtronik_ww_normaltemperatur'')|int }}'
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_23
            state: 'off'
            enabled: true
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 23: Der Wert warmwater_temperature hat geändert
              (während TDI)'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_23_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature Normabweichung (nicht während
          der TDI)
      - if:
        - condition: template
          value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Automatik"  and  state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Party" }}'
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 23: Der Wert warmwater_operation_mode_string
              hat geändert (ausserhalb TDI)'
            message: Der neue Wert für warmwater_operation_mode_string ist {{state_attr('sensor.luxtronik_23_param_state',
              'parameters')['warmwater_operation_mode_string']}}
        alias: Prüfe den Parameter warmwater_operation_mode_string
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{(state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heating_operation_mode''])|int
            != states(''input_select.luxtronik_23_hz_operation_mode'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heating_operation_mode hat geändert'
          message: Der neue Wert für heating_operation_mode ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heating_operation_mode']}}
      alias: Prüfe den Parameter heating_operation_mode
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heating_curve_end_point'']
          != 30.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heating_curve_end_point hat geändert'
          message: Der neue Wert für heating_curve_end_point ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heating_curve_end_point']}}
      alias: Prüfe den Parameter heating_curve_end_point
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heating_curve_parallel_offset'']
          != 20.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heating_curve_parallel_offset hat
            geändert'
          message: Der neue Wert für heating_curve_parallel_offset ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heating_curve_parallel_offset']}}
      alias: Prüfe den Parameter heating_curve_parallel_offset
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''deltaHeatingReduction'']
          != -15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert deltaHeatingReduction hat geändert'
          message: Der neue Wert für deltaHeatingReduction ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['deltaHeatingReduction']}}
      alias: Prüfe den Parameter deltaHeatingReduction
    - if:
      - condition: template
        value_template: "{{ (state_attr('sensor.luxtronik_23_param_state', 'parameters')['hotWaterTemperatureHysteresis']
          \n    != states('input_number.luxtronik_23_ww_hysterese')|int) \n    and
          (state_attr('automation.schalte_ww_setze_ww_hysterese_haus_23_bei_anderung','current')|int
          == 0) \n}}\n"
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterTemperatureHysteresis hat
            geändert'
          message: Der neue Wert für hotWaterTemperatureHysteresis ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterTemperatureHysteresis']}}
      alias: Prüfe den Parameter hotWaterTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_normalhysterese'')|float  and state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_maximalhysterese'')|float}}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert returnTemperatureHysteresis hat geändert'
          message: Der neue Wert für returnTemperatureHysteresis ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['returnTemperatureHysteresis']}}
      alias: Prüfe den Parameter returnTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''temperature_hot_water_target'']
          < states(''input_number.luxtronik_ww_normaltemperatur'')|int or state_attr(''sensor.luxtronik_23_param_state'',
          ''parameters'')[''temperature_hot_water_target''] > states(''input_number.luxtronik_ww_maximaltemperatur'')|int
          or state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''temperature_hot_water_target'']
          != states(''input_number.luxtronik_23_ww_solltemperatur'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert temperature_hot_water_target hat
            geändert'
          message: Der neue Wert für temperature_hot_water_target ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['temperature_hot_water_target']}}
      alias: 'Prüfe den Parameter temperature_hot_water_target '
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''thresholdHeatingLimit'']
          != 16 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert thresholdHeatingLimit hat geändert
            (ausserhalb TDI)'
          message: Der neue Wert für thresholdHeatingLimit ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['thresholdHeatingLimit']}}
      alias: Prüfe den Parameter thresholdHeatingLimit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''returnTemperatureTargetMin'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert returnTemperatureTargetMin hat geändert'
          message: Der neue Wert für returnTemperatureTargetMin ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['returnTemperatureTargetMin']}}
      alias: Prüfe den Parameter returnTemperatureTargetMin
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''temperature_hot_water_limit'']
          != 60 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert temperature_hot_water_limit hat geändert'
          message: Der neue Wert für temperature_hot_water_limit ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['temperature_hot_water_limit']}}
      alias: Prüfe den Parameter temperature_hot_water_limit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_23_param_state', 'parameters')['heatingOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter heatingOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für heatingOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableWeek']}}
      alias: Prüfe den Parameter heatingOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;01:45&#39;}, {&#39;on&#39;:
          &#39;04:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;12:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''heatingOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert heatingOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['heatingOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySaturday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_23_param_state', 'parameters')['hotWaterOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;16:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für hotWaterOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableWeek']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;02:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 23: Der Wert hotWaterOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_23_param_state',
            'parameters')['hotWaterOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySaturday
  mode: single
- id: '1675601916369'
  alias: Monitoring Heatpump 25
  description: ''
  triggers:
  - entity_id:
    - sensor.luxtronik_25_param_state
    attribute: parameters
    trigger: state
  - hours: /4
    trigger: time_pattern
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_25_value_state'', ''values'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Value Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik25_asd
          state: 'off'
          for:
            hours: 0
            minutes: 4
            seconds: 0
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik25_vd1
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
          - condition: state
            entity_id: binary_sensor.luxtronik25_vd2
            state: 'on'
            for:
              hours: 0
              minutes: 5
              seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Sensor luxtronik25_asd meldet ein Problem'
          message: Der Status des Sensor luxtronik25_asd ist {{ states('binary_sensor.luxtronik25_asd')
            }}  , jedoch sollte er ON sein, wenn der 1. oder  2. Verdichter läuft
      alias: Prüfe den Status von luxtronik25_asd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_evu
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Sensor luxtronik25_evu meldet ein Problem'
          message: Der Status des Sensor luxtronik25_evu ist {{ states('binary_sensor.luxtronik25_evu')
            }} , jedoch sollte die Energie Versorger Freigabe immer ON sein
      alias: Prüfe den Status von luxtronik25_evu
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_mot
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Sensor luxtronik25_mot meldet ein Problem'
          message: Der Status des Sensor luxtronik25_mot ist {{ states('binary_sensor.luxtronik25_mot')
            }} , jedoch sollte der Motorschutz immer ON sein
      alias: Prüfe den Status von luxtronik25_mot
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_hd
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Sensor luxtronik25_hd meldet ein Problem'
          message: Der Status des Sensor luxtronik25_hd ist {{ states('binary_sensor.luxtronik25_hd')
            }} , jedoch sollte der Hochdruck immer OFF sein
      alias: Prüfe den Status von luxtronik25_hd
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_nd
        state: 'off'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Sensor luxtronik25_nd meldet ein Problem'
          message: Der Status des Sensor luxtronik25_nd ist {{ states('binary_sensor.luxtronik25_nd')
            }} , jedoch sollte der Niederdruck immer ON sein
      alias: Prüfe den Status von luxtronik25_nd
    - if:
      - condition: and
        conditions:
        - condition: state
          entity_id: sensor.luxtronik25_trl_soll
          state: '15'
          for:
            hours: 72
            minutes: 0
            seconds: 0
          alias: Rücklauf Soll seit 3 Tagen auf 15°C
        - condition: template
          value_template: '{{ (now().month == 5 and now().day > 15) or now().month
            == 6 }}'
          alias: Es ist ab Mitte Mai oder Juni
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_25
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_25
        alias: Schalte Heizphase aus
        action: input_boolean.turn_off
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus'') }}'
        target:
          entity_id: input_select.luxtronik_25_hz_operation_mode
        action: input_select.set_options
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 25: Die Heizphase ist beendet'
          message: none
      alias: Heizphase ausschalten im Mai/Juni wenn 72h lang Heizgrenze überschritten
        (Rücklauf Soll = 15 °C)
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ states(''sensor.luxtronik25_ta_mittel'')|int <= states(''sensor.luxtronik25_heizgrenze'')|int
            }}'
          alias: Mitteltemperatur kleiner als Heizgrenze
        - condition: template
          value_template: '{{ now().month == 10 or now().month == 11 }}'
          alias: Es ist Oktober oder November
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_25
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_heizphase_haus_25
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 25: Die Heizphase hat begonnen'
          message: none
      alias: Heizphase einschalten im Oktober/November wenn TA Mittel < Heizgrenze
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik25_ta_mittel
          above: 22
        - condition: template
          value_template: '{{ now().month == 6 or now().month == 7 }}'
          alias: Es ist Juni oder Juli
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_25
          state: 'off'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_25
        action: input_boolean.turn_on
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 25: Die Kühlphase hat begonnen'
          message: none
      alias: Kühlphase einschalten im Juni/Juli wenn TA Mittel über 22 °C
      enabled: false
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik25_ta_mittel
          below: 16
        - condition: template
          value_template: '{{ now().month == 9 }}'
          alias: Es ist September
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_25
          state: 'on'
      then:
      - data: {}
        target:
          entity_id: input_boolean.luxtronik_kuhlphase_haus_25
        action: input_boolean.turn_off
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Heatpump 25: Die Kühlphase ist beendet'
          message: Es ist September und TA-Mittel ist unterhalb 16 °C
      alias: Kühlphase ausschalten im September wenn TA Mittel unter 16 °C
      enabled: false
  - if:
    - condition: template
      value_template: '{% if state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')|safe
        == ''None'' %}false{%- else -%}true{%- endif %}'
      alias: Prüfe, ob im Parameter Status gültige Werte vorhanden sind (nicht None)
    then:
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heating_temperature'']
          != 0.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heating_temperature hat geändert'
          message: Der neue Wert für heating_temperature ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heating_temperature']}}
      alias: Prüfe den Parameter heating_temperature
    - alias: Prüfe nur, wenn BPU nicht läuft
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_bup
        state: 'off'
      then:
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: "{{state_attr('sensor.luxtronik_25_param_state', 'parameters')['warmwater_temperature']
              \n!= states('input_number.luxtronik_25_ww_solltemperatur')|int \n    and
              (state_attr('automation.schalte_ww_setze_ww_solltemperatur_haus_25_bei_anderung','current')|int
              == 0) \n}}"
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 25: Der Wert warmwater_temperature hat geändert'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_25_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature (ändert während der TDI)
      - if:
        - condition: and
          conditions:
          - condition: template
            value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''warmwater_temperature'']
              != states(''input_number.luxtronik_ww_normaltemperatur'')|int }}'
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_25
            state: 'off'
            enabled: true
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 25: Der Wert warmwater_temperature hat geändert
              (während TDI)'
            message: Der neue Wert für warmwater_temperature ist {{state_attr('sensor.luxtronik_25_param_state',
              'parameters')['warmwater_temperature']}}
        alias: Prüfe den Parameter warmwater_temperature Normabweichung (nicht während
          der TDI)
      - if:
        - condition: template
          value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Automatik"  and  state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']  !=
            "Party" }}'
        then:
        - action: script.send_a_notification_to_administrator_rotseepark
          data:
            title: 'HA-Alert Heatpump 25: Der Wert warmwater_operation_mode_string
              hat geändert (ausserhalb TDI)'
            message: Der neue Wert für warmwater_operation_mode_string ist {{state_attr('sensor.luxtronik_25_param_state',
              'parameters')['warmwater_operation_mode_string']}}
        alias: Prüfe den Parameter warmwater_operation_mode_string
    - if:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{(state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heating_operation_mode''])|int
            != states(''input_select.luxtronik_25_hz_operation_mode'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heating_operation_mode hat geändert'
          message: Der neue Wert für heating_operation_mode ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heating_operation_mode']}}
      alias: Prüfe den Parameter heating_operation_mode
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heating_curve_end_point'']
          != 30.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heating_curve_end_point hat geändert'
          message: Der neue Wert für heating_curve_end_point ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heating_curve_end_point']}}
      alias: Prüfe den Parameter heating_curve_end_point
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heating_curve_parallel_offset'']
          != 20.5 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heating_curve_parallel_offset hat
            geändert'
          message: Der neue Wert für heating_curve_parallel_offset ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heating_curve_parallel_offset']}}
      alias: Prüfe den Parameter heating_curve_parallel_offset
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''deltaHeatingReduction'']
          != -15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert deltaHeatingReduction hat geändert'
          message: Der neue Wert für deltaHeatingReduction ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['deltaHeatingReduction']}}
      alias: Prüfe den Parameter deltaHeatingReduction
    - if:
      - condition: template
        value_template: "{{ (state_attr('sensor.luxtronik_25_param_state', 'parameters')['hotWaterTemperatureHysteresis']
          \n    != states('input_number.luxtronik_25_ww_hysterese')|int) \n    and
          (state_attr('automation.schalte_ww_setze_ww_hysterese_haus_25_bei_anderung','current')|int
          == 0) \n}}\n"
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterTemperatureHysteresis hat
            geändert'
          message: Der neue Wert für hotWaterTemperatureHysteresis ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterTemperatureHysteresis']}}
      alias: Prüfe den Parameter hotWaterTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_normalhysterese'')|float  and state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''returnTemperatureHysteresis'']|float  !=
          states(''input_number.luxtronik_hz_maximalhysterese'')|float}}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert returnTemperatureHysteresis hat geändert'
          message: Der neue Wert für returnTemperatureHysteresis ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['returnTemperatureHysteresis']}}
      alias: Prüfe den Parameter returnTemperatureHysteresis
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''temperature_hot_water_target'']
          < states(''input_number.luxtronik_ww_normaltemperatur'')|int or state_attr(''sensor.luxtronik_25_param_state'',
          ''parameters'')[''temperature_hot_water_target''] > states(''input_number.luxtronik_ww_maximaltemperatur'')|int
          or state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''temperature_hot_water_target'']
          != states(''input_number.luxtronik_25_ww_solltemperatur'')|int }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert temperature_hot_water_target hat
            geändert'
          message: Der neue Wert für temperature_hot_water_target ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['temperature_hot_water_target']}}
      alias: 'Prüfe den Parameter temperature_hot_water_target '
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''thresholdHeatingLimit'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert thresholdHeatingLimit hat geändert
            (ausserhalb TDI)'
          message: Der neue Wert für thresholdHeatingLimit ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['thresholdHeatingLimit']}}
      alias: Prüfe den Parameter thresholdHeatingLimit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''returnTemperatureTargetMin'']
          != 15 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert returnTemperatureTargetMin hat geändert'
          message: Der neue Wert für returnTemperatureTargetMin ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['returnTemperatureTargetMin']}}
      alias: Prüfe den Parameter returnTemperatureTargetMin
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''temperature_hot_water_limit'']
          != 60 }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert temperature_hot_water_limit hat geändert'
          message: Der neue Wert für temperature_hot_water_limit ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['temperature_hot_water_limit']}}
      alias: Prüfe den Parameter temperature_hot_water_limit
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_25_param_state', 'parameters')['heatingOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter heatingOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für heatingOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableWeek']}}
      alias: Prüfe den Parameter heatingOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter heatingOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;01:45&#39;}, {&#39;on&#39;:
          &#39;04:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;12:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''heatingOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;:
          &#39;12:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}]" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert heatingOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für heatingOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['heatingOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter heatingOperationTimerTableDaySaturday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableSelectedString'']
          != "Tage (Mo, Di, ...)" }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableSelectedString
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableSelectedString ist
            {{state_attr('sensor.luxtronik_25_param_state', 'parameters')['hotWaterOperationTimerTableSelectedString']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableSelectedString
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableWeek'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;16:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableWeek hat
            geändert'
          message: Der neue Wert für hotWaterOperationTimerTableWeek ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableWeek']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableWeek
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTable52MonFri'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTable52MonFri
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52MonFri ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTable52MonFri']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52MonFri
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTable52SatSun'']|e
          != "[{&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;:
          &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTable52SatSun
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTable52SatSun ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTable52SatSun']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTable52SatSun
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySunday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;02:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;12:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDaySunday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySunday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDaySunday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySunday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayMonday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDayMonday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayMonday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDayMonday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayMonday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayTuesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDayTuesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayTuesday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDayTuesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayTuesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayWednesday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDayWednesday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayWednesday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDayWednesday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayWednesday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayThursday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDayThursday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayThursday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDayThursday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayThursday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDayFriday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:15&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDayFriday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDayFriday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDayFriday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDayFriday
    - if:
      - condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''hotWaterOperationTimerTableDaySaturday'']|e
          != "[{&#39;on&#39;: &#39;09:00&#39;, &#39;off&#39;: &#39;06:00&#39;}, {&#39;on&#39;:
          &#39;22:00&#39;, &#39;off&#39;: &#39;15:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;,
          &#39;off&#39;: &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;:
          &#39;00:00&#39;}, {&#39;on&#39;: &#39;00:00&#39;, &#39;off&#39;: &#39;00:00&#39;}]"
          }}'
      then:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Alert Heatpump 25: Der Wert hotWaterOperationTimerTableDaySaturday
            hat geändert'
          message: Der neue Wert für hotWaterOperationTimerTableDaySaturday ist {{state_attr('sensor.luxtronik_25_param_state',
            'parameters')['hotWaterOperationTimerTableDaySaturday']}}
      alias: Prüfe den Parameter hotWaterOperationTimerTableDaySaturday
  mode: single
- id: '1675759244521'
  alias: Monitoring Zaptec Charger Offline Mode Check
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.zaptec_pp_19_offline_mode
    - binary_sensor.zaptec_pp_24_offline_mode
    - binary_sensor.zaptec_pp_29_offline_mode
    - binary_sensor.zaptec_pp_33_offline_mode
    - binary_sensor.zaptec_pp_46_offline_mode
    - binary_sensor.zaptec_pp_65_offline_mode
    - binary_sensor.zaptec_pp_80_offline_mode
    - binary_sensor.zaptec_pp_85_offline_mode
    - binary_sensor.zaptec_pp_a3_offline_mode
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      title: 'HA-Alert Einstellhalle: Zaptec Station Offline Mode'
      message: "PP 19 - {{ states('binary_sensor.zaptec_pp_19_offline_mode') }}  \nPP
        24 - {{ states('binary_sensor.zaptec_pp_24_offline_mode') }}  \nPP 29 - {{
        states('binary_sensor.zaptec_pp_29_offline_mode') }}  \nPP 33 - {{ states('binary_sensor.zaptec_pp_33_offline_mode')
        }}  \nPP 46 - {{ states('binary_sensor.zaptec_pp_46_offline_mode') }}  \nPP
        65 - {{ states('binary_sensor.zaptec_pp_65_offline_mode') }} \nPP 80 - {{
        states('binary_sensor.zaptec_pp_80_offline_mode') }} \nPP 85 - {{ states('binary_sensor.zaptec_pp_85_offline_mode')
        }} \nPP A3 - {{ states('binary_sensor.zaptec_pp_a3_offline_mode') }} "
    action: notify.administrator_rotseepark
  mode: single
- id: '1676111046127'
  alias: Monitoring Ubiquiti Clients
  description: ''
  triggers:
  - entity_id:
    - device_tracker.rotseepark_dm
    - device_tracker.homeassistant
    - device_tracker.janitza_umg
    - device_tracker.gwf_minix_wired
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.sw_haus_19_poe
    - device_tracker.sw_haus_21_poe
    - device_tracker.sw_haus_23_poe
    - device_tracker.sw_haus_25_poe
    - device_tracker.sw_haus_19_flex
    - device_tracker.sw_haus_21_flex
    - device_tracker.sw_haus_23_flex
    - device_tracker.sw_haus_25_flex
    - device_tracker.ap_19_mesh
    - device_tracker.ap_21_wired_u6
    - device_tracker.ap_23_mesh
    - device_tracker.ap_bmz_wired_u6
    - device_tracker.ap_jls_mesh
    - device_tracker.ap_19_heizung
    - device_tracker.ap_21_heizung
    - device_tracker.ap_23_heizung
    - device_tracker.ap_25_heizung
    - device_tracker.ap_19_elektro
    - device_tracker.ap_21_keller
    - device_tracker.ap_23_elektro
    - device_tracker.ap_25_keller
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.unifi_protect_nvr
    - device_tracker.rotseepark_cam_indoor
    - device_tracker.rotseepark_cam_outdoor
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.shelly_box_haus_19
    - device_tracker.shelly_box_haus_21
    - device_tracker.shelly_box_haus_23
    - device_tracker.shelly_box_haus_25
    - device_tracker.shelly_hobler_tor
    - device_tracker.shelly_e_mobility_haus_25
    - device_tracker.secomat_19_1
    - device_tracker.secomat_19_2
    - device_tracker.secomat_21_1
    - device_tracker.secomat_21_2
    - device_tracker.secomat_23_1
    - device_tracker.secomat_23_2
    - device_tracker.secomat_25_1
    - device_tracker.secomat_25_2
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.moxa_gwf_19
    - device_tracker.moxa_gwf_23
    - device_tracker.moxa_gwf_25
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.solarlog_19
    - device_tracker.solarlog_21
    - device_tracker.solarlog_23
    - device_tracker.solarlog_25
    to: not_home
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.luxtronic_19
    - device_tracker.luxtronic_21
    - device_tracker.luxtronic_23
    - device_tracker.luxtronic_25
    to: not_home
    for:
      hours: 5
      minutes: 0
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.vento_compact_19
    - device_tracker.vento_compact_21
    - device_tracker.vento_compact_23
    - device_tracker.vento_compact_25
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.zaptec_pp_19
    - device_tracker.zaptec_pp_24
    - device_tracker.zaptec_pp_29
    - device_tracker.zaptec_pp_46
    - device_tracker.zaptec_pp_65
    - device_tracker.zaptec_pp_80
    - device_tracker.zaptec_pp_85
    - device_tracker.zaptec_pp_a3
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Alert Rotseepark: Unifi Clients nicht verfügbar'
      message: "HA-Alert Rotseepark - Unifi Clients nicht verfügbar  \n--- Grundinstallation
        ---\n{% if states('device_tracker.rotseepark_dm') != 'home' -%}device_tracker.rotseepark_dm:
        {{states('device_tracker.rotseepark_dm')}}{%- else -%}{%- endif %} \n{% if
        states('device_tracker.homeassistant') != 'home' -%}device_tracker.homeassistant:
        {{states('device_tracker.homeassistant')}}{%- else -%}{%- endif %} \n{% if
        states('device_tracker.janitza_umg') != 'home' -%}device_tracker.janitza_umg:
        {{states('device_tracker.janitza_umg')}}{%- else -%}{%- endif %} \n{% if states('device_tracker.gwf_minix_wired')
        != 'home' -%}device_tracker.gwf_minix_wired: {{states('device_tracker.gwf_minix_wired')}}{%-
        else -%}{%- endif %} \n--- Access Point und Switch ---\n{% if states('device_tracker.ap_19_mesh')
        != 'home' -%}device_tracker.ap_19_mesh: {{states('device_tracker.ap_19_mesh')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_21_wired_u6') != 'home'
        -%}device_tracker.ap_21_wired_u6: {{states('device_tracker.ap_21_wired_u6')}}{%-
        else -%}{%- endif %} \n{%if states('device_tracker.ap_23_mesh') != 'home'
        -%}device_tracker.ap_23_mesh: {{states('device_tracker.ap_23_mesh')}}{%- else
        -%}{%- endif %} \n{% if states('device_tracker.ap_bmz_wired_u6') != 'home'
        -%}device_tracker.ap_bmz_wired_u6: {{states('device_tracker.ap_bmz_wired_u6')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_jls_mesh') != 'home'
        -%}device_tracker.ap_jls_mesh: {{states('device_tracker.ap_jls_mesh')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_19_heizung') != 'home'
        -%}device_tracker.ap_19_heizung: {{states('device_tracker.ap_19_heizung')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_21_heizung') != 'home'
        -%}device_tracker.ap_21_heizung: {{states('device_tracker.ap_21_heizung')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_23_heizung') != 'home'
        -%}device_tracker.ap_23_heizung: {{states('device_tracker.ap_23_heizung')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_25_heizung') != 'home'
        -%}device_tracker.ap_25_heizung: {{states('device_tracker.ap_25_heizung')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_19_elektro') != 'home'
        -%}device_tracker.ap_19_elektro: {{states('device_tracker.ap_19_elektro')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_21_keller') != 'home'
        -%}device_tracker.ap_21_keller: {{states('device_tracker.ap_21_keller')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_23_elektro') != 'home'
        -%}device_tracker.ap_23_elektro: {{states('device_tracker.ap_23_elektro')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.ap_25_keller') != 'home'
        -%}device_tracker.ap_25_keller: {{states('device_tracker.ap_25_keller')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_19_poe') != 'home'
        -%}device_tracker.sw_haus_19_poe: {{states('device_tracker.sw_haus_19_poe')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_21_poe') != 'home'
        -%}device_tracker.sw_haus_21_poe: {{states('device_tracker.sw_haus_21_poe')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_23_poe') != 'home'
        -%}device_tracker.sw_haus_23_poe: {{states('device_tracker.sw_haus_23_poe')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_25_poe') != 'home'
        -%}device_tracker.sw_haus_25_poe: {{states('device_tracker.sw_haus_25_poe')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_19_flex') != 'home'
        -%}device_tracker.sw_haus_19_flex: {{states('device_tracker.sw_haus_19_flex')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_21_flex') != 'home'
        -%}device_tracker.sw_haus_21_flex: {{states('device_tracker.sw_haus_21_flex')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_23_flex') != 'home'
        -%}device_tracker.sw_haus_23_flex: {{states('device_tracker.sw_haus_23_flex')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.sw_haus_25_flex') != 'home'
        -%}device_tracker.sw_haus_25_flex: {{states('device_tracker.sw_haus_25_flex')}}{%-
        else -%}{%- endif %} \n--- Protect ---\n{% if states('device_tracker.unifi_protect_nvr')
        != 'home' -%}device_tracker.unifi_protect_nvr: {{states('device_tracker.unifi_protect_nvr')}}{%-
        else -%}{%- endif %}\n{% if states('device_tracker.rotseepark_cam_indoor')
        != 'home' -%}device_tracker.rotseepark_cam_indoor: {{states('device_tracker.rotseepark_cam_indoor')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.rotseepark_cam_outdoor')
        != 'home' -%}device_tracker.rotseepark_cam_outdoor: {{states('device_tracker.rotseepark_cam_outdoor')}}{%-
        else -%}{%- endif %} \n--- Shelly ---\n{% if states('device_tracker.shelly_box_haus_19')
        != 'home' -%}device_tracker.shelly_box_haus_19: {{states('device_tracker.shelly_box_haus_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.shelly_box_haus_21') !=
        'home' -%}device_tracker.shelly_box_haus_21: {{states('device_tracker.shelly_box_haus_21')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.shelly_box_haus_23') !=
        'home' -%}device_tracker.shelly_box_haus_23: {{states('device_tracker.shelly_box_haus_23')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.shelly_box_haus_25') !=
        'home' -%}device_tracker.shelly_box_haus_25: {{states('device_tracker.shelly_box_haus_25')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.shelly_hobler_tor') !=
        'home' -%}device_tracker.shelly_hobler_tor: {{states('device_tracker.shelly_hobler_tor')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.shelly_e_mobility_haus_25')
        != 'home' -%}device_tracker.shelly_e_mobility_haus_25: {{states('device_tracker.shelly_e_mobility_haus_25')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_19_1') != 'home'
        -%}device_tracker.secomat_19_1: {{states('device_tracker.secomat_19_1')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_19_2') != 'home'
        -%}device_tracker.secomat_19_2: {{states('device_tracker.secomat_19_2')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_21_1') != 'home'
        -%}device_tracker.secomat_21_1: {{states('device_tracker.secomat_21_1')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_21_2') != 'home'
        -%}device_tracker.secomat_21_2: {{states('device_tracker.secomat_21_2')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_23_1') != 'home'
        -%}device_tracker.secomat_23_1: {{states('device_tracker.secomat_23_1')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_23_2') != 'home'
        -%}device_tracker.secomat_23_2: {{states('device_tracker.secomat_23_2')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_25_1') != 'home'
        -%}device_tracker.secomat_25_1: {{states('device_tracker.secomat_25_1')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.secomat_25_2') != 'home'
        -%}device_tracker.secomat_25_2: {{states('device_tracker.secomat_25_2')}}{%-
        else -%}{%- endif %} \n--- GWF Moxa ---\n{% if states('device_tracker.moxa_gwf_19')
        != 'home' -%}device_tracker.moxa_gwf_19: {{states('device_tracker.moxa_gwf_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.moxa_gwf_23') != 'home'
        -%}device_tracker.moxa_gwf_23: {{states('device_tracker.moxa_gwf_23')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.moxa_gwf_25') != 'home'
        -%}device_tracker.moxa_gwf_25: {{states('device_tracker.moxa_gwf_25')}}{%-
        else -%}{%- endif %} \n--- Solarlog ---\n{% if states('device_tracker.solarlog_19')
        != 'home' -%}device_tracker.solarlog_19: {{states('device_tracker.solarlog_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.solarlog_21') != 'home'
        -%}device_tracker.solarlog_21: {{states('device_tracker.solarlog_21')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.solarlog_23') != 'home'
        -%}device_tracker.solarlog_23: {{states('device_tracker.solarlog_23')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.solarlog_25') != 'home'
        -%}device_tracker.solarlog_25: {{states('device_tracker.solarlog_25')}}{%-
        else -%}{%- endif %}  \n--- Luxtronic ---\n{% if states('device_tracker.luxtronic_19')
        != 'home' -%}device_tracker.luxtronic_19: {{states('device_tracker.luxtronic_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.luxtronic_21') != 'home'
        -%}device_tracker.luxtronic_21: {{states('device_tracker.luxtronic_21')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.luxtronic_23') != 'home'
        -%}device_tracker.luxtronic_23: {{states('device_tracker.luxtronic_23')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.luxtronic_25') != 'home'
        -%}device_tracker.luxtronic_25: {{states('device_tracker.luxtronic_25')}}{%-
        else -%}{%- endif %} \n--- Vento ---\n{% if states('device_tracker.vento_compact_19')
        != 'home' -%}device_tracker.vento_compact_19: {{states('device_tracker.vento_compact_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.vento_compact_21') !=
        'home' -%}device_tracker.vento_compact_21: {{states('device_tracker.vento_compact_21')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.vento_compact_23') !=
        'home' -%}device_tracker.vento_compact_23: {{states('device_tracker.vento_compact_23')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.vento_compact_25') !=
        'home' -%}device_tracker.vento_compact_25: {{states('device_tracker.vento_compact_25')}}{%-
        else -%}{%- endif %} \n--- Zaptec ---\n{% if states('device_tracker.zaptec_pp_19')
        != 'home' -%}device_tracker.zaptec_pp_19: {{states('device_tracker.zaptec_pp_19')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.zaptec_pp_24') != 'home'
        -%}device_tracker.zaptec_pp_24: {{states('device_tracker.zaptec_pp_24')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.zaptec_pp_29') != 'home'
        -%}device_tracker.zaptec_pp_29: {{states('device_tracker.zaptec_pp_29')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.zaptec_pp_46') != 'home'
        -%}device_tracker.zaptec_pp_46: {{states('device_tracker.zaptec_pp_46')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.zaptec_pp_65') != 'home'
        -%}device_tracker.zaptec_pp_65: {{states('device_tracker.zaptec_pp_65')}}{%-
        else -%}{%- endif %}\n{% if states('device_tracker.zaptec_pp_80') != 'home'
        -%}device_tracker.zaptec_pp_80: {{states('device_tracker.zaptec_pp_80')}}{%-
        else -%}{%- endif %}\n{% if states('device_tracker.zaptec_pp_85') != 'home'
        -%}device_tracker.zaptec_pp_85: {{states('device_tracker.zaptec_pp_85')}}{%-
        else -%}{%- endif %} \n{% if states('device_tracker.zaptec_pp_a3') != 'home'
        -%}device_tracker.zaptec_pp_a3: {{states('device_tracker.zaptec_pp_a3')}}{%-
        else -%}{%- endif %} "
  mode: single
- id: '1676268725157'
  alias: Schalte TDI - Überwachung TDI Haus 19 (Zeitplan TDI +4h)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_19
    from: 'off'
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_19_ww_solltemperatur
    alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
    action: input_number.set_value
  - data:
      value: '0'
    target:
      entity_id:
      - sensor.heatpump_19_ww_power_consumption_helper
    alias: Zurücksetzen der Utility Meter für Stromverbrauch
    action: utility_meter.calibrate
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Starte thermische
        Desinfektion (Erwärmen auf 60 °C)'
  - alias: Prüfe, ob die Wärmepumpe mindestens 48 Grad erreicht hat
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik19_tbw
      below: 48
    then:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 19 Temperatur 48° mit WP nicht erreich
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik19_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
  - alias: Wiederhole, bis die Brauchwasser Temperatur 60 Grad erreicht hat (maximal
      bis TDI Start +6h45')
    repeat:
      while:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_tbw
          below: 60
        - condition: not
          conditions:
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_19
            state: 'on'
            for:
              hours: 7
              minutes: 45
              seconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.luxtronik_heizphase_haus_19
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_19_hz_operation_mode
      action: input_select.select_option
    alias: Heizung einschalten, sofern wir in der Heizphase sind
    enabled: false
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - alias: Sende eine Benachrichtigung über den Erfolg oder Misserfolg der TDI
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik19_tbw
      above: 59.5
    then:
    - data:
        title: HA-Info Rotseepark - TDI Haus 19 abgeschlossen
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik19_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Thermische Desinfektion
          beendet (Verbrauch: {{states(''sensor.heatpump_19_ww_power_consumption_helper'')|float
          }} kWh)'
    else:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 19 FEHLGESCHLAGEN
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik19_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Haus 19: Thermische Desinfektion
          nicht vollständig (Verbrauch: {{states(''sensor.heatpump_19_ww_power_consumption_helper'')|float
          }} kWh)'
  mode: single
- id: '1676271321547'
  alias: Schalte TDI - Überwachung TDI Haus 21 (Zeitplan TDI +4h)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_21
    from: 'off'
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_21_ww_solltemperatur
    alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
    action: input_number.set_value
  - data:
      value: '0'
    target:
      entity_id:
      - sensor.heatpump_21_ww_power_consumption_helper
    alias: Zurücksetzen der Utility Meter für Stromverbrauch
    action: utility_meter.calibrate
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Starte thermische
        Desinfektion (Erwärmen auf 60 °C)'
  - alias: Prüfe, ob die Wärmepumpe mindestens 48 Grad erreicht hat
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik21_tbw
      below: 48
    then:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 21 Temperatur 48° mit WP nicht erreich
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik21_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
  - alias: Wiederhole, bis die Brauchwasser Temperatur 60 Grad erreicht hat (maximal
      bis TDI Start +6h45')
    repeat:
      while:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik21_tbw
          below: 60
        - condition: not
          conditions:
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_21
            state: 'on'
            for:
              hours: 7
              minutes: 45
              seconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.luxtronik_heizphase_haus_21
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_21_hz_operation_mode
      action: input_select.select_option
    alias: Heizung einschalten, sofern wir in der Heizphase sind
    enabled: false
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - alias: Sende eine Benachrichtigung über den Erfolg oder Misserfolg der TDI
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik21_tbw
      above: 59.5
    then:
    - data:
        title: HA-Info Rotseepark - TDI Haus 21 abgeschlossen
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik21_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Thermische Desinfektion
          beendet (Verbrauch: {{states(''sensor.heatpump_21_ww_power_consumption_helper'')|float
          }} kWh)'
    else:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 21 FEHLGESCHLAGEN
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik21_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Haus 21: Thermische Desinfektion
          nicht vollständig (Verbrauch: {{states(''sensor.heatpump_21_ww_power_consumption_helper'')|float
          }} kWh)'
  mode: single
- id: '1676271361994'
  alias: Schalte TDI - Überwachung TDI Haus 23 (Zeitplan TDI +4h)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_23
    from: 'off'
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_23_ww_solltemperatur
    alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
    action: input_number.set_value
  - data:
      value: '0'
    target:
      entity_id:
      - sensor.heatpump_23_ww_power_consumption_helper
    alias: Zurücksetzen der Utility Meter für Stromverbrauch
    action: utility_meter.calibrate
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Starte thermische
        Desinfektion (Erwärmen auf 60 °C)'
  - alias: Prüfe, ob die Wärmepumpe mindestens 48 Grad erreicht hat
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik23_tbw
      below: 48
    then:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 23 Temperatur 48° mit WP nicht erreich
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik23_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
  - alias: Wiederhole, bis die Brauchwasser Temperatur 60 Grad erreicht hat (maximal
      bis TDI Start +6h45')
    repeat:
      while:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik23_tbw
          below: 60
        - condition: not
          conditions:
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_23
            state: 'on'
            for:
              hours: 7
              minutes: 45
              seconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.luxtronik_heizphase_haus_23
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_23_hz_operation_mode
      action: input_select.select_option
    alias: Heizung einschalten, sofern wir in der Heizphase sind
    enabled: false
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - alias: Sende eine Benachrichtigung über den Erfolg oder Misserfolg der TDI
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik23_tbw
      above: 59.5
    then:
    - data:
        title: HA-Info Rotseepark - TDI Haus 23 abgeschlossen
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik23_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Thermische Desinfektion
          beendet (Verbrauch: {{states(''sensor.heatpump_23_ww_power_consumption_helper'')|float
          }} kWh)'
    else:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 23 FEHLGESCHLAGEN
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik23_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Haus 23: Thermische Desinfektion
          nicht vollständig (Verbrauch: {{states(''sensor.heatpump_23_ww_power_consumption_helper'')|float
          }} kWh)'
  mode: single
- id: '1676271387015'
  alias: Schalte TDI - Überwachung TDI Haus 25 (Zeitplan TDI +4h)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_25
    from: 'off'
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_25_ww_solltemperatur
    alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
    action: input_number.set_value
  - data:
      value: '0'
    target:
      entity_id:
      - sensor.heatpump_25_ww_power_consumption_helper
    alias: Zurücksetzen der Utility Meter für Stromverbrauch
    action: utility_meter.calibrate
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Starte thermische
        Desinfektion (Erwärmen auf 60 °C)'
  - alias: Prüfe, ob die Wärmepumpe mindestens 48 Grad erreicht hat
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik25_tbw
      below: 48
    then:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 25 Temperatur 48° mit WP nicht erreich
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik25_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
  - alias: Wiederhole, bis die Brauchwasser Temperatur 60 Grad erreicht hat (maximal
      bis TDI Start +6h45')
    repeat:
      while:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik25_tbw
          below: 60
        - condition: not
          conditions:
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_tdi_haus_25
            state: 'on'
            for:
              hours: 7
              minutes: 45
              seconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.luxtronik_heizphase_haus_25
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_25_hz_operation_mode
      action: input_select.select_option
    alias: Heizung einschalten, sofern wir in der Heizphase sind
    enabled: false
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - alias: Sende eine Benachrichtigung über den Erfolg oder Misserfolg der TDI
    if:
    - condition: numeric_state
      entity_id: sensor.luxtronik25_tbw
      above: 59.5
    then:
    - data:
        title: HA-Info Rotseepark - TDI Haus 25 abgeschlossen
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik25_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Thermische Desinfektion
          beendet (Verbrauch: {{states(''sensor.heatpump_25_ww_power_consumption_helper'')|float
          }} kWh)'
    else:
    - data:
        title: HA-Alert Rotseepark - TDI Haus 25 FEHLGESCHLAGEN
        message: 'Temperatur Brauchwasser:  {{states(''sensor.luxtronik25_tbw'')}}

          Brauchwasser Zieltemperatur:  {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''temperature_hot_water_target'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Haus 25: Thermische Desinfektion
          nicht vollständig (Verbrauch: {{states(''sensor.heatpump_25_ww_power_consumption_helper'')|float
          }} kWh)'
  mode: single
- id: '1676443093982'
  alias: Schalte TDI - Starte TDI Haus 19 (Zeitplan TDI + 15 min)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_19
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: notify.administrator_rotseepark
    metadata: {}
    data:
      title: 'HA-Info Heatpump 19: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus 19 wird gestartet (TDI)
    enabled: false
  - variables:
      haus: 19
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (TDI)
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Boiler Ladung
        wurde gestartet (Produktion vor TDI)'
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik19_tbw_soll')|int
        \n     - states('sensor.luxtronik19_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_19_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_19_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 19, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_19_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 19 wieder zurück
  - alias: Setzte Luxtronik Solltemperatur zu TDI Temperatur
    data:
      value: '{{states(''input_number.luxtronik_ww_tdi_temperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_19_ww_solltemperatur
    action: input_number.set_value
  mode: single
- id: '1676445765532'
  alias: Schalte TDI - Starte TDI Haus 21 (Zeitplan TDI + 15 min)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_21
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: notify.administrator_rotseepark
    metadata: {}
    data:
      title: 'HA-Info Heatpump 21: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus 21 wird gestartet (TDI)
    enabled: false
  - variables:
      haus: 21
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (TDI)
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Boiler Ladung
        wurde gestartet (Produktion vor TDI)'
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik21_tbw_soll')|int
        \n     - states('sensor.luxtronik21_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_21_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_21_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 21, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_21_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 21 wieder zurück
  - alias: Setzte Luxtronik Solltemperatur zu TDI Temperatur
    data:
      value: '{{states(''input_number.luxtronik_ww_tdi_temperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_21_ww_solltemperatur
    action: input_number.set_value
  mode: single
- id: '1676445795620'
  alias: Schalte TDI - Starte TDI Haus 23 (Zeitplan TDI + 15 min)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_23
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: notify.administrator_rotseepark
    metadata: {}
    data:
      title: 'HA-Info Heatpump 23: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus 23 wird gestartet (TDI)
    enabled: false
  - variables:
      haus: 23
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (TDI)
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Boiler Ladung
        wurde gestartet (Produktion vor TDI)'
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik23_tbw_soll')|int
        \n     - states('sensor.luxtronik23_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_23_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_23_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 23, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_23_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 23 wieder zurück
  - alias: Setzte Luxtronik Solltemperatur zu TDI Temperatur
    data:
      value: '{{states(''input_number.luxtronik_ww_tdi_temperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_23_ww_solltemperatur
    action: input_number.set_value
  mode: single
- id: '1676445824173'
  alias: Schalte TDI - Starte TDI Haus 25 (Zeitplan TDI + 15 min)
  description: ''
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_tdi_haus_25
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: notify.administrator_rotseepark
    metadata: {}
    data:
      title: 'HA-Info Heatpump 25: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus 25 wird gestartet (TDI)
    enabled: false
  - variables:
      haus: 25
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (TDI)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (TDI)
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Boiler Ladung
        wurde gestartet (Produktion vor TDI)'
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik25_tbw_soll')|int
        \n     - states('sensor.luxtronik25_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_25_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_25_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 25, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_25_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 25 wieder zurück
  - alias: Setzte Luxtronik Solltemperatur zu TDI Temperatur
    data:
      value: '{{states(''input_number.luxtronik_ww_tdi_temperatur'')|int}}'
    target:
      entity_id: input_number.luxtronik_25_ww_solltemperatur
    action: input_number.set_value
  mode: single
- id: '1676530127632'
  alias: Schalte WW - Produziere Warmwasser (Sonnenmodus moderat) - April & September
  description: ''
  triggers:
  - alias: Time Pattern Trigger 9 Uhr alle 20 Minuten
    hours: '9'
    minutes: /20
    trigger: time_pattern
  - hours: '10'
    minutes: /20
    alias: Time Pattern Trigger 10 Uhr alle 20 Minuten
    trigger: time_pattern
  - hours: '11'
    minutes: /20
    alias: Time Pattern Trigger 11 Uhr alle 20 Minuten
    trigger: time_pattern
  - hours: '12'
    minutes: /20
    alias: Time Pattern Trigger 12 Uhr alle 20 Minuten
    trigger: time_pattern
  - hours: '13'
    minutes: /20
    alias: Time Pattern Trigger 13 Uhr alle 20 Minuten
    trigger: time_pattern
  - hours: '14'
    minutes: /20
    alias: Time Pattern Trigger 14 Uhr alle 20 Minuten
    trigger: time_pattern
  conditions:
  - alias: Prüfung im April und September
    condition: template
    value_template: "{{ true if ( \n  (    (now().month == 4 ) \n    or (now().month
      == 9 ) \n  ) \n) else false }}"
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    alias: Montag bis Samstag
  - condition: template
    value_template: "{{ true if ( \n  ((now().month <= 4) and (now().hour < 14) or
      (now().month > 4)) \n) else false }}"
    alias: Bis und mit April ist der Sonnenmodus bis maximal 14:00 aktiv
  - condition: template
    value_template: "{{ true if ( \n  ((now().month >= 9) and (now().hour < 15) or
      (now().month < 9)) \n) else false }}"
    alias: Ab September ist der Sonnenmodus bis maximal 15:00 aktiv
  - alias: Nur wenn die Sonne schon 3 Stunden oben ist und noch mindestens 4 Stunden
      scheint
    condition: sun
    before: sunset
    before_offset: -04:00:00
    after: sunrise
    after_offset: 03:00:00
  - alias: Nur wenn wir jetzt gerade eine Überproduktion von 12 kWh im 60 Minuten
      Mittelwert haben
    condition: numeric_state
    entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
    below: -12000
  - alias: Nur wenn wir jetzt gerade eine Überproduktion von 15 kWh im 30 Minuten
      Mittelwert haben
    condition: numeric_state
    entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
    below: -15000
  - condition: numeric_state
    entity_id: sensor.forecast_solar_production_next_hour
    above: 25
    alias: Nur wenn der Produktion Forecast für die nächste Stunde mindestens 25 kWh
      ist
    enabled: false
  - alias: Nur wenn der Produktion Forecast für den Rest des Tages mindestens 100
      kWh ist
    condition: numeric_state
    entity_id: sensor.forecast_solar_production_today_remaining
    above: 100
    enabled: false
  - condition: template
    value_template: "{{ true if ( \n  ((now().month <= 5) and (now().hour < 15) or
      (now().month > 5)) \n) else false }}"
    alias: Bis und mit Mai ist der Sonnenmodus bis maximal 15:00 aktiv
    enabled: false
  - condition: template
    value_template: "{{ true if ( \n  ((now().month <= 8) and (now().hour < 16) or
      (now().month > 8)) \n) else false }}"
    alias: Bis und mit August ist der Sonnenmodus bis maximal 16:00 aktiv
    enabled: false
  - condition: template
    value_template: "{{ true if ( \n  ((now().month >= 10) and (now().hour < 14) or
      (now().month < 10)) \n) else false }}"
    alias: Ab Oktober ist der Sonnenmodus bis maximal 14:00 aktiv
    enabled: false
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik19_bup_out
          state: 'off'
          for:
            hours: 5
            minutes: 0
            seconds: 0
          alias: Prüfen, ob BPU von Haus 19 seit mindestens 5 Stunden nicht läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - condition: or
          conditions:
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 13 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 40% Hysterese Schwellwert von 13:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.7 ))|int
              \n and now().hour >= 11 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 30% Hysterese Schwellwert von 11:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.8 ))|int
              \n and now().hour >= 9 and now().hour <= 17) \n else false\n}}"
            alias: TBW tiefer als der 20% Hysterese Schwellwert von 09:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 7 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 10% Hysterese Schwellwert von 07:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_19_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 10 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 10:00 bis 17:00 Uhr
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_19_all_ww_l_helper')|int
              >= 800 \n and now().hour >= 12 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 800 Liter von 12:00 bis 17:00 Uhr
          alias: TBW und GWF Schwellwerte prüfen
        alias: Vergleiche Haus 19 gegen die anderen Häuser
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 19
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik19_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik21_bup_out
          state: 'off'
          for:
            hours: 5
            minutes: 0
            seconds: 0
          alias: Prüfen, ob BPU von Haus 21 seit mindestens 5 Stunden nicht läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - condition: or
          conditions:
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 13 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 40% Hysterese Schwellwert von 13:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.7 ))|int
              \n and now().hour >= 11 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 30% Hysterese Schwellwert von 11:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.8 ))|int
              \n and now().hour >= 9 and now().hour <= 17) \n else false\n}}"
            alias: TBW tiefer als der 20% Hysterese Schwellwert von 09:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 7 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 10% Hysterese Schwellwert von 07:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_21_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 10 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 10:00 bis 17:00 Uhr
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_21_all_ww_l_helper')|int
              >= 800 \n and now().hour >= 12 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 800 Liter von 12:00 bis 17:00 Uhr
          alias: TBW und GWF Schwellwerte prüfen
        alias: Vergleiche Haus 21 gegen die anderen Häuser
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 21
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik21_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik23_bup_out
          state: 'off'
          for:
            hours: 5
            minutes: 0
            seconds: 0
          alias: Prüfen, ob BPU von Haus 23 seit mindestens 5 Stunden nicht läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - condition: or
          conditions:
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 13 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 40% Hysterese Schwellwert von 13:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.7 ))|int
              \n and now().hour >= 11 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 30% Hysterese Schwellwert von 11:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.8 ))|int
              \n and now().hour >= 9 and now().hour <= 17) \n else false\n}}"
            alias: TBW tiefer als der 20% Hysterese Schwellwert von 09:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 7 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 10% Hysterese Schwellwert von 07:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_23_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 10 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 10:00 bis 17:00 Uhr
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_23_all_ww_l_helper')|int
              >= 800 \n and now().hour >= 12 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 800 Liter von 12:00 bis 17:00 Uhr
          alias: TBW und GWF Schwellwerte prüfen
        alias: Vergleiche Haus 23 gegen die anderen Häuser
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 23
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik23_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik25_bup_out
          state: 'off'
          for:
            hours: 5
            minutes: 0
            seconds: 0
          alias: Prüfen, ob BPU von Haus 25 seit mindestens 5 Stunden nicht läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: or
          conditions:
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 13 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 40% Hysterese Schwellwert von 13:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.7 ))|int
              \n and now().hour >= 11 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 30% Hysterese Schwellwert von 11:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.8 ))|int
              \n and now().hour >= 9 and now().hour <= 17) \n else false\n}}"
            alias: TBW tiefer als der 20% Hysterese Schwellwert von 09:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 7 and now().hour <= 17)\n else false\n}}"
            alias: TBW tiefer als der 10% Hysterese Schwellwert von 07:00 bis 17:00
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_25_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 10 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 10:00 bis 17:00 Uhr
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_25_all_ww_l_helper')|int
              >= 800 \n and now().hour >= 12 and now().hour <= 17)\n else false\n}}"
            alias: GWF Verbrauch über 800 Liter von 12:00 bis 17:00 Uhr
          alias: TBW und GWF Schwellwerte prüfen
        alias: Vergleiche Haus 25 gegen die anderen Häuser
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 25
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik25_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
    alias: Prüfen welches Haus das tiefste Brauchwasser hat und geladen werden soll
  trace:
    stored_traces: 72
  mode: parallel
  max: 4
- id: '1676725274240'
  alias: Ewl Tarifanpassung Tag-Nacht
  description: ''
  triggers:
  - entity_id:
    - schedule.ewl_zeitplan_nachttarif
    trigger: state
  - entity_id: sensor.energy_statistic_janitza_umg604_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 0
    trigger: numeric_state
  - entity_id: sensor.energy_statistic_janitza_umg604_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 0
    trigger: numeric_state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: schedule.ewl_zeitplan_nachttarif
      state: 'on'
    then:
    - data:
        value: '{{ states(''input_number.ewl_mixstrom_nachttarif'') }}'
      target:
        entity_id: input_number.ewl_mixstrom_aktueller_tarif
      action: input_number.set_value
    else:
    - if:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_janitza_umg604_w
        above: 0
      then:
      - data:
          value: '{{ (states(''input_number.ewl_mixstrom_tagestarif'')|float - 0.002)
            }}'
        target:
          entity_id: input_number.ewl_mixstrom_aktueller_tarif
        action: input_number.set_value
      else:
      - data:
          value: '{{ states(''input_number.ewl_mixstrom_tagestarif'') }}'
        target:
          entity_id: input_number.ewl_mixstrom_aktueller_tarif
        action: input_number.set_value
  mode: single
- id: '1676726511062'
  alias: Ewl Tarifanpassung Einspeisung-Überschuss
  description: ''
  triggers:
  - entity_id:
    - sensor.energy_statistic_janitza_umg604_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 0
    trigger: numeric_state
  - entity_id: sensor.energy_statistic_janitza_umg604_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 0
    trigger: numeric_state
  conditions: []
  actions:
  - if:
    - condition: numeric_state
      entity_id: sensor.energy_statistic_janitza_umg604_w
      above: 0
    then:
    - data:
        value: '{{ states(''input_number.ewl_einspeisung_eigenverbrauch'') }}'
      target:
        entity_id: input_number.ewl_einspeisung_aktueller_tarif
      action: input_number.set_value
    else:
    - data:
        value: '{{ states(''input_number.ewl_einspeisung_uberschuss'') }}'
      target:
        entity_id: input_number.ewl_einspeisung_aktueller_tarif
      action: input_number.set_value
  mode: single
- id: '1679809102622'
  alias: Monitoring Zaptec Charger Is Online Check
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.zaptec_pp_19_is_online
    - binary_sensor.zaptec_pp_24_is_online
    - binary_sensor.zaptec_pp_29_is_online
    - binary_sensor.zaptec_pp_33_is_online
    - binary_sensor.zaptec_pp_46_is_online
    - binary_sensor.zaptec_pp_65_is_online
    - binary_sensor.zaptec_pp_80_is_online
    - binary_sensor.zaptec_pp_85_is_online
    - binary_sensor.zaptec_pp_a3_is_online
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    from: 'on'
    trigger: state
  conditions: []
  actions:
  - data:
      title: 'HA-Alert Einstellhalle: Zaptec Station nicht Online'
      message: "PP 19 - {{ states('binary_sensor.zaptec_pp_19_is_online') }}  \nPP
        24 - {{ states('binary_sensor.zaptec_pp_24_is_online') }}  \nPP 29 - {{ states('binary_sensor.zaptec_pp_29_is_online')
        }}  \nPP 33 - {{ states('binary_sensor.zaptec_pp_33_is_online') }}  \nPP 46
        - {{ states('binary_sensor.zaptec_pp_46_is_online') }}  \nPP 65 - {{ states('binary_sensor.zaptec_pp_65_is_online')
        }} \nPP 80 - {{ states('binary_sensor.zaptec_pp_80_is_online') }} \nPP 85
        - {{ states('binary_sensor.zaptec_pp_85_is_online') }} \nPP A3 - {{ states('binary_sensor.zaptec_pp_a3_is_online')
        }} "
    action: notify.administrator_rotseepark
  mode: single
- id: '1684650231339'
  alias: Schalte WW - Setze WW Hysterese Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_19_ww_hysterese
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
            != states(''input_number.luxtronik_19_ww_hysterese'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - data:
          heatpump: 19
          value: '{{ states(''input_number.luxtronik_19_ww_hysterese'')|int }}'
        action: script.schalte_warmwasser_hysterese
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Hysterese gesetzt werden konnte
  - alias: Sende eine Benachrichtigung, wenn die Warmwasser Hysterese nicht gesetzt
      werden konnte
    if:
    - condition: template
      alias: NOT Parameter Warmwasser Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        != states(''input_number.luxtronik_19_ww_hysterese'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 19 Warmwasser Hysterese nicht gesetzt
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_19_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: WW Hysterese wurde
        auf {{ state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  trace:
    stored_traces: 10
  mode: queued
  max: 10
- id: '1684651141241'
  alias: Schalte WW - Setze WW Hysterese Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_21_ww_hysterese
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
            != states(''input_number.luxtronik_21_ww_hysterese'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - data:
          heatpump: 21
          value: '{{ states(''input_number.luxtronik_21_ww_hysterese'')|int }}'
        action: script.schalte_warmwasser_hysterese
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Hysterese gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        != states(''input_number.luxtronik_21_ww_hysterese'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 21 Warmwasser Hysterese nicht gesetzt
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_21_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Hysterese nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: WW Hysterese wurde
        auf {{ state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  trace:
    stored_traces: 10
  mode: queued
  max: 10
- id: '1684651171235'
  alias: Schalte WW - Setze WW Hysterese Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_23_ww_hysterese
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
            != states(''input_number.luxtronik_23_ww_hysterese'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - data:
          heatpump: 23
          value: '{{ states(''input_number.luxtronik_23_ww_hysterese'')|int }}'
        action: script.schalte_warmwasser_hysterese
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Hysterese gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        != states(''input_number.luxtronik_23_ww_hysterese'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 23 Warmwasser Hysterese nicht gesetzt
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_23_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Hysterese nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: WW Hysterese wurde
        auf {{ state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  trace:
    stored_traces: 10
  mode: queued
  max: 10
- id: '1684651249797'
  alias: Schalte WW - Setze WW Hysterese Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_25_ww_hysterese
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
            != states(''input_number.luxtronik_25_ww_hysterese'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - data:
          heatpump: 25
          value: '{{ states(''input_number.luxtronik_25_ww_hysterese'')|int }}'
        action: script.schalte_warmwasser_hysterese
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Hysterese gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        != states(''input_number.luxtronik_25_ww_hysterese'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 25 Warmwasser Hysterese nicht gesetzt
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_25_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_hysterese'')|int}}

          Warmwasser Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Hysterese nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: WW Hysterese wurde
        auf {{ state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''hotWaterTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  trace:
    stored_traces: 10
  mode: queued
  max: 10
- id: '1684651615000'
  alias: Schalte WW - Setze WW Solltemperatur Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_19_ww_solltemperatur
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Solltemperatur gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_temperature'']
            != states(''input_number.luxtronik_19_ww_solltemperatur'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 19
          value: '{{ states(''input_number.luxtronik_19_ww_solltemperatur'')|int }}'
        action: script.schalte_warmwasser_zieltemperatur
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_19_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Solltemperatur gesetzt werden konnte
  - alias: Sende eine Benachrichtigung, wenn die Warmwasser Solltemperatur nicht gesetzt
      werden konnte
    if:
    - condition: template
      alias: NOT Parameter Warmwasser Solltemperatur gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_temperature'']
        != states(''input_number.luxtronik_19_ww_solltemperatur'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 19 Warmwasser Solltemperatur nicht gesetzt
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_19_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Solltemperatur
          nicht gesetzt

          '
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: WW Solltemperatur
        wurde auf {{ state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_temperature'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: single
- id: '1684651659209'
  alias: Schalte WW - Setze WW Solltemperatur Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_21_ww_solltemperatur
    trigger: state
  conditions: []
  actions:
  - alias: Wiederhole, bis Parameter Warmwasser Solltemperatur gesetzt werden konnte
    repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Solltemperatur gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_temperature'']
            != states(''input_number.luxtronik_21_ww_solltemperatur'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 21
          value: '{{ states(''input_number.luxtronik_21_ww_solltemperatur'')|int }}'
        action: script.schalte_warmwasser_zieltemperatur
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_21_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
  - alias: Sende eine Benachrichtigung, wenn die Warmwasser Solltemperatur nicht gesetzt
      werden konnte
    if:
    - condition: template
      alias: NOT Parameter Warmwasser Solltemperatur gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_temperature'']
        != states(''input_number.luxtronik_21_ww_solltemperatur'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 21 Warmwasser Solltemperatur nicht gesetzt
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_21_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Solltemperatur
          nicht gesetzt

          '
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: WW Solltemperatur
        wurde auf {{ state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_temperature'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: single
- id: '1684651688114'
  alias: Schalte WW - Setze WW Solltemperatur Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_23_ww_solltemperatur
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Solltemperatur gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_temperature'']
            != states(''input_number.luxtronik_23_ww_solltemperatur'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 23
          value: '{{ states(''input_number.luxtronik_23_ww_solltemperatur'')|int }}'
        action: script.schalte_warmwasser_zieltemperatur
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_23_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Solltemperatur gesetzt werden konnte
  - alias: Sende eine Benachrichtigung, wenn die Warmwasser Solltemperatur nicht gesetzt
      werden konnte
    if:
    - condition: template
      alias: NOT Parameter Warmwasser Solltemperatur gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_temperature'']
        != states(''input_number.luxtronik_23_ww_solltemperatur'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 23 Warmwasser Solltemperatur nicht gesetzt
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_23_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Solltemperatur
          nicht gesetzt

          '
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: WW Solltemperatur
        wurde auf {{ state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_temperature'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: single
- id: '1684651715001'
  alias: Schalte WW - Setze WW Solltemperatur Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_25_ww_solltemperatur
    trigger: state
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Solltemperatur gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_temperature'']
            != states(''input_number.luxtronik_25_ww_solltemperatur'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 25
          value: '{{ states(''input_number.luxtronik_25_ww_solltemperatur'')|int }}'
        action: script.schalte_warmwasser_zieltemperatur
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_25_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Solltemperatur gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Solltemperatur gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_temperature'']
        != states(''input_number.luxtronik_25_ww_solltemperatur'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 25 Warmwasser Solltemperatur nicht gesetzt
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_25_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Solltemperatur
          nicht gesetzt

          '
        message: 'Warmwasser Temperatur Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_ww_solltemperatur'')|int}}

          Warmwasser Temperatur Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_temperature'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Solltemperatur nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: WW Solltemperatur
        wurde auf {{ state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_temperature'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: single
- id: '1684813307133'
  alias: Schalte HZ - Setze HZ Operation Mode Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_19_hz_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_19_hz_operation_mode
    trigger: state
    from: '4'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']
            != states(''input_select.luxtronik_19_hz_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 19
          value: '{{ states(''input_select.luxtronik_19_hz_operation_mode'')|int }}'
        action: script.schalte_heizung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_19_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Heizung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Heizung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']
        != states(''input_select.luxtronik_19_hz_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 19 Heizung Operation Mode nicht gesetzt
        message: 'Heizung Operation Mode Soll:  {{states(''input_select.luxtronik_19_hz_operation_mode'')|int}}

          Heizung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Heizung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1684813691132'
  alias: Schalte HZ - Setze HZ Operation Mode Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_21_hz_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_21_hz_operation_mode
    trigger: state
    from: '4'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']
            != states(''input_select.luxtronik_21_hz_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 21
          value: '{{ states(''input_select.luxtronik_21_hz_operation_mode'')|int }}'
        action: script.schalte_heizung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_21_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Heizung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Heizung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']
        != states(''input_select.luxtronik_21_hz_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 21 Heizung Operation Mode nicht gesetzt
        message: 'Heizung Operation Mode Soll:  {{states(''input_select.luxtronik_21_hz_operation_mode'')|int}}

          Heizung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Heizung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1684813733948'
  alias: Schalte HZ - Setze HZ Operation Mode Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_23_hz_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_23_hz_operation_mode
    trigger: state
    from: '4'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']
            != states(''input_select.luxtronik_23_hz_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 23
          value: '{{ states(''input_select.luxtronik_23_hz_operation_mode'')|int }}'
        action: script.schalte_heizung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_23_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Heizung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Heizung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']
        != states(''input_select.luxtronik_23_hz_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 23 Heizung Operation Mode nicht gesetzt
        message: 'Heizung Operation Mode Soll:  {{states(''input_select.luxtronik_23_hz_operation_mode'')|int}}

          Heizung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Heizung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1684813761728'
  alias: Schalte HZ - Setze HZ Operation Mode Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_25_hz_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_25_hz_operation_mode
    trigger: state
    from: '4'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']
            != states(''input_select.luxtronik_25_hz_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 25
          value: '{{ states(''input_select.luxtronik_25_hz_operation_mode'')|int }}'
        action: script.schalte_heizung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_25_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Heizung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Heizung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']
        != states(''input_select.luxtronik_25_hz_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 25 Heizung Operation Mode nicht gesetzt
        message: 'Heizung Operation Mode Soll:  {{states(''input_select.luxtronik_25_hz_operation_mode'')|int}}

          Heizung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Heizung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1684861404540'
  alias: Schalte WW - Produziere Warmwasser (Nachtmodus) - April bis September
  description: ''
  triggers:
  - alias: Time Pattern Trigger 22 Uhr alle 10 Minuten
    hours: '22'
    minutes: /10
    trigger: time_pattern
  - alias: Time Pattern Trigger 23 Uhr alle 10 Minuten
    hours: '23'
    minutes: /10
    trigger: time_pattern
  - alias: Time Pattern Trigger 0 Uhr alle 10 Minuten
    minutes: /10
    hours: '0'
    trigger: time_pattern
  - alias: Time Pattern Trigger 1 Uhr alle 10 Minuten
    hours: '1'
    minutes: /10
    trigger: time_pattern
  - alias: Time Pattern Trigger 2 Uhr alle 10 Minuten
    hours: '2'
    minutes: /10
    trigger: time_pattern
  - alias: Time Pattern Trigger 3 Uhr alle 10 Minuten
    hours: '3'
    minutes: /10
    trigger: time_pattern
  conditions:
  - condition: template
    value_template: "{{ true if ( \n  ((now().month >= 4 and now().month <= 9)) \n)
      else false }}"
    alias: Gültig vom April bis September
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    alias: Montag bis Samstag, weil am Sonntag die TDI ist
  actions:
  - alias: Prüfen welches Haus das tiefste Brauchwasser hat und geladen werden soll
    choose:
    - conditions:
      - alias: Vergleiche Haus 19 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 19 nicht in den letzten 4 Stunden gelaufen
            ist
          condition: state
          entity_id: binary_sensor.luxtronik19_bup_out
          state: 'off'
          for:
            hours: 4
            minutes: 0
            seconds: 0
          enabled: true
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: TBW - Hysterese Schwellwerte prüfen (Zeit, Forecast)
          condition: or
          conditions:
          - alias: TBW tiefer als der 40% Hysterese Schwellwert von 01:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 1 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 25% Hysterese Schwellwert von 00:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.75 ))|int
              \n and now().hour >= 0 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 10% Hysterese Schwellwert von 23:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 23 and now().hour <= 4)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik19_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.4 ))|int
              \n and now().hour >= 2 and now().hour <= 4\n and states('sensor.forecast_solar_production_production_today')|int
              < 200) \n else false\n}}\n"
            alias: TBW tiefer als der 60% Hysterese Schwellwert von 02:00 bis 04:00
              UND Solar Forecast < 200 kWh
          - alias: GWF Verbrauch über 1500 Liter von 00:00 bis 02:00 Uhr
            condition: template
            value_template: "{{ true if (states('sensor.gwf_19_all_ww_l_helper')|int
              >= 1500 \n and now().hour >= 0 and now().hour <= 2)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_19_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 1 and now().hour <= 4)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 01:00 bis 04:00 Uhr
          - alias: Bedingungslose Ladung ab 01:00 Uhr von 15. Oktober bis Ende Februar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 10 and now().day > 14)
              or now().month > 10 or now().month < 3)\n  and now().hour >= 1 and now().hour
              <= 4\n) else false }}"
          - alias: Bedingungslose Ladung ab 00:00 Uhr von 15. Dezember bis 15. Januar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 12 and now().day > 14)
              or (now().month < 2 and now().day < 16))\n  and now().hour >= 0 and
              now().hour <= 4\n) else false }}"
      sequence:
      - condition: template
        value_template: '{{ ((states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
          - 1 )|int) < 30 }}'
        alias: Die gerechnete Hysterese muss < 30 sein, denn sonst geht die WP schon
          selbst an
      - data:
          title: HA-Info Rotseepark - Nacht Tarif Prüfung erfolgreich -> Haus 19 gewält
          message: 'TBW aktuell: {{states(''sensor.luxtronik19_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 21 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 21 nicht in den letzten 4 Stunden gelaufen
            ist
          condition: state
          entity_id: binary_sensor.luxtronik21_bup_out
          state: 'off'
          for:
            hours: 4
            minutes: 0
            seconds: 0
          enabled: true
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: TBW - Hysterese Schwellwerte prüfen (Zeit, Forecast)
          condition: or
          conditions:
          - alias: TBW tiefer als der 40% Hysterese Schwellwert von 01:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 1 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 25% Hysterese Schwellwert von 00:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.75 ))|int
              \n and now().hour >= 0 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 10% Hysterese Schwellwert von 23:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 23 and now().hour <= 4)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik21_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.4 ))|int
              \n and now().hour >= 2 and now().hour <= 4\n and states('sensor.forecast_solar_production_production_today')|int
              < 200) \n else false\n}}\n"
            alias: TBW tiefer als der 60% Hysterese Schwellwert von 02:00 bis 04:00
              UND Solar Forecast < 200 kWh
          - alias: GWF Verbrauch über 1500 Liter von 00:00 bis 02:00 Uhr
            condition: template
            value_template: "{{ true if (states('sensor.gwf_21_all_ww_l_helper')|int
              >= 1500 \n and now().hour >= 0 and now().hour <= 2)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_21_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 1 and now().hour <= 4)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 01:00 bis 04:00 Uhr
          - alias: Bedingungslose Ladung ab 01:00 Uhr von 15. Oktober bis Ende Februar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 10 and now().day > 14)
              or now().month > 10 or now().month < 3)\n  and now().hour >= 1 and now().hour
              <= 4\n) else false }}"
          - alias: Bedingungslose Ladung ab 00:00 Uhr von 15. Dezember bis 15. Januar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 12 and now().day > 14)
              or (now().month < 2 and now().day < 16))\n  and now().hour >= 0 and
              now().hour <= 4\n) else false }}"
      sequence:
      - condition: template
        value_template: '{{ ((states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
          - 1 )|int) < 30 }}'
        alias: Die gerechnete Hysterese muss < 30 sein, denn sonst geht die WP schon
          selbst an
      - data:
          title: HA-Info Rotseepark - Nacht Tarif Prüfung erfolgreich -> Haus 21 gewält
          message: 'TBW aktuell: {{states(''sensor.luxtronik21_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 23 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 23 nicht in den letzten 4 Stunden gelaufen
            ist
          condition: state
          entity_id: binary_sensor.luxtronik23_bup_out
          state: 'off'
          for:
            hours: 4
            minutes: 0
            seconds: 0
          enabled: true
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: TBW - Hysterese Schwellwerte prüfen (Zeit, Forecast)
          condition: or
          conditions:
          - alias: TBW tiefer als der 40% Hysterese Schwellwert von 01:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 1 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 25% Hysterese Schwellwert von 00:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.75 ))|int
              \n and now().hour >= 0 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 10% Hysterese Schwellwert von 23:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 23 and now().hour <= 4)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik23_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.4 ))|int
              \n and now().hour >= 2 and now().hour <= 4\n and states('sensor.forecast_solar_production_production_today')|int
              < 200) \n else false\n}}\n"
            alias: TBW tiefer als der 60% Hysterese Schwellwert von 02:00 bis 04:00
              UND Solar Forecast < 200 kWh
          - alias: GWF Verbrauch über 1500 Liter von 00:00 bis 02:00 Uhr
            condition: template
            value_template: "{{ true if (states('sensor.gwf_23_all_ww_l_helper')|int
              >= 1500 \n and now().hour >= 0 and now().hour <= 2)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_23_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 1 and now().hour <= 4)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 01:00 bis 04:00 Uhr
          - alias: Bedingungslose Ladung ab 01:00 Uhr von 15. Oktober bis Ende Februar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 10 and now().day > 14)
              or now().month > 10 or now().month < 3)\n  and now().hour >= 1 and now().hour
              <= 4\n) else false }}"
          - alias: Bedingungslose Ladung ab 00:00 Uhr von 15. Dezember bis 15. Januar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 12 and now().day > 14)
              or (now().month < 2 and now().day < 16))\n  and now().hour >= 0 and
              now().hour <= 4\n) else false }}"
      sequence:
      - condition: template
        value_template: '{{ ((states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
          - 1 )|int) < 30 }}'
        alias: Die gerechnete Hysterese muss < 30 sein, denn sonst geht die WP schon
          selbst an
      - data:
          title: HA-Info Rotseepark - Nacht Tarif Prüfung erfolgreich -> Haus 23 gewält
          message: 'TBW aktuell: {{states(''sensor.luxtronik23_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 25 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 25 nicht in den letzten 4 Stunden gelaufen
            ist
          condition: state
          entity_id: binary_sensor.luxtronik25_bup_out
          state: 'off'
          for:
            hours: 4
            minutes: 0
            seconds: 0
          enabled: true
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - alias: TBW - Hysterese Schwellwerte prüfen (Zeit, Forecast)
          condition: or
          conditions:
          - alias: TBW tiefer als der 40% Hysterese Schwellwert von 01:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.6 ))|int
              \n and now().hour >= 1 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 25% Hysterese Schwellwert von 00:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.75 ))|int
              \n and now().hour >= 0 and now().hour <= 4) \n else false\n}}"
          - alias: TBW tiefer als der 10% Hysterese Schwellwert von 23:00 bis 04:00
            condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.9 ))|int
              \n and now().hour >= 23 and now().hour <= 4)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.luxtronik25_tbw')|int < (states('input_number.luxtronik_ww_normaltemperatur')|int
              - (states('input_number.luxtronik_ww_normalhysterese')|int * 0.4 ))|int
              \n and now().hour >= 2 and now().hour <= 4\n and states('sensor.forecast_solar_production_production_today')|int
              < 200) \n else false\n}}\n"
            alias: TBW tiefer als der 60% Hysterese Schwellwert von 02:00 bis 04:00
              UND Solar Forecast < 200 kWh
          - alias: GWF Verbrauch über 1500 Liter von 00:00 bis 02:00 Uhr
            condition: template
            value_template: "{{ true if (states('sensor.gwf_25_all_ww_l_helper')|int
              >= 1500 \n and now().hour >= 0 and now().hour <= 2)\n else false\n}}"
          - condition: template
            value_template: "{{ true if (states('sensor.gwf_25_all_ww_l_helper')|int
              >= 1200 \n and now().hour >= 1 and now().hour <= 4)\n else false\n}}"
            alias: GWF Verbrauch über 1200 Liter von 01:00 bis 04:00 Uhr
          - alias: Bedingungslose Ladung ab 01:00 Uhr von 15. Oktober bis Ende Februar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 10 and now().day > 14)
              or now().month > 10 or now().month < 3)\n  and now().hour >= 1 and now().hour
              <= 4\n) else false }}"
          - alias: Bedingungslose Ladung ab 00:00 Uhr von 15. Dezember bis 15. Januar
            condition: template
            value_template: "{{ true if (\n  ((now().month == 12 and now().day > 14)
              or (now().month < 2 and now().day < 16))\n  and now().hour >= 0 and
              now().hour <= 4\n) else false }}"
      sequence:
      - condition: template
        value_template: '{{ ((states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
          - 1 )|int) < 30 }}'
        alias: Die gerechnete Hysterese muss < 30 sein, denn sonst geht die WP schon
          selbst an
      - data:
          title: HA-Info Rotseepark - Nacht Tarif Prüfung erfolgreich -> Haus 25 gewält
          message: 'TBW aktuell: {{states(''sensor.luxtronik25_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
  trace:
    stored_traces: 40
  mode: single
- id: '1690825016699'
  alias: Schalte Tor - Einstellhalle Freigabe zur Öffnung und Schliessung
  description: ''
  triggers:
  - event: sunset
    offset: 00:30:00
    enabled: true
    trigger: sun
  - at: 07:00:00
    trigger: time
  - at: '19:00:00'
    trigger: time
  conditions:
  - condition: time
    weekday:
    - fri
    - thu
    - wed
    - tue
    - mon
    after: 06:55:00
    before: '19:05:00'
  - condition: state
    entity_id: calendar.schweiz_lu
    state: 'off'
  - condition: state
    entity_id: calendar.rotseepark_kalender_feiertage_plus
    state: 'off'
  actions:
  - if:
    - condition: time
      after: 06:55:00
      before: 07:05:00
    then:
    - condition: or
      conditions:
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: unavailable
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: unknown
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: 'off'
    - repeat:
        sequence:
        - continue_on_error: true
          target:
            entity_id: switch.shelly_hobler_tor_switch_0
          data: {}
          action: switch.turn_on
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
        while:
        - condition: state
          entity_id: switch.shelly_hobler_tor_switch_0
          state:
          - 'off'
          - unavailable
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Einstellhalle: Offenhaltung
          Tor wurde aktiviert <div style="display: none">technical</div>'
      enabled: true
    else:
    - condition: or
      conditions:
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: unavailable
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: unknown
      - condition: state
        entity_id: switch.shelly_hobler_tor_switch_0
        state: 'on'
    - repeat:
        sequence:
        - continue_on_error: true
          target:
            entity_id:
            - switch.shelly_hobler_tor_switch_0
          data: {}
          action: switch.turn_off
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
        while:
        - condition: state
          entity_id: switch.shelly_hobler_tor_switch_0
          state:
          - 'on'
          - unavailable
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Einstellhalle: Offenhaltung
          Tor wurde deaktiviert <div style="display: none">technical</div>'
      enabled: true
  mode: single
- id: '1691037394505'
  alias: Schalte HZ - Heizung Umwälzpumpe abhängig Entgasung
  description: ''
  triggers:
  - entity_id:
    - sensor.average_shelly_box_haus_19_switch_0_power_w
    above: 15
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_19_switch_0_power_w
    below: 15
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_21_switch_0_power_w
    above: 15
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_21_switch_0_power_w
    below: 15
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_23_switch_0_power_w
    above: 15
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_23_switch_0_power_w
    below: 15
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_25_switch_0_power_w
    above: 15
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: numeric_state
  - entity_id: sensor.average_shelly_box_haus_25_switch_0_power_w
    below: 15
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
  conditions: []
  actions:
  - if:
    - condition: numeric_state
      entity_id: sensor.average_shelly_box_haus_19_switch_0_power_w
      above: 15
    then:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_19_switch_1
      action: switch.turn_on
    else:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_19_switch_1
      action: switch.turn_off
  - if:
    - condition: numeric_state
      entity_id: sensor.average_shelly_box_haus_21_switch_0_power_w
      above: 15
    then:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_21_switch_1
      action: switch.turn_on
    else:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_21_switch_1
      action: switch.turn_off
  - if:
    - condition: numeric_state
      entity_id: sensor.average_shelly_box_haus_23_switch_0_power_w
      above: 15
    then:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_23_switch_1
      action: switch.turn_on
    else:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_23_switch_1
      action: switch.turn_off
  - if:
    - condition: numeric_state
      entity_id: sensor.average_shelly_box_haus_25_switch_0_power_w
      above: 15
    then:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_25_switch_1
      action: switch.turn_on
    else:
    - data: {}
      target:
        entity_id:
        - switch.shelly_box_haus_25_switch_1
      action: switch.turn_off
  mode: single
- id: '1691358016187'
  alias: Monitoring Shelly H&T Feuchtigkeit, Temperatur, Batterie und Netzwerk
  description: ''
  triggers:
  - hours: /4
    trigger: time_pattern
  - entity_id:
    - device_tracker.shelly_h_t_haus_19
    - device_tracker.shelly_h_t_haus_19
    - device_tracker.shelly_h_t_haus_23
    - device_tracker.shelly_h_t_haus_25
    to:
    - not_home
    - unavailable
    - unknown
    for:
      hours: 4
      minutes: 0
      seconds: 0
    trigger: state
  - entity_id: sensor.shelly_h_and_t_haus_19_humidity
    above: 60
    trigger: numeric_state
  - entity_id:
    - sensor.shelly_h_and_t_haus_21_humidity
    above: 60
    trigger: numeric_state
    enabled: false
  - entity_id: sensor.shelly_h_and_t_haus_23_humidity
    above: 60
    trigger: numeric_state
  - entity_id: sensor.shelly_h_and_t_haus_25_humidity
    above: 60
    trigger: numeric_state
  - entity_id: sensor.shelly_h_and_t_haus_19_temperature
    above: 28
    trigger: numeric_state
  - entity_id:
    - sensor.shelly_h_and_t_haus_21_temperature
    above: 28
    trigger: numeric_state
    enabled: false
  - entity_id: sensor.shelly_h_and_t_haus_23_temperature
    above: 28
    trigger: numeric_state
  - entity_id: sensor.shelly_h_and_t_haus_25_temperature
    above: 28
    trigger: numeric_state
  - entity_id: sensor.shelly_h_and_t_haus_19_absolute_feuchte
    above: 14
    trigger: numeric_state
  - entity_id:
    - sensor.shelly_h_and_t_haus_21_absolute_feuchte
    above: 14
    trigger: numeric_state
    enabled: false
  - entity_id: sensor.shelly_h_and_t_haus_23_absolute_feuchte
    above: 14
    trigger: numeric_state
  - entity_id: sensor.shelly_h_and_t_haus_25_absolute_feuchte
    above: 14
    trigger: numeric_state
  conditions:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_humidity
      below: 30
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_humidity
      below: 30
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_humidity
      below: 30
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_humidity
      below: 30
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_humidity
      above: 60
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_humidity
      above: 60
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_humidity
      above: 60
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_humidity
      above: 60
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_temperature
      below: 17
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_temperature
      below: 17
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_temperature
      below: 17
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_temperature
      below: 17
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_temperature
      above: 28
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_temperature
      above: 28
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_temperature
      above: 28
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_temperature
      above: 28
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_absolute_feuchte
      below: 5
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_absolute_feuchte
      below: 5
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_absolute_feuchte
      below: 5
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_absolute_feuchte
      below: 5
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_absolute_feuchte
      above: 14
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_absolute_feuchte
      above: 14
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_absolute_feuchte
      above: 14
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_absolute_feuchte
      above: 14
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_19_battery
      below: 10
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_21_battery
      below: 10
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_23_battery
      below: 10
      enabled: false
    - condition: numeric_state
      entity_id: sensor.shelly_h_and_t_haus_25_battery
      below: 10
      enabled: false
    - condition: state
      entity_id: device_tracker.shelly_h_t_haus_19
      state:
      - not_home
      - unavailable
      - unknown
      for:
        hours: 4
        minutes: 0
        seconds: 0
      enabled: false
    - condition: state
      entity_id: device_tracker.shelly_h_t_haus_21
      state:
      - not_home
      - unavailable
      - unknown
      for:
        hours: 4
        minutes: 0
        seconds: 0
      enabled: false
    - condition: state
      entity_id: device_tracker.shelly_h_t_haus_23
      state:
      - not_home
      - unavailable
      - unknown
      for:
        hours: 4
        minutes: 0
        seconds: 0
      enabled: false
    - condition: state
      entity_id: device_tracker.shelly_h_t_haus_25
      state:
      - not_home
      - unavailable
      - unknown
      for:
        hours: 4
        minutes: 0
        seconds: 0
      enabled: false
  actions:
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Alert Heizungsraum: Shelly H&T prüfen'
      message: "IST-Werte sind ...\nRelative Feuchte ... (OK = 30 bis 60% rfH)\nHaus
        19 - {{ states('sensor.shelly_h_and_t_haus_19_humidity') }} % rfH\nHaus 21
        - {{ states('sensor.shelly_h_and_t_haus_21_humidity') }} % rfH\nHaus 23 -
        {{ states('sensor.shelly_h_and_t_haus_23_humidity') }} % rfH\nHaus 25 - {{
        states('sensor.shelly_h_and_t_haus_25_humidity') }} % rfH\nTemperatur ...
        (OK = 17 bis 28 °C)\nHaus 19 - {{ states('sensor.shelly_h_and_t_haus_19_temperature')
        }} °C\nHaus 21 - {{ states('sensor.shelly_h_and_t_haus_21_temperature') }}
        °C\nHaus 23 - {{ states('sensor.shelly_h_and_t_haus_23_temperature') }} °C\nHaus
        25 - {{ states('sensor.shelly_h_and_t_haus_25_temperature') }} °C\nAbsolute
        Feuchte ... (OK = 5 bis 14 g/m³)\nHaus 19 - {{ states('sensor.shelly_h_and_t_haus_19_absolute_feuchte')
        }} g/m³\nHaus 21 - {{ states('sensor.shelly_h_and_t_haus_21_absolute_feuchte')
        }} g/m³\nHaus 23 - {{ states('sensor.shelly_h_and_t_haus_23_absolute_feuchte')
        }} g/m³\nHaus 25 - {{ states('sensor.shelly_h_and_t_haus_25_absolute_feuchte')
        }} g/m³\nBatteriezustand ... (OK = 10 - 100 %)\nHaus 19 - {{ states('sensor.shelly_h_and_t_haus_19_battery')
        }}%\nHaus 21 - {{ states('sensor.shelly_h_and_t_haus_21_battery') }}%  \nHaus
        23 - {{ states('sensor.shelly_h_and_t_haus_23_battery') }}%  \nHaus 25 - {{
        states('sensor.shelly_h_and_t_haus_25_battery') }}%  \nNetzwerk ... (normalerweise
        not_home, da nur alle 2h Online)\nHaus 19 - {{ states('device_tracker.shelly_h_t_haus_19')
        }}\nHaus 21 - {{ states('device_tracker.shelly_h_t_haus_21') }}\nHaus 23 -
        {{ states('device_tracker.shelly_h_t_haus_23') }}\nHaus 25 - {{ states('device_tracker.shelly_h_t_haus_25')
        }}"
  mode: single
- id: '1691471382318'
  alias: Monitoring Netatmo Keller Feuchtigkeit, Temperatur, Batterie
  description: ''
  triggers:
  - hours: /1
    trigger: time_pattern
  conditions: []
  actions:
  - alias: Prüfen ob Abweichungen in den Soll Werten Temperatur und Feuchte -> dann
      Mitteilung
    if:
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_humidity
        below: 40
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_humidity
        below: 40
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_humidity
        above: 62
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_humidity
        above: 60
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_temperature
        below: 9
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_temperature
        below: 9
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_temperature
        above: 22
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_temperature
        above: 22
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_absolute_feuchte
        below: 4
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_absolute_feuchte
        below: 4
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_gang_absolute_feuchte
        above: 11
      - condition: numeric_state
        entity_id: sensor.netatmo_keller_buhler_absolute_feuchte
        above: 11
    then:
    - data:
        title: 'HA-Alert Kellerräume: Luftfeuchtigkeit Keller prüfen'
        message: 'IST-Werte sind ... (Outdoor ist nicht geprüft)


          Relative Feuchte ... (40 - 60 % (Bühler) 62 % (Gang) rfH)

          Gang    - {{ states(''sensor.netatmo_keller_gang_humidity'') }} % rfH

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_humidity'') }} % rfH

          Outdoor - {{ states(''sensor.netatmo_outdoor_humidity'') }} % rfH

          Temperatur ... (9 - 22 °C)

          Gang    - {{ states(''sensor.netatmo_keller_gang_temperature'') }} °C

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_temperature'') }} °C

          Outdoor - {{ states(''sensor.netatmo_outdoor_temperature'') }} °C

          Absolute Feuchte ... (4 - 11 g/m³)

          Gang    - {{ states(''sensor.netatmo_keller_gang_absolute_feuchte'') }}
          g/m³

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_absolute_feuchte'') }}
          g/m³

          Outdoor - {{ states(''sensor.netatmo_outdoor_absolute_feuchte'') }} g/m³

          '
      action: notify.administrator_rotseepark
      enabled: false
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Kellerräume: Luftfeuchtigkeit Keller prüfen'
        message: 'IST-Werte sind ... (Outdoor ist nicht geprüft)


          Relative Feuchte ... (40 - 60 % (Bühler) 62 % (Gang) rfH)

          Gang    - {{ states(''sensor.netatmo_keller_gang_humidity'') }} % rfH

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_humidity'') }} % rfH

          Outdoor - {{ states(''sensor.netatmo_outdoor_humidity'') }} % rfH

          Temperatur ... (9 - 22 °C)

          Gang    - {{ states(''sensor.netatmo_keller_gang_temperature'') }} °C

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_temperature'') }} °C

          Outdoor - {{ states(''sensor.netatmo_outdoor_temperature'') }} °C

          Absolute Feuchte ... (4 - 11 g/m³)

          Gang    - {{ states(''sensor.netatmo_keller_gang_absolute_feuchte'') }}
          g/m³

          Bühler  - {{ states(''sensor.netatmo_keller_buhler_absolute_feuchte'') }}
          g/m³

          Outdoor - {{ states(''sensor.netatmo_outdoor_absolute_feuchte'') }} g/m³

          '
  - alias: Prüfen ob Lüftung zu wenig Strom verbraucht -> dann Mitteilung
    if:
    - condition: template
      value_template: "{{ \n  (\n   (now().hour > 22 or now().hour < 8)\n   and states('sensor.gplugde_haus_21_luftung_meter_wirkleistung_cons_w')|float
        < 1000\n  )\n  or\n  (\n   (now().hour > 1 and now().hour < 6)\n   and states('sensor.gplugde_haus_21_luftung_meter_wirkleistung_cons_w')|float
        < 1000\n  )\n}}"
    then:
    - data:
        title: 'HA-Alert Kellerräume: Stromverbrauch der Lüftung ist zu tief (läuft
          sie nicht?)'
        message: 'Lärmpegel ... (mindestens 1000 W)

          gPlugDE  - {{ states(''sensor.gplugde_haus_21_luftung_meter_wirkleistung_cons_w'')
          }} W

          Stunde  - {{ now().hour }}'
      action: notify.administrator_rotseepark
      enabled: false
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Kellerräume: Stromverbrauch der Lüftung ist zu tief (läuft
          sie nicht?)'
        message: 'Lärmpegel ... (mindestens 1000 W)

          gPlugDE  - {{ states(''sensor.gplugde_haus_21_luftung_meter_wirkleistung_cons_w'')
          }} W

          Stunde  - {{ now().hour }}'
  - alias: Prüfen ob Abweichungen in den Soll Werten Batterie -> dann Mitteilung
    if:
    - condition: and
      conditions:
      - condition: template
        value_template: "{{ \n  (\n   (now().hour == 8)\n  )\n}}"
        alias: Wenn es 8 Uhr ist
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.netatmo_keller_gang_battery_percent
          below: 10
        - condition: numeric_state
          entity_id: sensor.netatmo_outdoor_battery_percent
          below: 10
      alias: 8 Uhr und Batterie und 10
    then:
    - data:
        title: 'HA-Alert Kellerräume: Netatmo Batterie Keller prüfen'
        message: 'Batteriezustand ... (10% - 90%)

          Gang    - {{ states(''sensor.netatmo_keller_gang_battery_percent'') }}%

          Outdoor - {{ states(''sensor.netatmo_outdoor_battery_percent'') }}%  '
      action: notify.administrator_rotseepark
      enabled: false
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Kellerräume: Netatmo Batterie Keller prüfen'
        message: 'Batteriezustand ... (10% - 90%)

          Gang    - {{ states(''sensor.netatmo_keller_gang_battery_percent'') }}%

          Outdoor - {{ states(''sensor.netatmo_outdoor_battery_percent'') }}%  '
  mode: single
- id: '1692770037460'
  alias: Monitoring Heatpump 21 - Brauchwasser Erzeugung Energie Verbrauch
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.luxtronik21_bup
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.luxtronik21_bup
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Boiler Ladung
          wurde gestartet'
    - target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_21
      data: {}
      action: input_boolean.turn_on
    - variables:
        ts_bup_start: '{{ now() }}'
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.heatpump_21_ww_power_consumption_helper
        - sensor.gwf_21_hz_ug_kw_helper
      alias: Zurücksetzen der Utility Meter für Warmwasser Erzeugung kW und Stromverbrauch
      action: utility_meter.calibrate
    - delay:
        hours: 0
        minutes: 10
        seconds: 0
        milliseconds: 0
    - data:
        value: '{{ states(''sensor.luxtronik21_tbw'')|float }}'
      target:
        entity_id: input_number.luxtronik_21_tbw_degc_helper
      alias: Speichere die aktuelle Brauchwasser Temperatur
      action: input_number.set_value
    - variables:
        ts_btw_low_ende: '{{ now() }}'
        c_btw_low: '{{ states(''sensor.luxtronik21_tbw'') }}'
        diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
          }}'
        diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start, ''%Y-%m-%d
          %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
    - alias: Wiederhole 30 mal 1 Minute, während sicher Brauchwasser Temperatur verändert
      repeat:
        count: 30
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(''input_number.luxtronik_21_tbw_degc_helper'')|float
              >= states(''sensor.luxtronik21_tbw'')|float }}'
          then:
          - data:
              value: '{{ states(''sensor.luxtronik21_tbw'')|float }}'
            target:
              entity_id: input_number.luxtronik_21_tbw_degc_helper
            alias: Speichere die aktuelle Brauchwasser Temperatur
            action: input_number.set_value
          - variables:
              ts_btw_low_ende: '{{ now() }}'
              c_btw_low: '{{ states(''sensor.luxtronik21_tbw'') }}'
              diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
                }}'
              diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start,
                ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_bup
        state: 'on'
      then:
      - wait_for_trigger:
        - entity_id:
          - binary_sensor.luxtronik21_bup
          from: 'on'
          to: 'off'
          trigger: state
      alias: Warten bis Brauchwasser Produktion endet
    - variables:
        ts_bup_ende: '{{ now() }}'
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Boiler Ladung
          wurde beendet (Verbrauch: {{states(''sensor.heatpump_21_ww_power_consumption_helper'')|float
          }} kWh, Laufzeit: {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }})'
    - variables:
        pumpen_kw: '{{  (  ( 1000/1000/60* ( strptime(ts_bup_ende, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp()  -
          strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp() )/60 )|round(1)  )
          }}'
      alias: Variablen pumpen_kw definieren (Hochrechnung kW Bedarf der Pumpen)
    - variables:
        btw_lowdiff: '{{ (( states(''input_number.luxtronik_21_ww_solltemperatur'')|float
          )-(c_btw_low)|float+(5/60*(diff_btw_lowminute)|float))|round(1) }}'
      alias: Variablen btw_lowdiff definieren (Tiefste berechnete Temperatur)
    - variables:
        esti_kw_b: '{{  ((4400/4*3/1000)*1.16*btw_lowdiff)|round(1)  }}'
      alias: Variablen esti_kw_b definieren (Hochrechnung kW Bedarf btw und Umwälzvolumen)
    - data:
        value: '{{ 0 if is_state(''sensor.heatpump_21_ww_power_consumption_helper'',
          ''unknown'')  else states(''sensor.heatpump_21_ww_power_consumption_helper'')|float}}'
      target:
        entity_id: input_number.heatpump_21_ww_power_consumption_helper
      alias: Speichere den Strom Verbrauch von dieser Ladung
      action: input_number.set_value
    - wait_for_trigger:
      - hours: '*'
        minutes: '0'
        trigger: time_pattern
      alias: Warten bis zur nächsten vollen Stunde
    - variables:
        ts_gwf_ende: '{{ now() }}'
    - data:
        value: '{{ states(''sensor.gwf_21_all_ww_l_helper'')|float }}'
      target:
        entity_id: input_number.gwf_21_ww_l_helper
      alias: Speichere den Warmwasserverbrauch seit der letzten Ladung
      action: input_number.set_value
    - variables:
        esti_kw_a: '{{  ((states(''input_number.gwf_21_ww_l_helper'')|float)/1000*1.16*
          (states(''input_number.luxtronik_21_ww_solltemperatur'')|float-14))|round(1)  }}'
      alias: Variablen esti_kw_a definieren (Hochrechnung kW Bedarf anhand l Verbrauch
        GWF)
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.gwf_21_all_ww_l_helper
      alias: Zurücksetzen der Utility Meter für Warmwasserverbrauch
      action: utility_meter.calibrate
    - data:
        value: '{{ states(''sensor.gwf_21_hz_ug_kw_helper'')|float }}'
      target:
        entity_id: input_number.gwf_21_hz_ug_kw_helper
      alias: Speichere den Kilowatt Verbrauch von dieser Ladung
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_a|float }}'
      target:
        entity_id: input_number.bwm21_variable_esti_kw_a
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_b|float }}'
      target:
        entity_id: input_number.bwm21_variable_esti_kw_b
      action: input_number.set_value
    - data:
        title: 'HA-Info Heatpump 21: Die Boiler Ladung ist beendet in {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }}'
        message: "*** Ablaufzeiten ***\nBUP Start   - {{ ts_bup_start }} \nBTW Low
          End - {{ ts_btw_low_ende }} \nBUP End     - {{ ts_bup_ende }} \nGWF End
          \    - {{ ts_gwf_ende }} \n*** Low Temperatur ermitteln ***\nBTW Low     -
          {{ c_btw_low }} Tiefpunkt Brauchwasser Temperatur\nBTW LowT    - {{ diff_btw_lowtime
          }} Zeitdauer von Start bis Tiefpunkt\nBTW LowM    - {{ diff_btw_lowminute
          }} Minuten von Start bis Tiefpunkt\nBTW LowDiff - {{ btw_lowdiff }} Differenz
          Tiefpunkt BW zu Soll\n*** Stromverbrauch Wärmepumpe ***\nStrom kW    - {{
          states('input_number.heatpump_21_ww_power_consumption_helper')|round(1)
          }} kW Verbrauch ganze Anlage\nPumpen kW   - {{ pumpen_kw }} System kW durch
          Pumpen\nNetto kW WP - {{ (states('input_number.heatpump_21_ww_power_consumption_helper')
          |float - pumpen_kw)|round(1) }} Netto kW von Wärmepumpe\n*** Warmwasser
          Verbrauch ***\nl WW       - {{ states('input_number.gwf_21_ww_l_helper')
          }} l seit letzter Ladung\n*** kW Hochrechnungen und GWF Zähler VL/RL ***\nEsti
          kW A   - {{ esti_kw_a }} kW anhand l Verbrauch\nEsti kW B   - {{ esti_kw_b
          }} kW anhand btw low und Umwälzvolumen\nVL/RL kW    - {{ states('input_number.gwf_21_hz_ug_kw_helper')
          }} kW Energie im VL/RL entnommen\n*** Errechnete Wirkungsgrade ***\nWG Platte
          \  - {{ (((esti_kw_a + esti_kw_b)/2)/ states('input_number.gwf_21_hz_ug_kw_helper')|float*100)|round(0)
          }}% Wirkungsgrad Plattentauscher\nWG Faktor   - {{ ((states('input_number.gwf_21_hz_ug_kw_helper')|float)
          /(states('input_number.heatpump_21_ww_power_consumption_helper')|float  -
          pumpen_kw))|round(1) }} Faktor Wärme VL/RL versus kW Verdichter"
      action: notify.administrator_rotseepark
    else:
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_21
      action: input_boolean.turn_off
  mode: parallel
  max: 2
- id: '1693137410563'
  alias: System Startup Automation (Install apk)
  description: ''
  triggers:
  - event: start
    trigger: homeassistant
  conditions: []
  actions:
  - data: {}
    action: shell_command.setup_apk
  mode: single
- id: '1694292079482'
  alias: Monitoring Heatpump 25 - Brauchwasser Erzeugung Energie Verbrauch
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.luxtronik25_bup
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.luxtronik25_bup
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Boiler Ladung
          wurde gestartet'
    - target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_25
      data: {}
      action: input_boolean.turn_on
    - variables:
        ts_bup_start: '{{ now() }}'
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.heatpump_25_ww_power_consumption_helper
        - sensor.gwf_25_hz_ug_kw_helper
      alias: Zurücksetzen der Utility Meter für Warmwasser Erzeugung kW und Stromverbrauch
      action: utility_meter.calibrate
    - delay:
        hours: 0
        minutes: 10
        seconds: 0
        milliseconds: 0
    - data:
        value: '{{ states(''sensor.luxtronik25_tbw'')|float }}'
      target:
        entity_id: input_number.luxtronik_25_tbw_degc_helper
      alias: Speichere die aktuelle Brauchwasser Temperatur
      action: input_number.set_value
    - variables:
        ts_btw_low_ende: '{{ now() }}'
        c_btw_low: '{{ states(''sensor.luxtronik25_tbw'') }}'
        diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
          }}'
        diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start, ''%Y-%m-%d
          %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
    - alias: Wiederhole 30 mal 1 Minute, während sicher Brauchwasser Temperatur verändert
      repeat:
        count: 30
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(''input_number.luxtronik_25_tbw_degc_helper'')|float
              >= states(''sensor.luxtronik25_tbw'')|float }}'
          then:
          - data:
              value: '{{ states(''sensor.luxtronik25_tbw'')|float }}'
            target:
              entity_id: input_number.luxtronik_25_tbw_degc_helper
            alias: Speichere die aktuelle Brauchwasser Temperatur
            action: input_number.set_value
          - variables:
              ts_btw_low_ende: '{{ now() }}'
              c_btw_low: '{{ states(''sensor.luxtronik25_tbw'') }}'
              diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
                }}'
              diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start,
                ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_bup
        state: 'on'
      then:
      - wait_for_trigger:
        - entity_id:
          - binary_sensor.luxtronik25_bup
          from: 'on'
          to: 'off'
          trigger: state
      alias: Warten bis Brauchwasser Produktion endet
    - variables:
        ts_bup_ende: '{{ now() }}'
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Boiler Ladung
          wurde beendet (Verbrauch: {{states(''sensor.heatpump_25_ww_power_consumption_helper'')|float
          }} kWh, Laufzeit: {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }})'
    - variables:
        pumpen_kw: '{{  (  ( 1000/1000/60* ( strptime(ts_bup_ende, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp()  -
          strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp() )/60 )|round(1)  )
          }}'
      alias: Variablen pumpen_kw definieren (Hochrechnung kW Bedarf der Pumpen)
    - variables:
        btw_lowdiff: '{{ (( states(''input_number.luxtronik_25_ww_solltemperatur'')|float
          )-(c_btw_low)|float+(5/60*(diff_btw_lowminute)|float))|round(1) }}'
      alias: Variablen btw_lowdiff definieren (Tiefste berechnete Temperatur)
    - variables:
        esti_kw_b: '{{  ((3700/5*4/1000)*1.16*btw_lowdiff)|round(1)  }}'
      alias: Variablen esti_kw_b definieren (Hochrechnung kW Bedarf btw und Umwälzvolumen)
    - data:
        value: '{{ 0 if is_state(''sensor.heatpump_25_ww_power_consumption_helper'',
          ''unknown'')  else states(''sensor.heatpump_25_ww_power_consumption_helper'')|float}}'
      target:
        entity_id: input_number.heatpump_25_ww_power_consumption_helper
      alias: Speichere den Strom Verbrauch von dieser Ladung
      action: input_number.set_value
    - wait_for_trigger:
      - hours: '*'
        minutes: '0'
        trigger: time_pattern
      alias: Warten bis zur nächsten vollen Stunde
    - variables:
        ts_gwf_ende: '{{ now() }}'
    - data:
        value: '{{ states(''sensor.gwf_25_all_ww_l_helper'')|float }}'
      target:
        entity_id: input_number.gwf_25_ww_l_helper
      alias: Speichere den Warmwasserverbrauch seit der letzten Ladung
      action: input_number.set_value
    - variables:
        esti_kw_a: '{{  ((states(''input_number.gwf_25_ww_l_helper'')|float)/1000*1.16*
          (states(''input_number.luxtronik_25_ww_solltemperatur'')|float-14))|round(1)  }}'
      alias: Variablen esti_kw_a definieren (Hochrechnung kW Bedarf anhand l Verbrauch
        GWF)
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.gwf_25_all_ww_l_helper
      alias: Zurücksetzen der Utility Meter für Warmwasserverbrauch
      action: utility_meter.calibrate
    - data:
        value: '{{ states(''sensor.gwf_25_hz_ug_kw_helper'')|float }}'
      target:
        entity_id: input_number.gwf_25_hz_ug_kw_helper
      alias: Speichere den Kilowatt Verbrauch von dieser Ladung
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_a|float }}'
      target:
        entity_id: input_number.bwm25_variable_esti_kw_a
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_b|float }}'
      target:
        entity_id: input_number.bwm25_variable_esti_kw_b
      action: input_number.set_value
    - data:
        title: 'HA-Info Heatpump 25: Die Boiler Ladung ist beendet in {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }}'
        message: "*** Ablaufzeiten ***\nBUP Start   - {{ ts_bup_start }} \nBTW Low
          End - {{ ts_btw_low_ende }} \nBUP End     - {{ ts_bup_ende }} \nGWF End
          \    - {{ ts_gwf_ende }} \n*** Low Temperatur ermitteln ***\nBTW Low     -
          {{ c_btw_low }} Tiefpunkt Brauchwasser Temperatur\nBTW LowT    - {{ diff_btw_lowtime
          }} Zeitdauer von Start bis Tiefpunkt\nBTW LowM    - {{ diff_btw_lowminute
          }} Minuten von Start bis Tiefpunkt\nBTW LowDiff - {{ btw_lowdiff }} Differenz
          Tiefpunkt BW zu Soll\n*** Stromverbrauch Wärmepumpe ***\nStrom kW    - {{
          states('input_number.heatpump_25_ww_power_consumption_helper')|round(1)
          }} kW Verbrauch ganze Anlage\nPumpen kW   - {{ pumpen_kw }} System kW durch
          Pumpen\nNetto kW WP - {{ (states('input_number.heatpump_25_ww_power_consumption_helper')
          |float - pumpen_kw)|round(1) }} Netto kW von Wärmepumpe\n*** Warmwasser
          Verbrauch ***\nl WW       - {{ states('input_number.gwf_25_ww_l_helper')
          }} l seit letzter Ladung\n*** kW Hochrechnungen und GWF Zähler VL/RL ***\nEsti
          kW A   - {{ esti_kw_a }} kW anhand l Verbrauch\nEsti kW B   - {{ esti_kw_b
          }} kW anhand btw low und Umwälzvolumen\nVL/RL kW    - {{ states('input_number.gwf_25_hz_ug_kw_helper')
          }} kW Energie im VL/RL entnommen\n*** Errechnete Wirkungsgrade ***\nWG Platte
          \  - {{ (((esti_kw_a + esti_kw_b)/2)/ states('input_number.gwf_25_hz_ug_kw_helper')|float*100)|round(0)
          }}% Wirkungsgrad Plattentauscher\nWG Faktor   - {{ ((states('input_number.gwf_25_hz_ug_kw_helper')|float)
          /(states('input_number.heatpump_25_ww_power_consumption_helper')|float  -
          pumpen_kw))|round(1) }} Faktor Wärme VL/RL versus kW Verdichter"
      action: notify.administrator_rotseepark
    else:
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_25
      action: input_boolean.turn_off
  mode: parallel
  max: 2
- id: '1694404354860'
  alias: Monitoring Heatpump 19 - Brauchwasser Erzeugung Energie Verbrauch
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.luxtronik19_bup
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.luxtronik19_bup
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Boiler Ladung
          wurde gestartet'
    - target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_19
      data: {}
      action: input_boolean.turn_on
    - variables:
        ts_bup_start: '{{ now() }}'
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.heatpump_19_ww_power_consumption_helper
        - sensor.gwf_19_hz_ug_kw_helper
      alias: Zurücksetzen der Utility Meter für Warmwasser Erzeugung kW und Stromverbrauch
      action: utility_meter.calibrate
    - delay:
        hours: 0
        minutes: 10
        seconds: 0
        milliseconds: 0
    - data:
        value: '{{ states(''sensor.luxtronik19_tbw'')|float }}'
      target:
        entity_id: input_number.luxtronik_19_tbw_degc_helper
      alias: Speichere die aktuelle Brauchwasser Temperatur
      action: input_number.set_value
    - variables:
        ts_btw_low_ende: '{{ now() }}'
        c_btw_low: '{{ states(''sensor.luxtronik19_tbw'') }}'
        diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
          }}'
        diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start, ''%Y-%m-%d
          %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
    - alias: Wiederhole 30 mal 1 Minute, während sicher Brauchwasser Temperatur verändert
      repeat:
        count: 30
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(''input_number.luxtronik_19_tbw_degc_helper'')|float
              >= states(''sensor.luxtronik19_tbw'')|float }}'
          then:
          - data:
              value: '{{ states(''sensor.luxtronik19_tbw'')|float }}'
            target:
              entity_id: input_number.luxtronik_19_tbw_degc_helper
            alias: Speichere die aktuelle Brauchwasser Temperatur
            action: input_number.set_value
          - variables:
              ts_btw_low_ende: '{{ now() }}'
              c_btw_low: '{{ states(''sensor.luxtronik19_tbw'') }}'
              diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
                }}'
              diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start,
                ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_bup
        state: 'on'
      then:
      - wait_for_trigger:
        - entity_id:
          - binary_sensor.luxtronik19_bup
          from: 'on'
          to: 'off'
          trigger: state
      alias: Warten bis Brauchwasser Produktion endet
    - variables:
        ts_bup_ende: '{{ now() }}'
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Boiler Ladung
          wurde beendet (Verbrauch: {{states(''sensor.heatpump_19_ww_power_consumption_helper'')|float
          }} kWh, Laufzeit: {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }})'
    - variables:
        pumpen_kw: '{{  (  ( 1000/1000/60* ( strptime(ts_bup_ende, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp()  -
          strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp() )/60 )|round(1)  )
          }}'
      alias: Variablen pumpen_kw definieren (Hochrechnung kW Bedarf der Pumpen)
    - variables:
        btw_lowdiff: '{{ (( states(''input_number.luxtronik_19_ww_solltemperatur'')|float
          )-(c_btw_low)|float+(5/60*(diff_btw_lowminute)|float))|round(1) }}'
      alias: Variablen btw_lowdiff definieren (Tiefste berechnete Temperatur)
    - variables:
        esti_kw_b: '{{  ((4400/4*3/1000)*1.16*btw_lowdiff)|round(1)  }}'
      alias: Variablen esti_kw_b definieren (Hochrechnung kW Bedarf btw und Umwälzvolumen)
    - data:
        value: '{{ 0 if is_state(''sensor.heatpump_19_ww_power_consumption_helper'',
          ''unknown'')  else states(''sensor.heatpump_19_ww_power_consumption_helper'')|float}}'
      target:
        entity_id: input_number.heatpump_19_ww_power_consumption_helper
      alias: Speichere den Strom Verbrauch von dieser Ladung
      action: input_number.set_value
    - wait_for_trigger:
      - hours: '*'
        minutes: '0'
        trigger: time_pattern
      alias: Warten bis zur nächsten vollen Stunde
    - variables:
        ts_gwf_ende: '{{ now() }}'
    - data:
        value: '{{ states(''sensor.gwf_19_all_ww_l_helper'')|float }}'
      target:
        entity_id: input_number.gwf_19_ww_l_helper
      alias: Speichere den Warmwasserverbrauch seit der letzten Ladung
      action: input_number.set_value
    - variables:
        esti_kw_a: '{{  ((states(''input_number.gwf_19_ww_l_helper'')|float)/1000*1.16*
          (states(''input_number.luxtronik_19_ww_solltemperatur'')|float-14))|round(1)  }}'
      alias: Variablen esti_kw_a definieren (Hochrechnung kW Bedarf anhand l Verbrauch
        GWF)
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.gwf_19_all_ww_l_helper
      alias: Zurücksetzen der Utility Meter für Warmwasserverbrauch
      action: utility_meter.calibrate
    - data:
        value: '{{ states(''sensor.gwf_19_hz_ug_kw_helper'')|float }}'
      target:
        entity_id: input_number.gwf_19_hz_ug_kw_helper
      alias: Speichere den Kilowatt Verbrauch von dieser Ladung
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_a|float }}'
      target:
        entity_id: input_number.bwm19_variable_esti_kw_a
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_b|float }}'
      target:
        entity_id: input_number.bwm19_variable_esti_kw_b
      action: input_number.set_value
    - data:
        title: 'HA-Info Heatpump 19: Die Boiler Ladung ist beendet in {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }}'
        message: "*** Ablaufzeiten ***\nBUP Start   - {{ ts_bup_start }} \nBTW Low
          End - {{ ts_btw_low_ende }} \nBUP End     - {{ ts_bup_ende }} \nGWF End
          \    - {{ ts_gwf_ende }} \n*** Low Temperatur ermitteln ***\nBTW Low     -
          {{ c_btw_low }} Tiefpunkt Brauchwasser Temperatur\nBTW LowT    - {{ diff_btw_lowtime
          }} Zeitdauer von Start bis Tiefpunkt\nBTW LowM    - {{ diff_btw_lowminute
          }} Minuten von Start bis Tiefpunkt\nBTW LowDiff - {{ btw_lowdiff }} Differenz
          Tiefpunkt BW zu Soll\n*** Stromverbrauch Wärmepumpe ***\nStrom kW    - {{
          states('input_number.heatpump_19_ww_power_consumption_helper')|round(1)
          }} kW Verbrauch ganze Anlage\nPumpen kW   - {{ pumpen_kw }} System kW durch
          Pumpen\nNetto kW WP - {{ (states('input_number.heatpump_19_ww_power_consumption_helper')
          |float - pumpen_kw)|round(1) }} Netto kW von Wärmepumpe\n*** Warmwasser
          Verbrauch ***\nl WW       - {{ states('input_number.gwf_19_ww_l_helper')
          }} l seit letzter Ladung\n*** kW Hochrechnungen und GWF Zähler VL/RL ***\nEsti
          kW A   - {{ esti_kw_a }} kW anhand l Verbrauch\nEsti kW B   - {{ esti_kw_b
          }} kW anhand btw low und Umwälzvolumen\nVL/RL kW    - {{ states('input_number.gwf_19_hz_ug_kw_helper')
          }} kW Energie im VL/RL entnommen\n*** Errechnete Wirkungsgrade ***\nWG Platte
          \  - {{ (((esti_kw_a + esti_kw_b)/2)/ states('input_number.gwf_19_hz_ug_kw_helper')|float*100)|round(0)
          }}% Wirkungsgrad Plattentauscher\nWG Faktor   - {{ ((states('input_number.gwf_19_hz_ug_kw_helper')|float)
          /(states('input_number.heatpump_19_ww_power_consumption_helper')|float  -
          pumpen_kw))|round(1) }} Faktor Wärme VL/RL versus kW Verdichter"
      action: notify.administrator_rotseepark
    else:
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_19
      action: input_boolean.turn_off
  mode: parallel
  max: 2
- id: '1694404401938'
  alias: Monitoring Heatpump 23 - Brauchwasser Erzeugung Energie Verbrauch
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.luxtronik23_bup
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.luxtronik23_bup
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Boiler Ladung
          wurde gestartet'
    - target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_23
      data: {}
      action: input_boolean.turn_on
    - variables:
        ts_bup_start: '{{ now() }}'
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.heatpump_23_ww_power_consumption_helper
        - sensor.gwf_23_hz_ug_kw_helper
      alias: Zurücksetzen der Utility Meter für Warmwasser Erzeugung kW und Stromverbrauch
      action: utility_meter.calibrate
    - delay:
        hours: 0
        minutes: 10
        seconds: 0
        milliseconds: 0
    - data:
        value: '{{ states(''sensor.luxtronik23_tbw'')|float }}'
      target:
        entity_id: input_number.luxtronik_23_tbw_degc_helper
      alias: Speichere die aktuelle Brauchwasser Temperatur
      action: input_number.set_value
    - variables:
        ts_btw_low_ende: '{{ now() }}'
        c_btw_low: '{{ states(''sensor.luxtronik23_tbw'') }}'
        diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
          }}'
        diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start, ''%Y-%m-%d
          %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
    - alias: Wiederhole 30 mal 1 Minute, während sicher Brauchwasser Temperatur verändert
      repeat:
        count: 30
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(''input_number.luxtronik_23_tbw_degc_helper'')|float
              >= states(''sensor.luxtronik23_tbw'')|float }}'
          then:
          - data:
              value: '{{ states(''sensor.luxtronik23_tbw'')|float }}'
            target:
              entity_id: input_number.luxtronik_23_tbw_degc_helper
            alias: Speichere die aktuelle Brauchwasser Temperatur
            action: input_number.set_value
          - variables:
              ts_btw_low_ende: '{{ now() }}'
              c_btw_low: '{{ states(''sensor.luxtronik23_tbw'') }}'
              diff_btw_lowtime: '{{ now() - strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'')
                }}'
              diff_btw_lowminute: '{{ ((now().timestamp() - strptime(ts_bup_start,
                ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp())/60)|round(0) }}'
        - delay:
            hours: 0
            minutes: 1
            seconds: 0
            milliseconds: 0
    - if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_bup
        state: 'on'
      then:
      - wait_for_trigger:
        - entity_id:
          - binary_sensor.luxtronik23_bup
          from: 'on'
          to: 'off'
          trigger: state
      alias: Warten bis Brauchwasser Produktion endet
    - variables:
        ts_bup_ende: '{{ now() }}'
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Boiler Ladung
          wurde beendet (Verbrauch: {{states(''sensor.heatpump_23_ww_power_consumption_helper'')|float
          }} kWh, Laufzeit: {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }})'
    - variables:
        pumpen_kw: '{{  (  ( 1000/1000/60* ( strptime(ts_bup_ende, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp()  -
          strptime(ts_bup_start, ''%Y-%m-%d %H:%M:%S.%f%z'').timestamp() )/60 )|round(1)  )
          }}'
      alias: Variablen pumpen_kw definieren (Hochrechnung kW Bedarf der Pumpen)
    - variables:
        btw_lowdiff: '{{ (( states(''input_number.luxtronik_23_ww_solltemperatur'')|float
          )-(c_btw_low)|float+(5/60*(diff_btw_lowminute)|float))|round(1) }}'
      alias: Variablen btw_lowdiff definieren (Tiefste berechnete Temperatur)
    - variables:
        esti_kw_b: '{{  ((4400/4*3/1000)*1.16*btw_lowdiff)|round(1)  }}'
      alias: Variablen esti_kw_b definieren (Hochrechnung kW Bedarf btw und Umwälzvolumen)
    - data:
        value: '{{ 0 if is_state(''sensor.heatpump_23_ww_power_consumption_helper'',
          ''unknown'')  else states(''sensor.heatpump_23_ww_power_consumption_helper'')|float}}'
      target:
        entity_id: input_number.heatpump_23_ww_power_consumption_helper
      alias: Speichere den Strom Verbrauch von dieser Ladung
      action: input_number.set_value
    - wait_for_trigger:
      - hours: '*'
        minutes: '0'
        trigger: time_pattern
      alias: Warten bis zur nächsten vollen Stunde
    - variables:
        ts_gwf_ende: '{{ now() }}'
    - data:
        value: '{{ states(''sensor.gwf_23_all_ww_l_helper'')|float }}'
      target:
        entity_id: input_number.gwf_23_ww_l_helper
      alias: Speichere den Warmwasserverbrauch seit der letzten Ladung
      action: input_number.set_value
    - variables:
        esti_kw_a: '{{  ((states(''input_number.gwf_23_ww_l_helper'')|float)/1000*1.16*
          (states(''input_number.luxtronik_23_ww_solltemperatur'')|float-14))|round(1)  }}'
      alias: Variablen esti_kw_a definieren (Hochrechnung kW Bedarf anhand l Verbrauch
        GWF)
    - data:
        value: '0'
      target:
        entity_id:
        - sensor.gwf_23_all_ww_l_helper
      alias: Zurücksetzen der Utility Meter für Warmwasserverbrauch
      action: utility_meter.calibrate
    - data:
        value: '{{ states(''sensor.gwf_23_hz_ug_kw_helper'')|float }}'
      target:
        entity_id: input_number.gwf_23_hz_ug_kw_helper
      alias: Speichere den Kilowatt Verbrauch von dieser Ladung
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_a|float }}'
      target:
        entity_id: input_number.bwm23_variable_esti_kw_a
      action: input_number.set_value
    - data:
        value: '{{ esti_kw_b|float }}'
      target:
        entity_id: input_number.bwm23_variable_esti_kw_b
      action: input_number.set_value
    - data:
        title: 'HA-Info Heatpump 23: Die Boiler Ladung ist beendet in {{ (((as_timestamp(ts_bup_ende)-as_timestamp(ts_bup_start))/3600)|int)
          }}:{{ "%02d"|format((((as_timestamp(ts_bup_ende) - as_timestamp(ts_bup_start))
          % 3600 / 60) | int)) }}'
        message: "*** Ablaufzeiten ***\nBUP Start   - {{ ts_bup_start }} \nBTW Low
          End - {{ ts_btw_low_ende }} \nBUP End     - {{ ts_bup_ende }} \nGWF End
          \    - {{ ts_gwf_ende }} \n*** Low Temperatur ermitteln ***\nBTW Low     -
          {{ c_btw_low }} Tiefpunkt Brauchwasser Temperatur\nBTW LowT    - {{ diff_btw_lowtime
          }} Zeitdauer von Start bis Tiefpunkt\nBTW LowM    - {{ diff_btw_lowminute
          }} Minuten von Start bis Tiefpunkt\nBTW LowDiff - {{ btw_lowdiff }} Differenz
          Tiefpunkt BW zu Soll\n*** Stromverbrauch Wärmepumpe ***\nStrom kW    - {{
          states('input_number.heatpump_23_ww_power_consumption_helper')|round(1)
          }} kW Verbrauch ganze Anlage\nPumpen kW   - {{ pumpen_kw }} System kW durch
          Pumpen\nNetto kW WP - {{ (states('input_number.heatpump_23_ww_power_consumption_helper')
          |float - pumpen_kw)|round(1) }} Netto kW von Wärmepumpe\n*** Warmwasser
          Verbrauch ***\nl WW       - {{ states('input_number.gwf_23_ww_l_helper')
          }} l seit letzter Ladung\n*** kW Hochrechnungen und GWF Zähler VL/RL ***\nEsti
          kW A   - {{ esti_kw_a }} kW anhand l Verbrauch\nEsti kW B   - {{ esti_kw_b
          }} kW anhand btw low und Umwälzvolumen\nVL/RL kW    - {{ states('input_number.gwf_23_hz_ug_kw_helper')
          }} kW Energie im VL/RL entnommen\n*** Errechnete Wirkungsgrade ***\nWG Platte
          \  - {{ (((esti_kw_a + esti_kw_b)/2)/ states('input_number.gwf_23_hz_ug_kw_helper')|float*100)|round(0)
          }}% Wirkungsgrad Plattentauscher\nWG Faktor   - {{ ((states('input_number.gwf_23_hz_ug_kw_helper')|float)
          /(states('input_number.heatpump_23_ww_power_consumption_helper')|float  -
          pumpen_kw))|round(1) }} Faktor Wärme VL/RL versus kW Verdichter"
      action: notify.administrator_rotseepark
    else:
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.luxtronik_brauchwasser_haus_23
      action: input_boolean.turn_off
  mode: parallel
  max: 2
- id: '1696261583380'
  alias: Monitoring TA Mittel und Schalten der Heizphase und Kühlphase
  description: ''
  triggers:
  - hours: '8'
    minutes: '0'
    seconds: '0'
    trigger: time_pattern
  conditions:
  - alias: Gültig nur im Mai, Juni, September und Oktober
    condition: template
    value_template: "{{ true if ( \n  (\n      (now().month == 5 or now().month ==
      6) \n   or (now().month == 9 or now().month == 10)\n  ) \n) else false }}"
  - condition: or
    conditions:
    - alias: Testen ob TA-Mittel die Heizgrenze bei allen 4 Häusern unterschreitet
        (heizen)
      condition: and
      conditions:
      - condition: numeric_state
        entity_id: sensor.luxtronik19_ta_mittel
        below: sensor.luxtronik19_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik21_ta_mittel
        below: sensor.luxtronik21_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik23_ta_mittel
        below: sensor.luxtronik23_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik25_ta_mittel
        below: sensor.luxtronik25_heizgrenze
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: sensor.luxtronik19_ta_mittel
        above: sensor.luxtronik19_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik21_ta_mittel
        above: sensor.luxtronik21_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik23_ta_mittel
        above: sensor.luxtronik23_heizgrenze
      - condition: numeric_state
        entity_id: sensor.luxtronik25_ta_mittel
        above: sensor.luxtronik25_heizgrenze
      alias: Testen ob TA-Mittel die Heizgrenze bei allen 4 Häusern überschreitet
        (kühlen)
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_ta_mittel
          below: sensor.luxtronik19_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik21_ta_mittel
          below: sensor.luxtronik21_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik23_ta_mittel
          below: sensor.luxtronik23_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik25_ta_mittel
          below: sensor.luxtronik25_heizgrenze
        alias: Testen ob TA-Mittel die Heizgrenze bei allen 4 Häusern unterschreitet
          (heizen)
      sequence:
      - data: {}
        target:
          entity_id:
          - input_boolean.luxtronik_heizphase_haus_19
          - input_boolean.luxtronik_heizphase_haus_21
          - input_boolean.luxtronik_heizphase_haus_23
          - input_boolean.luxtronik_heizphase_haus_25
        action: input_boolean.turn_on
      - data: {}
        target:
          entity_id:
          - input_boolean.luxtronik_kuhlphase_haus_19
          - input_boolean.luxtronik_kuhlphase_haus_21
          - input_boolean.luxtronik_kuhlphase_haus_23
          - input_boolean.luxtronik_kuhlphase_haus_25
        action: input_boolean.turn_off
      - condition: and
        conditions:
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_19
          state: 'on'
          for:
            hours: 71
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_21
          state: 'on'
          for:
            hours: 71
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_23
          state: 'on'
          for:
            hours: 71
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_heizphase_haus_25
          state: 'on'
          for:
            hours: 71
            minutes: 0
            seconds: 0
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus_cooling'')
            }}'
        target:
          entity_id:
          - input_select.luxtronik_19_cl_operation_mode
          - input_select.luxtronik_21_cl_operation_mode
          - input_select.luxtronik_23_cl_operation_mode
          - input_select.luxtronik_25_cl_operation_mode
        enabled: true
        action: input_select.set_options
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_automatik'')
            }}'
        target:
          entity_id:
          - input_select.luxtronik_19_hz_operation_mode
          - input_select.luxtronik_21_hz_operation_mode
          - input_select.luxtronik_23_hz_operation_mode
          - input_select.luxtronik_25_hz_operation_mode
        enabled: true
        action: input_select.set_options
    - conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_ta_mittel
          above: sensor.luxtronik19_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik21_ta_mittel
          above: sensor.luxtronik21_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik23_ta_mittel
          above: sensor.luxtronik23_heizgrenze
        - condition: numeric_state
          entity_id: sensor.luxtronik25_ta_mittel
          above: sensor.luxtronik25_heizgrenze
        alias: Testen ob TA-Mittel die Heizgrenze bei allen 4 Häusern überschreitet
          (kühlen)
      sequence:
      - data: {}
        target:
          entity_id:
          - input_boolean.luxtronik_heizphase_haus_19
          - input_boolean.luxtronik_heizphase_haus_21
          - input_boolean.luxtronik_heizphase_haus_23
          - input_boolean.luxtronik_heizphase_haus_25
        action: input_boolean.turn_off
      - data: {}
        target:
          entity_id:
          - input_boolean.luxtronik_kuhlphase_haus_19
          - input_boolean.luxtronik_kuhlphase_haus_21
          - input_boolean.luxtronik_kuhlphase_haus_23
          - input_boolean.luxtronik_kuhlphase_haus_25
        action: input_boolean.turn_on
      - condition: and
        conditions:
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_19
          state: 'on'
          for:
            hours: 167
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_21
          state: 'on'
          for:
            hours: 167
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_23
          state: 'on'
          for:
            hours: 167
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: input_boolean.luxtronik_kuhlphase_haus_25
          state: 'on'
          for:
            hours: 167
            minutes: 0
            seconds: 0
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_aus'') }}'
        target:
          entity_id:
          - input_select.luxtronik_19_hz_operation_mode
          - input_select.luxtronik_21_hz_operation_mode
          - input_select.luxtronik_23_hz_operation_mode
          - input_select.luxtronik_25_hz_operation_mode
        enabled: true
        action: input_select.set_options
      - data:
          options: '{{ states(''input_select.luxtronik_operation_mode_automatik_cooling'')
            }}'
        target:
          entity_id:
          - input_select.luxtronik_19_cl_operation_mode
          - input_select.luxtronik_21_cl_operation_mode
          - input_select.luxtronik_23_cl_operation_mode
          - input_select.luxtronik_25_cl_operation_mode
        enabled: true
        action: input_select.set_options
  mode: single
- id: '1696282173640'
  alias: Zähle Secomat Trocknungen
  description: "Diese Automatisation zählt die Secomat Trocknungsvorgänge (Counter
    des Secomaten inkrementieren) und erstellt ein E-Mail an den Administrator. \nAuslöser
    ist, wenn irgend einer der Secomaten anschaltet. Zusätzlich wird dann überprüft,
    ob der Secomat weniger als 2 Minuten läuft, da wir nicht wollen, dass bestehende
    laufenden Secomat Vorgänge, welche wir schon einmal gezählt haben, noch ein zweites
    mal gezählt werden. "
  triggers:
  - entity_id:
    - switch.secomat_191_switch_0
    - switch.secomat_192_switch_0
    - switch.secomat_211_switch_0
    - switch.secomat_212_switch_0
    - switch.secomat_231_switch_0
    - switch.secomat_232_switch_0
    - switch.secomat_251_switch_0
    - switch.secomat_252_switch_0
    from: 'off'
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - alias: Secomat 19.1 prüfen
    if:
    - condition: state
      entity_id: switch.secomat_191_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_191_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 19: Secomat 19.1 gestartet'
          message: Secomat 19.1 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_191_usage_counter
        action: counter.increment
  - if:
    - condition: state
      entity_id: switch.secomat_192_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_192_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 19: Secomat 19.2 gestartet'
          message: Secomat 19.2 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_192_usage_counter
        action: counter.increment
    alias: Secomat 19.2 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_211_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_211_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 21: Secomat 21.1 gestartet'
          message: Secomat 21.1 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_211_usage_counter
        action: counter.increment
    alias: Secomat 21.1 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_212_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_212_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 21: Secomat 21.2 gestartet'
          message: Secomat 21.2 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_212_usage_counter
        action: counter.increment
    alias: Secomat 21.2 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_231_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_231_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 23: Secomat 23.1 gestartet'
          message: Secomat 23.1 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_231_usage_counter
        action: counter.increment
    alias: Secomat 23.1 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_232_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_232_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 23: Secomat 23.2 gestartet'
          message: Secomat 23.2 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_232_usage_counter
        action: counter.increment
    alias: Secomat 23.2 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_251_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_251_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 25: Secomat 25.1 gestartet'
          message: Secomat 25.1 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_251_usage_counter
        action: counter.increment
    alias: Secomat 25.1 prüfen
  - if:
    - condition: state
      entity_id: switch.secomat_252_switch_0
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - if:
      - condition: state
        entity_id: switch.secomat_252_switch_0
        state: 'on'
        for:
          hours: 0
          minutes: 2
          seconds: 0
      then: []
      else:
      - action: script.send_a_notification_to_administrator_rotseepark
        data:
          title: 'HA-Info Haus 25: Secomat 25.2 gestartet'
          message: Secomat 25.2 gestartet
      - data: {}
        target:
          entity_id: counter.secomat_252_usage_counter
        action: counter.increment
    alias: Secomat 25.2 prüfen
  mode: queued
  max: 3
- id: '1697293788781'
  alias: Schalte WW - Bei drohender Sperrzeit auf Party schalten
  description: 'Diese Automation verwendet den Zeitplan Sperrzeit, welche die Brauchwasser
    Sperrzeiten der Wärmepumpe mit einem Vorlauf von 30 Minuten abbildet. Es wird
    10 Minuten vor und 2 Minuten vor dem Eintreten der Sperrzeit geprüft, ob eine
    Ladung läuft und sofern dies der Fall ist, die Brauchwasser Produktion auf Party
    gestellt, damit die Sperrzeit die Ladung nicht unterbricht. '
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_sperrzeit_warmwasser
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
  - entity_id:
    - schedule.luxtronik_zeitplan_sperrzeit_warmwasser
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 28
      seconds: 0
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'on'
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'on'
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'on'
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'on'
  actions:
  - alias: Haus 19 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik19_bup
        state: 'on'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_19_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_19_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 19: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 19 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen drohender Sperrzeit
  - alias: Haus 21 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik21_bup
        state: 'on'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_21_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_21_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 21: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 21 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen drohender Sperrzeit
  - alias: Haus 23 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik23_bup
        state: 'on'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_23_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_23_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 23: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 23 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen drohender Sperrzeit
  - alias: Haus 25 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik25_bup
        state: 'on'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_25_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_25_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 25: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 25 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen drohender Sperrzeit
  mode: single
- id: '1697294920214'
  alias: Schalte WW - Bei beendeter Sperrzeit Party abschalten
  description: 'Diese Automation verwendet den Zeitplan Sperrzeit, welche die Brauchwasser
    Sperrzeiten der Wärmepumpe mit einem Vorlauf von 30 Minuten abbildet. Es wird
    5 Minuten nach dem beenden der Sperrzeit geprüft, ob der Party Modus aktiv ist
    und sofern das der Fall ist, wird wieder auf Automatik geschaltet. '
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_sperrzeit_warmwasser
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.luxtronik_19_ww_operation_mode
      state: '2'
    - condition: state
      entity_id: input_select.luxtronik_21_ww_operation_mode
      state: '2'
    - condition: state
      entity_id: input_select.luxtronik_23_ww_operation_mode
      state: '2'
    - condition: state
      entity_id: input_select.luxtronik_25_ww_operation_mode
      state: '2'
  actions:
  - alias: Haus 19 auf Automatik stellen, sofern Operation Mode auf Party ist
    if:
    - condition: and
      conditions:
      - alias: Warmwasser Operating Mode ist "Party"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Party" }}'
      - condition: state
        entity_id: input_select.luxtronik_19_ww_operation_mode
        state: '2'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_19_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 19: Warmwasser Operation Mode auf Automatik gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 19 auf Automatik gestellt,
          da die Sperrzeit beendet ist
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Automatik
          gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Automatik
          gestellt, da die Sperrzeit beendet ist
  - alias: Haus 21 auf Automatik stellen, sofern Operation Mode auf Party ist
    if:
    - condition: and
      conditions:
      - alias: Warmwasser Operating Mode ist "Party"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Party" }}'
      - condition: state
        entity_id: input_select.luxtronik_21_ww_operation_mode
        state: '2'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_21_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 21: Warmwasser Operation Mode auf Automatik gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 21 auf Automatik gestellt,
          da die Sperrzeit beendet ist
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Automatik
          gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Automatik
          gestellt, da die Sperrzeit beendet ist
  - alias: Haus 23 auf Automatik stellen, sofern Operation Mode auf Party ist
    if:
    - condition: and
      conditions:
      - alias: Warmwasser Operating Mode ist "Party"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Party" }}'
      - condition: state
        entity_id: input_select.luxtronik_23_ww_operation_mode
        state: '2'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_23_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 23: Warmwasser Operation Mode auf Automatik gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 23 auf Automatik gestellt,
          da die Sperrzeit beendet ist
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Automatik
          gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Automatik
          gestellt, da die Sperrzeit beendet ist
  - alias: Haus 25 auf Automatik stellen, sofern Operation Mode auf Party ist
    if:
    - condition: and
      conditions:
      - alias: Warmwasser Operating Mode ist "Party"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Party" }}'
      - condition: state
        entity_id: input_select.luxtronik_25_ww_operation_mode
        state: '2'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_automatik'')|int
          }}'
      target:
        entity_id: input_select.luxtronik_25_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 25: Warmwasser Operation Mode auf Automatik gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 25 auf Automatik gestellt,
          da die Sperrzeit beendet ist
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Automatik
          gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Automatik
          gestellt, da die Sperrzeit beendet ist
  mode: single
- id: '1697348951501'
  alias: Schalte WW - Setze WW Operation Mode Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '0'
    to: '2'
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '2'
    to: '0'
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '2'
    to: '4'
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '4'
    to: '0'
  - entity_id:
    - input_select.luxtronik_19_ww_operation_mode
    trigger: state
    from: '4'
    to: '2'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode'']
            != states(''input_select.luxtronik_19_ww_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 19
          value: '{{ states(''input_select.luxtronik_19_ww_operation_mode'')|int }}'
        action: script.schalte_warmwasser_operation_mode
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_19_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode'']
        != states(''input_select.luxtronik_19_ww_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 19 Warmwasser Operation Mode nicht gesetzt
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_19_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Operation Mode
          nicht gesetzt

          '
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_''
          ~ haus ~ ''_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus
          ~ ''_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_operation_mode'']}} / {{state_attr(''sensor.luxtronik_''
          ~ haus ~ ''_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Operation Mode nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 19: Boiler wurde auf
        {% set mode = state_attr(''sensor.luxtronik_19_param_state'', ''parameters'')[''warmwater_operation_mode'']
        %}{% if mode == 4 %}Aus{% elif mode == 0 %}Automatik (Ende Sperrzeit){% elif
        mode == 2 %}Party (Sperrzeit){% else %}Unbekannt{% endif %} gestellt <div
        style="display: none">technical</div>'
  mode: single
- id: '1697349156873'
  alias: Schalte WW - Setze WW Operation Mode Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '0'
    to: '2'
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '2'
    to: '0'
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '2'
    to: '4'
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '4'
    to: '0'
  - entity_id:
    - input_select.luxtronik_21_ww_operation_mode
    trigger: state
    from: '4'
    to: '2'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode'']
            != states(''input_select.luxtronik_21_ww_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 21
          value: '{{ states(''input_select.luxtronik_21_ww_operation_mode'')|int }}'
        action: script.schalte_warmwasser_operation_mode
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_21_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode'']
        != states(''input_select.luxtronik_21_ww_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 21 Warmwasser Operation Mode nicht gesetzt
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_21_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Operation Mode
          nicht gesetzt

          '
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_''
          ~ haus ~ ''_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus
          ~ ''_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_operation_mode'']}} / {{state_attr(''sensor.luxtronik_''
          ~ haus ~ ''_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Operation Mode nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 21: Boiler wurde auf
        {% set mode = state_attr(''sensor.luxtronik_21_param_state'', ''parameters'')[''warmwater_operation_mode'']
        %}{% if mode == 4 %}Aus{% elif mode == 0 %}Automatik (Ende Sperrzeit){% elif
        mode == 2 %}Party (Sperrzeit){% else %}Unbekannt{% endif %} gestellt <div
        style="display: none">technical</div>'
  mode: single
- id: '1697349187899'
  alias: Schalte WW - Setze WW Operation Mode Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '0'
    to: '2'
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '2'
    to: '0'
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '2'
    to: '4'
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '4'
    to: '0'
  - entity_id:
    - input_select.luxtronik_23_ww_operation_mode
    trigger: state
    from: '4'
    to: '2'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode'']
            != states(''input_select.luxtronik_23_ww_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 23
          value: '{{ states(''input_select.luxtronik_23_ww_operation_mode'')|int }}'
        action: script.schalte_warmwasser_operation_mode
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_23_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode'']
        != states(''input_select.luxtronik_23_ww_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 23 Warmwasser Operation Mode nicht gesetzt
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_23_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Operation Mode
          nicht gesetzt

          '
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_''
          ~ haus ~ ''_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus
          ~ ''_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_operation_mode'']}} / {{state_attr(''sensor.luxtronik_''
          ~ haus ~ ''_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Operation Mode nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 23: Boiler wurde auf
        {% set mode = state_attr(''sensor.luxtronik_23_param_state'', ''parameters'')[''warmwater_operation_mode'']
        %}{% if mode == 4 %}Aus{% elif mode == 0 %}Automatik (Ende Sperrzeit){% elif
        mode == 2 %}Party (Sperrzeit){% else %}Unbekannt{% endif %} gestellt <div
        style="display: none">technical</div>'
  mode: single
- id: '1697349214457'
  alias: Schalte WW - Setze WW Operation Mode Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '0'
    to: '2'
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '0'
    to: '4'
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '2'
    to: '0'
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '2'
    to: '4'
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '4'
    to: '0'
  - entity_id:
    - input_select.luxtronik_25_ww_operation_mode
    trigger: state
    from: '4'
    to: '2'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Warmwasser Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode'']
            != states(''input_select.luxtronik_25_ww_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 25
          value: '{{ states(''input_select.luxtronik_25_ww_operation_mode'')|int }}'
        action: script.schalte_warmwasser_operation_mode
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_25_param_state
        action: homeassistant.update_entity
        continue_on_error: true
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Warmwasser Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Warmwasser Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode'']
        != states(''input_select.luxtronik_25_ww_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - WW Haus 25 Warmwasser Operation Mode nicht gesetzt
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_25_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Operation Mode
          nicht gesetzt

          '
        message: 'Warmwasser Operation Mode Soll:  {{states(''input_select.luxtronik_''
          ~ haus ~ ''_ww_operation_mode'')|int}}

          Warmwasser Operation Mode Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus
          ~ ''_param_state'',''parameters'')[''warmwater_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Warmwasser Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~
          ''_param_state'',''parameters'')[''warmwater_operation_mode'']}} / {{state_attr(''sensor.luxtronik_''
          ~ haus ~ ''_param_state'',''parameters'')[''warmwater_operation_mode_string'']}}

          '
    alias: Sende eine Benachrichtigung, wenn die Warmwasser Operation Mode nicht gesetzt
      werden konnte
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus 25: Boiler wurde auf
        {% set mode = state_attr(''sensor.luxtronik_25_param_state'', ''parameters'')[''warmwater_operation_mode'']
        %}{% if mode == 4 %}Aus{% elif mode == 0 %}Automatik (Ende Sperrzeit){% elif
        mode == 2 %}Party (Sperrzeit){% else %}Unbekannt{% endif %} gestellt <div
        style="display: none">technical</div>'
  mode: single
- id: '1702796995213'
  alias: Schalte WW - Bei kommender TDI  und hohem Verbrauch auf Party schalten
  description: 'Diese Automation läuft fix am Samstag um 21:15 Uhr. Ziel ist es, die
    Boiler Ladung frühzeitg zu starten, falls ein höherer Wasserverbrauch von mehr
    als 1350 Liter zutrifft. Die Brauchwasser Produktion wird dazu auf Party gestellt,
    womit die Sperrzeit umgangen wird. Bei hohem Wasserverbrauch schafft es die  TDI
    nicht auf 60°, wenn wir damit erst um 22:15 Uhr beginnen. '
  triggers:
  - at: '21:15:00'
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'off'
    alias: Testen, ob alle BUP in allen 4 Häusern abgeschaltet
  - condition: time
    weekday:
    - sat
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.gwf_19_all_ww_l_helper
      above: 1350
    - condition: numeric_state
      entity_id: sensor.gwf_21_all_ww_l_helper
      above: 1350
    - condition: numeric_state
      entity_id: sensor.gwf_23_all_ww_l_helper
      above: 1350
    - condition: numeric_state
      entity_id: sensor.gwf_25_all_ww_l_helper
      above: 1350
    alias: Testen, ob irgend eines der Häuser mehr als 1350 Liter verbraucht
  actions:
  - alias: Haus 19 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik19_bup
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.gwf_19_all_ww_l_helper
        above: 1350
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_19_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_19_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 19: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 19 auf Party gestellt,
          wegen Mehrverbrauch vor TDI
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Mehrverbrauch vor TDI)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen Mehrverbrauch vor TDI
  - alias: Haus 21 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik21_bup
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.gwf_21_all_ww_l_helper
        above: 1350
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_21_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_21_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 21: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 21 auf Party gestellt,
          wegen Mehrverbrauch vor TDI
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Mehrverbrauch vor TDI)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen Mehrverbrauch vor TDI
  - alias: Haus 23 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik23_bup
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.gwf_23_all_ww_l_helper
        above: 1350
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_23_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_23_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 23: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 23 auf Party gestellt,
          wegen Mehrverbrauch vor TDI
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Mehrverbrauch vor TDI)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen Mehrverbrauch vor TDI
  - alias: Haus 25 auf Party stellen, sofern BUP läuft und Operating Mode auf Automatik
      ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik25_bup
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.gwf_25_all_ww_l_helper
        above: 1350
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_25_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_25_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 25: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 25 auf Party gestellt,
          wegen Mehrverbrauch vor TDI
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Mehrverbrauch vor TDI)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen Mehrverbrauch vor TDI
  mode: single
- id: '1717559263530'
  alias: Schalte WW - Produziere Warmwasser (Sonnenmodus forciert) - Mai bis August
  description: ''
  triggers:
  - alias: Time Pattern Trigger 9 Uhr alle 20 Minuten
    hours: '9'
    minutes: /20
    trigger: time_pattern
  - alias: Time Pattern Trigger 10 Uhr alle 20 Minuten
    hours: '10'
    minutes: /20
    trigger: time_pattern
  - alias: Time Pattern Trigger 11 Uhr alle 20 Minuten
    hours: '11'
    minutes: /20
    trigger: time_pattern
  - alias: Time Pattern Trigger 12 Uhr alle 20 Minuten
    hours: '12'
    minutes: /20
    trigger: time_pattern
  - alias: Time Pattern Trigger 13 Uhr alle 20 Minuten
    hours: '13'
    minutes: /20
    trigger: time_pattern
  - alias: Time Pattern Trigger 14 Uhr alle 20 Minuten
    hours: '14'
    minutes: /20
    trigger: time_pattern
  conditions:
  - alias: Gültig nur vom Mai bis zum August
    condition: template
    value_template: "{{ true if ( \n  ((now().month >= 5 and now().month <= 8)) \n)
      else false }}"
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    alias: Montag bis Samstag
  - alias: Gültig nur ab 09:20 Uhr
    condition: template
    value_template: "{{ true if ( \n  ((now().hour > 9 ) or (now().hour == 9 and now().minute
      > 15)) \n) else false }}"
  - alias: Nur wenn die Sonne schon 3 Stunden oben ist und noch mindestens 4 Stunden
      scheint
    condition: sun
    before: sunset
    before_offset: -04:00:00
    after: sunrise
    after_offset: 03:00:00
    enabled: true
  - alias: Nur wenn wir jetzt gerade eine Überproduktion von 9 kWh im 60 Minuten Mittelwert
      haben
    condition: numeric_state
    entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
    below: -9000
  - alias: Nur wenn wir jetzt gerade eine Überproduktion von 12 kWh im 30 Minuten
      Mittelwert haben
    condition: numeric_state
    entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
    below: -12000
  - condition: numeric_state
    entity_id: sensor.forecast_solar_production_next_hour
    above: 25
    alias: Nur wenn der Produktion Forecast für die nächste Stunde mindestens 25 kWh
      ist
    enabled: false
  - alias: Nur wenn der Produktion Forecast für den Rest des Tages mindestens 100
      kWh ist
    condition: numeric_state
    entity_id: sensor.forecast_solar_production_today_remaining
    above: 100
    enabled: false
  actions:
  - alias: Prüfen welches Haus das tiefste Brauchwasser hat und geladen werden soll
    choose:
    - conditions:
      - alias: Vergleiche Haus 19 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 19 seit mindestens 3 Stunden nicht läuft
          condition: state
          entity_id: input_boolean.luxtronik_brauchwasser_haus_19
          state: 'off'
          for:
            hours: 9
            minutes: 0
            seconds: 0
          enabled: false
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik19_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 19 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: Überproduktion Schwellwert und letzte Laufzeit prüfen
          condition: or
          conditions:
          - alias: Nur wenn wir jetzt gerade eine Überproduktion von 9 kWh im 30 Minuten
              Mittelwert haben
            condition: numeric_state
            entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
            below: -9000
          - alias: Prüfen, ob BPU von Haus 19 seit mindestens 18 Stunden nicht läuft
            condition: state
            entity_id: input_boolean.luxtronik_brauchwasser_haus_19
            state: 'off'
            for:
              hours: 18
              minutes: 0
              seconds: 0
          enabled: true
        - condition: template
          value_template: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
            - 1 )|int > 0 }}'
          alias: Testen, ob mindestens 1 Grad Temperaturunterschied TBW zu TBW Soll
        - alias: Prüfen, ob BPU von Haus 19 nicht läuft
          condition: state
          entity_id: binary_sensor.luxtronik19_bup_out
          state: 'off'
          enabled: true
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 19
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik19_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_19_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 21 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 21 seit mindestens 3 Stunden nicht läuft
          condition: state
          entity_id: input_boolean.luxtronik_brauchwasser_haus_21
          state: 'off'
          for:
            hours: 9
            minutes: 0
            seconds: 0
          enabled: false
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik21_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 21 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: Überproduktion Schwellwert und letzte Laufzeit prüfen
          condition: or
          conditions:
          - alias: Nur wenn wir jetzt gerade eine Überproduktion von 9 kWh im 30 Minuten
              Mittelwert haben
            condition: numeric_state
            entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
            below: -9000
          - alias: Prüfen, ob BPU von Haus 21 seit mindestens 18 Stunden nicht läuft
            condition: state
            entity_id: input_boolean.luxtronik_brauchwasser_haus_21
            state: 'off'
            for:
              hours: 18
              minutes: 0
              seconds: 0
          enabled: true
        - condition: template
          value_template: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
            - 1 )|int > 0 }}'
          alias: Testen, ob mindestens 1 Grad Temperaturunterschied TBW zu TBW Soll
        - alias: Prüfen, ob BPU von Haus 21 nicht läuft
          condition: state
          entity_id: binary_sensor.luxtronik21_bup_out
          state: 'off'
          enabled: true
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 21
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik21_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_21_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 23 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 23 seit mindestens 3 Stunden nicht läuft
          condition: state
          entity_id: input_boolean.luxtronik_brauchwasser_haus_23
          state: 'off'
          for:
            hours: 9
            minutes: 0
            seconds: 0
          enabled: false
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik23_tbw'') < states(''sensor.luxtronik25_tbw'')
            or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 23 Boiler kälter als Haus 25 oder der Boiler 25 nicht
            schon läuft
        - alias: Überproduktion Schwellwert und letzte Laufzeit prüfen
          condition: or
          conditions:
          - alias: Nur wenn wir jetzt gerade eine Überproduktion von 9 kWh im 30 Minuten
              Mittelwert haben
            condition: numeric_state
            entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
            below: -9000
          - alias: Prüfen, ob BPU von Haus 23 seit mindestens 18 Stunden nicht läuft
            condition: state
            entity_id: input_boolean.luxtronik_brauchwasser_haus_23
            state: 'off'
            for:
              hours: 18
              minutes: 0
              seconds: 0
          enabled: true
        - condition: template
          value_template: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
            - 1 )|int > 0 }}'
          alias: Testen, ob mindestens 1 Grad Temperaturunterschied TBW zu TBW Soll
        - alias: Prüfen, ob BPU von Haus 23 nicht läuft
          condition: state
          entity_id: binary_sensor.luxtronik23_bup_out
          state: 'off'
          enabled: true
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 23
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik23_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_23_ww_hysterese
        action: input_number.set_value
    - conditions:
      - alias: Vergleiche Haus 25 gegen die anderen Häuser
        condition: and
        conditions:
        - alias: Prüfen, ob BPU von Haus 25 seit mindestens 3 Stunden nicht läuft
          condition: state
          entity_id: input_boolean.luxtronik_brauchwasser_haus_25
          state: 'off'
          for:
            hours: 9
            minutes: 0
            seconds: 0
          enabled: false
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik19_tbw'')
            or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 19 oder der Boiler 19 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik21_tbw'')
            or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 21 oder der Boiler 21 nicht
            schon läuft
        - condition: template
          value_template: '{{states(''sensor.luxtronik25_tbw'') < states(''sensor.luxtronik23_tbw'')
            or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
          alias: Prüfen, ob Haus 25 Boiler kälter als Haus 23 oder der Boiler 23 nicht
            schon läuft
        - alias: Überproduktion Schwellwert und letzte Laufzeit prüfen
          condition: or
          conditions:
          - alias: Nur wenn wir jetzt gerade eine Überproduktion von 9 kWh im 30 Minuten
              Mittelwert haben
            condition: numeric_state
            entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
            below: -9000
          - alias: Prüfen, ob BPU von Haus 25 seit mindestens 18 Stunden nicht läuft
            condition: state
            entity_id: input_boolean.luxtronik_brauchwasser_haus_25
            state: 'off'
            for:
              hours: 18
              minutes: 0
              seconds: 0
          enabled: true
        - condition: template
          value_template: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
            - 1 )|int > 0 }}'
          alias: Testen, ob mindestens 1 Grad Temperaturunterschied TBW zu TBW Soll
        - alias: Prüfen, ob BPU von Haus 25 nicht läuft
          condition: state
          entity_id: binary_sensor.luxtronik25_bup_out
          state: 'off'
          enabled: true
      sequence:
      - data:
          title: HA-Info Rotseepark - WW Überschuss Prüfung erfolgreich -> Haus 25
            gewält
          message: 'BWT aktuell: {{states(''sensor.luxtronik25_tbw'')}}

            '
        action: notify.administrator_rotseepark
      - data:
          value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
            - 1 )|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
      - delay:
          hours: 0
          minutes: 8
          seconds: 0
          milliseconds: 0
      - data:
          value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
        target:
          entity_id: input_number.luxtronik_25_ww_hysterese
        action: input_number.set_value
  mode: parallel
  trace:
    stored_traces: 72
  max: 4
- id: '1717583790696'
  alias: Schalte WW - Bei Sonne während Sperrzeit auf Party schalten
  description: Diese Automation verwendet den Zeitplan Sperrzeit, welche die Brauchwasser
    Sperrzeiten der Wärmepumpe mit einem Vorlauf von 30 Minuten abbildet. Es wird
    am Morgen um 09:15 Uhr auf Party gestellt.
  triggers:
  - entity_id:
    - schedule.luxtronik_zeitplan_sperrzeit_warmwasser
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'off'
  - alias: Nur wenn der Produktion Forecast für den Rest des Tages mindestens 100
      kWh ist
    condition: numeric_state
    entity_id: sensor.forecast_solar_production_today_remaining
    above: 100
    enabled: true
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    alias: Montag bis Samstag
  - alias: Gültig nur vom 1. Mai bis zum 15. September
    condition: template
    value_template: "{{ true if ( \n  ((now().month >= 5 and now().month <= 8) or
      (now().month == 9 and now().day <= 15)) \n) else false }}"
  - alias: Gültig nur bei der Sperrzeitänderung um 9 Uhr
    condition: template
    value_template: "{{ true if ( \n  (now().hour == 9 ) \n) else false }}"
  actions:
  - alias: Haus 19 auf Party stellen, sofern BUP nicht läuft und Operating Mode auf
      Automatik ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik19_bup
        state: 'off'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_19_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_19_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 19: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 19 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 19
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Sonne)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen vorhandener Sonne
  - alias: Haus 21 auf Party stellen, sofern BUP nicht läuft und Operating Mode auf
      Automatik ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik21_bup
        state: 'off'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_21_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_21_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 21: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 21 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 21
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Sonne)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen vorhandener Sonne
  - alias: Haus 23 auf Party stellen, sofern BUP nicht läuft und Operating Mode auf
      Automatik ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik23_bup
        state: 'off'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_23_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_23_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 23: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 23 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 23
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Sonne)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen vorhandener Sonne
  - alias: Haus 25 auf Party stellen, sofern BUP nicht läuft und Operating Mode auf
      Automatik ist
    if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik25_bup
        state: 'off'
      - alias: Warmwasser Operating Mode ist "Automatik"
        condition: template
        value_template: '{{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''warmwater_operation_mode_string'']
          == "Automatik" }}'
      - condition: state
        entity_id: input_select.luxtronik_25_ww_operation_mode
        state: '0'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_25_ww_operation_mode
      action: input_select.select_option
    - data:
        title: 'HA-Info Heatpump 25: Warmwasser Operation Mode auf Party gestellt'
        message: Warmwasser Operation Mode Wärmepumpe Haus 25 auf Party gestellt,
          wegen drohender Sperrzeit
      action: notify.administrator_rotseepark
      enabled: false
    - variables:
        haus: 25
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Info Heatpump {{ haus }}: Warmwasser Operation Mode auf Party gestellt
          (Sonne)'
        message: Warmwasser Operation Mode Wärmepumpe Haus {{ haus }} auf Party gestellt,
          wegen vorhandener Sonne
  mode: single
- id: '1724084404780'
  alias: Monitoring Feuchtigkeit Gang 25 grösser 70%
  description: ''
  triggers:
  - entity_id:
    - sensor.shelly_h_t_keller_005_gang_25_humidity
    above: 70
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      title: 'HA-Info Haus 25: Wasser im Kellergang 25 (Feuchte > 70%)'
      target:
      - administrator@rotseepark.ch
      - cornel.schuler@gmail.com
      - ms_ruefenacht@bluewin.ch
      - andreasbaenziger@gmx.net
      message: Hoi zäme, dieses E-Mail wird automatisch von der Rotseepark Automatisation
        generiert, wenn die Luftfeuchtigkeit im Gang 25 grösser als 70% ist. Das bedeutet,
        dass wir eine Pfütze am Boden haben. Wenn ihr keinesfalls auf dem Verteiler
        sein wollt, dann schreibt mir doch kurz und ich nehme euch sofort wieder vom
        Verteiler weg. Liebe Grüsse, Stephan
    action: notify.administrator_rotseepark
    enabled: false
  - variables:
      haus: 25
  - action: script.send_a_notification_to_recipient_keller_25
    data:
      title: 'HA-Info Haus {{ haus }}: Wasser im Kellergang 25 (Feuchte > 70%)'
      message: Hoi zäme, dieses E-Mail wird automatisch von der Rotseepark Automatisation
        generiert, wenn die Luftfeuchtigkeit im Gang {{ haus }} grösser als 70% ist.
        Das bedeutet, dass wir eine Pfütze am Boden haben. Wenn ihr keinesfalls auf
        dem Verteiler sein wollt, dann schreibt mir doch kurz und ich nehme euch sofort
        wieder vom Verteiler weg. Liebe Grüsse, Stephan
  mode: single
- id: '1736691345450'
  alias: Zirkulationspumpe Haus 19 steuern
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /1
  conditions:
  - condition: or
    conditions:
    - condition: device
      type: is_off
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
      for:
        hours: 0
        minutes: 8
        seconds: 55
    - condition: device
      type: is_on
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
      for:
        hours: 0
        minutes: 0
        seconds: 55
  actions:
  - if:
    - condition: and
      conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik19_bup
          state: 'on'
          for:
            hours: 0
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: binary_sensor.luxtronik19_zw2sst
          state: 'on'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik19_tbw
          above: 52
        - condition: and
          conditions:
          - condition: numeric_state
            entity_id: sensor.luxtronik19_tbw
            above: 47
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
            state: 'off'
    then:
    - type: turn_on
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - binary_sensor.luxtronik19_bup
        to: 'off'
      timeout:
        hours: 4
        minutes: 0
        seconds: 0
    - if:
      - condition: state
        entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
        state: 'on'
      then:
      - wait_for_trigger:
        - trigger: state
          entity_id:
          - binary_sensor.luxtronik19_zw2sst
          to: 'off'
        timeout:
          hours: 4
          minutes: 0
          seconds: 0
    - type: turn_off
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
    else:
    - type: turn_on
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
    - type: turn_off
      device_id: 8840916586f94bbd739d8c550f7efb34
      entity_id: 1b02152a7e8c567be5368cd49925e5a2
      domain: switch
  mode: single
  max_exceeded: silent
- id: '1736691657967'
  alias: Zirkulationspumpe Haus 21 steuern
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /1
  conditions:
  - condition: or
    conditions:
    - condition: device
      type: is_off
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
      for:
        hours: 0
        minutes: 8
        seconds: 55
    - condition: device
      type: is_on
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
      for:
        hours: 0
        minutes: 0
        seconds: 55
  actions:
  - if:
    - condition: and
      conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik21_bup
          state: 'on'
          for:
            hours: 0
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: binary_sensor.luxtronik21_zw2sst
          state: 'on'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik21_tbw
          above: 52
        - condition: and
          conditions:
          - condition: numeric_state
            entity_id: sensor.luxtronik21_tbw
            above: 47
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
            state: 'off'
    then:
    - type: turn_on
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - binary_sensor.luxtronik21_bup
        to: 'off'
      timeout:
        hours: 4
        minutes: 0
        seconds: 0
    - if:
      - condition: state
        entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
        state: 'on'
      then:
      - wait_for_trigger:
        - trigger: state
          entity_id:
          - binary_sensor.luxtronik21_zw2sst
          to: 'off'
        timeout:
          hours: 4
          minutes: 0
          seconds: 0
    - type: turn_off
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
    else:
    - type: turn_on
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
    - type: turn_off
      device_id: b1de0410421616c83cc11a100bc006c6
      entity_id: 96bc762ede773497381d973a0d75f159
      domain: switch
  mode: single
  max_exceeded: silent
- id: '1736691944728'
  alias: Zirkulationspumpe Haus 23 steuern
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /1
  conditions:
  - condition: or
    conditions:
    - condition: device
      type: is_off
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
      for:
        hours: 0
        minutes: 8
        seconds: 55
    - condition: device
      type: is_on
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
      for:
        hours: 0
        minutes: 0
        seconds: 55
  actions:
  - if:
    - condition: and
      conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik23_bup
          state: 'on'
          for:
            hours: 0
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: binary_sensor.luxtronik23_zw2sst
          state: 'on'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik23_tbw
          above: 52
        - condition: and
          conditions:
          - condition: numeric_state
            entity_id: sensor.luxtronik23_tbw
            above: 47
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
            state: 'off'
    then:
    - type: turn_on
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - binary_sensor.luxtronik23_bup
        to: 'off'
      timeout:
        hours: 4
        minutes: 0
        seconds: 0
    - if:
      - condition: state
        entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
        state: 'on'
      then:
      - wait_for_trigger:
        - trigger: state
          entity_id:
          - binary_sensor.luxtronik23_zw2sst
          to: 'off'
        timeout:
          hours: 4
          minutes: 0
          seconds: 0
    - type: turn_off
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
    else:
    - type: turn_on
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
    - type: turn_off
      device_id: 98c48cbab07bc67f9d822220b4f49cec
      entity_id: f64a6dfcc8d49eee4b0541568dba27a4
      domain: switch
  mode: single
  max_exceeded: silent
- id: '1736692115895'
  alias: Zirkulationspumpe Haus 25 steuern
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /1
  conditions:
  - condition: or
    conditions:
    - condition: device
      type: is_off
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
      for:
        hours: 0
        minutes: 8
        seconds: 55
    - condition: device
      type: is_on
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
      for:
        hours: 0
        minutes: 0
        seconds: 55
  actions:
  - if:
    - condition: and
      conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.luxtronik25_bup
          state: 'on'
          for:
            hours: 0
            minutes: 0
            seconds: 0
        - condition: state
          entity_id: binary_sensor.luxtronik25_zw2sst
          state: 'on'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.luxtronik25_tbw
          above: 52
        - condition: and
          conditions:
          - condition: numeric_state
            entity_id: sensor.luxtronik25_tbw
            above: 47
          - condition: state
            entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
            state: 'off'
    then:
    - type: turn_on
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - binary_sensor.luxtronik25_bup
        to: 'off'
      timeout:
        hours: 4
        minutes: 0
        seconds: 0
    - if:
      - condition: state
        entity_id: schedule.luxtronik_zeitplan_thermische_desinfektion
        state: 'on'
      then:
      - wait_for_trigger:
        - trigger: state
          entity_id:
          - binary_sensor.luxtronik25_zw2sst
          to: 'off'
        timeout:
          hours: 4
          minutes: 0
          seconds: 0
    - type: turn_off
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
    else:
    - type: turn_on
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
    - type: turn_off
      device_id: e6090d68e281566e5caa38ccfc13165b
      entity_id: 6e4cff1b05f92db03aee98dfc835e790
      domain: switch
  mode: single
  max_exceeded: silent
- id: '1737556310912'
  alias: Heizung Hysterese Haus 19 steuern
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik19_vd1
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik19_vd2
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik19_vd1
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik19_vd2
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik19_hup
      state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik19_vd1
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik19_vd2
      from: 'on'
      to: 'off'
    timeout:
      hours: 18
      minutes: 0
      seconds: 0
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik19_vd1
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      - condition: state
        entity_id: binary_sensor.luxtronik19_vd2
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik19_hup
      state: 'on'
    - condition: numeric_state
      entity_id: sensor.luxtronik19_spz_trl_soll_ext
      above: 1.7
      enabled: false
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_maximalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_19_hz_hysterese
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_normalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_19_hz_hysterese
  mode: single
  max_exceeded: silent
- id: '1737579000796'
  alias: Heizung Hysterese Haus 21 steuern
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik21_vd1
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik21_vd2
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik21_vd1
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik21_vd2
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik21_hup
      state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik21_vd1
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik21_vd2
      from: 'on'
      to: 'off'
    timeout:
      hours: 18
      minutes: 0
      seconds: 0
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik21_vd1
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      - condition: state
        entity_id: binary_sensor.luxtronik21_vd2
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik21_hup
      state: 'on'
    - condition: numeric_state
      entity_id: sensor.luxtronik21_spz_trl_soll_ext
      above: 1.7
      enabled: false
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_maximalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_21_hz_hysterese
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_normalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_21_hz_hysterese
  mode: single
  max_exceeded: silent
- id: '1737579039262'
  alias: Heizung Hysterese Haus 23 steuern
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik23_vd1
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik23_vd2
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik23_vd1
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik23_vd2
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik23_hup
      state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik23_vd1
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik23_vd2
      from: 'on'
      to: 'off'
    timeout:
      hours: 18
      minutes: 0
      seconds: 0
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik23_vd1
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      - condition: state
        entity_id: binary_sensor.luxtronik23_vd2
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik23_hup
      state: 'on'
    - condition: numeric_state
      entity_id: sensor.luxtronik23_spz_trl_soll_ext
      above: 1.7
      enabled: false
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_maximalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_23_hz_hysterese
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_normalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_23_hz_hysterese
  mode: single
  max_exceeded: silent
- id: '1737579077046'
  alias: Heizung Hysterese Haus 25 steuern
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik25_vd1
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.luxtronik25_vd2
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.luxtronik25_vd1
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik25_vd2
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik25_hup
      state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik25_vd1
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id:
      - binary_sensor.luxtronik25_vd2
      from: 'on'
      to: 'off'
    timeout:
      hours: 18
      minutes: 0
      seconds: 0
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.luxtronik25_vd1
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      - condition: state
        entity_id: binary_sensor.luxtronik25_vd2
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'off'
    - condition: state
      entity_id: binary_sensor.luxtronik25_hup
      state: 'on'
    - condition: numeric_state
      entity_id: sensor.luxtronik25_spz_trl_soll_ext
      above: 1.7
      enabled: false
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_maximalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_25_hz_hysterese
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: input_number.set_value
    metadata: {}
    data:
      value: '{{ states(''input_number.luxtronik_hz_normalhysterese'')|float }}'
    target:
      entity_id: input_number.luxtronik_25_hz_hysterese
  mode: single
  max_exceeded: silent
- id: '1742449063045'
  alias: Zaptec Überschussladung PP 33
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /20
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    above: 0
  - trigger: state
    entity_id:
    - number.zaptec_charger_pp_33_status_indicator_brightness
  conditions:
  - alias: Wenn LED den Status Nicht verfügbar oder Unbekannt hat, dann stoppen wir
      hier
    condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
        state: unavailable
      - condition: state
        entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
        state: unknown
  - condition: numeric_state
    entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
    above: 49.5
    below: 57.51
    alias: Wenn LED zwischen 49.50 und 57.51 ist,  gehen wir weiter
  - condition: numeric_state
    entity_id: automation.zaptec_uberschussladung_pp_33
    attribute: current
    below: 1
    alias: Wenn bereits eine parallele zweite Automation läuft, dann stoppen wir hier
  - condition: time
    after: 05:00:00
    before: '21:00:00'
  - condition: or
    conditions:
    - condition: state
      entity_id: number.zaptec_charger_pp_33_charger_max_current
      state:
      - '0.0'
      - '32.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: number.zaptec_charger_pp_33_charger_max_current
      state: '12.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    enabled: true
    alias: Wenn Max Current seit mindestens 5 Minuten 32A oder 12A ist, gehen wir
      weiter
  - condition: not
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
        above: 49.5
        below: 50.51
      - condition: state
        entity_id: number.zaptec_charger_pp_33_charger_max_current
        state: '32.0'
    alias: Wenn LED zwischen 49.50 und 50.51 und Max Current 32A ist, dann stoppen
      wir hier
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - alias: Brightness 50
          condition: and
          conditions:
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 49.5
            below: 50.51
        - alias: Zeitplan Montag aktiv und Brightness 51
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_1_montag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 50.5
            below: 51.51
        - alias: Zeitplan Dienstag aktiv und Brightness 52
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_2_dienstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 51.5
            below: 52.51
        - alias: Zeitplan Mittwoch aktiv und Brightness 53
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_3_mittwoch
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 52.5
            below: 53.51
        - alias: Zeitplan Donnerstag aktiv und Brightness 54
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_4_donnerstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 53.5
            below: 54.51
        - alias: Zeitplan Freitag aktiv und Brightness 55
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_5_freitag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 54.5
            below: 55.51
        - alias: Zeitplan Samstag aktiv und Brightness 56
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_6_samstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 55.5
            below: 56.51
        - alias: Zeitplan Sonntag aktiv und Brightness 57
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_7_sonntag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_33_status_indicator_brightness
            above: 56.5
            below: 57.51
        - condition: state
          entity_id: sensor.zaptec_charger_pp_33_charger_mode
          state: Charge done
        alias: Wenn LED 50 oder LED 51-57 (Zeitplan aktiv) oder Charge done, dann
          gehen wir weiter
      sequence:
      - condition: state
        entity_id: number.zaptec_charger_pp_33_charger_max_current
        state:
        - '0.0'
        - '12.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - device_id: d683235b4aa8e6b473c394bf1828cefa
        domain: number
        entity_id: 9409891f811f6f206783df40b76faddf
        type: set_value
        value: 32
        alias: Stelle den Wert Max Current auf 32
      - alias: Warten bis zu 2 Minuten auf Max Current 32 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_33_charger_max_current
          to: '32.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - device_id: d683235b4aa8e6b473c394bf1828cefa
        domain: number
        entity_id: e2c04daa7bc803d47d0e6f08f8e692b5
        type: set_value
        value: 50
        alias: Stelle den Wert der LED auf 50
      - alias: Warten bis zu 2 Minuten auf LED 50 und fahre sonst fort
        wait_for_trigger:
        - trigger: numeric_state
          entity_id:
          - number.zaptec_charger_pp_33_status_indicator_brightness
          above: 49.5
          below: 50.51
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Setze maximale Ladeleistung  (Leistung 32A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: stephan.buehler@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 33 - Setze maximale Ladeleistung (Leistung
            32A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_33_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_33_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_33_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      alias: Bedingungsloses laden in der Nacht oder bei Brightness 50
    default:
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          below: -10000
        alias: Wenn die Energiesensoren UMG604 15, 30 und 60 Minuten alle < -10000
          sind
      then:
      - condition: state
        entity_id: number.zaptec_charger_pp_33_charger_max_current
        state:
        - '0.0'
        - '32.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - condition: numeric_state
        entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
        below: -10000
      - device_id: d683235b4aa8e6b473c394bf1828cefa
        domain: number
        entity_id: 9409891f811f6f206783df40b76faddf
        type: set_value
        value: 12
        alias: Stelle den Wert für Zaptec Charger PP 33 Charger max current auf 12
      - alias: Warten bis zu 2 Minuten auf Max Current 12 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_33_charger_max_current
          to: '12.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Starte Überschuss Ladung (Leistung 12A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: stephan.buehler@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 33 - Starte Überschuss Ladung (Leistung
            12A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_33_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_33_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_33_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das Laden beendet werden kann
      else:
      - condition: state
        entity_id: number.zaptec_charger_pp_33_charger_max_current
        state:
        - '12.0'
        - '32.0'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          above: 0
        alias: Wenn einer der Energiesensoren UMG604 15, 30 oder 60 Minuten > 0 ist
      - device_id: d683235b4aa8e6b473c394bf1828cefa
        domain: number
        entity_id: 9409891f811f6f206783df40b76faddf
        type: set_value
        value: 0
        alias: Stelle den Wert für Zaptec Charger PP 33 Charger max current auf 0
      - alias: Warten bis zu 2 Minuten auf Max Current 0 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_33_charger_max_current
          to: '0.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: stephan.buehler@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 33 - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_33_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_33_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_33_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das nächste Laden erfolgen kann
  mode: parallel
  max: 10
- id: '1742596844210'
  alias: Überschuss Ladung Shelly Light schalten
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_solar_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 100
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_solar_w
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 101
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: -5000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: -5000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: -10000
  - trigger: sun
    event: sunset
    offset: 0
  - trigger: time_pattern
    minutes: /5
  conditions:
  - condition: numeric_state
    entity_id: automation.uberschuss_ladung_shelly_light_schalten
    attribute: current
    below: 1
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/status.txt
      value: UMG604;{{ states('sensor.energy_statistic_janitza_umg604_w_30_min') }}
    alias: UMG604 30 Minuten Mittel
  - alias: Forecast Solar Remaining Today
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Forecast;{{ states('sensor.forecast_solar_production_today_remaining')
        }}
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_solar_w') }};Solarstrom
        (+)
    alias: Solarstrom
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_heatpump_hz_w') }};Heizung
        (-)
    alias: Heizung
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_heatpump_ww_w') }};Brauchwasser
        (-)
    alias: Brauchwasser
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_hauser_w') }};Wohnungen
        (-)
    alias: Wohnungen
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_allgemein_w') }};Allgemein
        (-)
    alias: Allgemein
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_gplug_haus_21_luftung_w')
        }};Lüftung (-)
    alias: Lüftung
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_shelly_secomat_w') }};Secomaten
        (-)
    alias: Secomaten
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_emobilitat_w') }};Elektromobilität
        (-)
    alias: Elektromobilität
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/status.txt
      value: Verbraucher;{{ states('sensor.energy_statistic_janitza_umg604_w') }};Hausanschluss
        (+/-)
    alias: Hausanschluss
  - if:
    - condition: numeric_state
      entity_id: sensor.energy_statistic_solar_w
      above: 100
    then:
    - choose:
      - conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          above: 10000
        sequence:
        - condition: state
          entity_id: input_select.shelly_light_bulb_status
          state:
          - aus
          - rot
          - orange
          - grün
          - violett
          - gelb
        - action: input_select.select_option
          target:
            entity_id: input_select.shelly_light_bulb_status
          data:
            option: blau
        - action: script.uberschuss_shelly_light_blue
          metadata: {}
          data: {}
        - action: shell_command.file_action
          data:
            mode: copy-replace
            file1: /share/shelly/blau.jpg
            file2: /share/rotseepark.ch/status.jpg
      - conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -10000
        sequence:
        - condition: state
          entity_id: input_select.shelly_light_bulb_status
          state:
          - aus
          - grün
          - orange
          - blau
          - violett
          - gelb
        - action: input_select.select_option
          target:
            entity_id: input_select.shelly_light_bulb_status
          data:
            option: rot
        - action: script.uberschuss_shelly_light_red
          metadata: {}
          data: {}
        - action: shell_command.file_action
          data:
            mode: copy-replace
            file1: /share/shelly/rot.jpg
            file2: /share/rotseepark.ch/status.jpg
      - conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -5000
        sequence:
        - condition: state
          entity_id: input_select.shelly_light_bulb_status
          state:
          - aus
          - rot
          - grün
          - blau
          - violett
          - gelb
        - action: input_select.select_option
          target:
            entity_id: input_select.shelly_light_bulb_status
          data:
            option: orange
        - action: script.uberschuss_shelly_light_orange
          metadata: {}
          data: {}
        - action: shell_command.file_action
          data:
            mode: copy-replace
            file1: /share/shelly/orange.jpg
            file2: /share/rotseepark.ch/status.jpg
      - conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: 0
        sequence:
        - condition: state
          entity_id: input_select.shelly_light_bulb_status
          state:
          - aus
          - rot
          - orange
          - grün
          - blau
          - violett
        - action: input_select.select_option
          target:
            entity_id: input_select.shelly_light_bulb_status
          data:
            option: gelb
        - action: script.uberschuss_shelly_light_yellow
          metadata: {}
          data: {}
        - action: shell_command.file_action
          data:
            mode: copy-replace
            file1: /share/shelly/gelb.jpg
            file2: /share/rotseepark.ch/status.jpg
      - conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: 10000
        sequence:
        - condition: state
          entity_id: input_select.shelly_light_bulb_status
          state:
          - aus
          - rot
          - orange
          - grün
          - blau
          - gelb
        - action: input_select.select_option
          target:
            entity_id: input_select.shelly_light_bulb_status
          data:
            option: violett
        - action: script.uberschuss_shelly_light_violet
          metadata: {}
          data: {}
        - action: shell_command.file_action
          data:
            mode: copy-replace
            file1: /share/shelly/violett.jpg
            file2: /share/rotseepark.ch/status.jpg
      default:
      - condition: state
        entity_id: input_select.shelly_light_bulb_status
        state:
        - aus
        - rot
        - grün
        - orange
        - violett
        - gelb
      - action: input_select.select_option
        target:
          entity_id: input_select.shelly_light_bulb_status
        data:
          option: blau
      - action: script.uberschuss_shelly_light_blue
        metadata: {}
        data: {}
      - action: shell_command.file_action
        data:
          mode: copy-replace
          file1: /share/shelly/blau.jpg
          file2: /share/rotseepark.ch/status.jpg
    else:
    - condition: state
      entity_id: input_select.shelly_light_bulb_status
      state:
      - blau
      - rot
      - grün
      - orange
      - violett
      - gelb
    - action: input_select.select_option
      target:
        entity_id: input_select.shelly_light_bulb_status
      data:
        option: aus
    - action: script.uberschuss_shelly_light_off
      metadata: {}
      data: {}
    - action: shell_command.file_action
      data:
        mode: copy-replace
        file1: /share/shelly/off.jpg
        file2: /share/rotseepark.ch/status.jpg
  - action: shell_command.ha_to_rotseepark
    data: {}
  mode: parallel
  max: 10
- id: '1743755494863'
  alias: Zaptec Überschussladung PP 80
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /20
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    above: 0
  - trigger: state
    entity_id:
    - number.zaptec_charger_pp_80_status_indicator_brightness
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
        state: unavailable
      - condition: state
        entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
        state: unknown
    alias: Wenn LED den Status Nicht verfügbar oder Unbekannt hat, dann stoppen wir
      hier
  - condition: numeric_state
    entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
    above: 49.5
    below: 57.51
    alias: Wenn LED zwischen 49.50 und 57.51 ist,  gehen wir weiter
  - condition: numeric_state
    entity_id: automation.zaptec_uberschussladung_pp_80
    attribute: current
    below: 1
    alias: Wenn bereits eine parallele zweite Automation läuft, dann stoppen wir hier
  - condition: time
    after: 05:00:00
    before: '21:00:00'
  - condition: or
    conditions:
    - condition: state
      entity_id: number.zaptec_charger_pp_80_charger_max_current
      state:
      - '0.0'
      - '32.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: number.zaptec_charger_pp_80_charger_max_current
      state: '12.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    enabled: true
    alias: Wenn Max Current seit mindestens 5 Minuten 32A oder 12A ist, gehen wir
      weiter
  - condition: not
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
        above: 49.5
        below: 50.51
      - condition: state
        entity_id: number.zaptec_charger_pp_80_charger_max_current
        state: '32.0'
    alias: Wenn LED zwischen 49.50 und 50.51 und Max Current 32A ist, dann stoppen
      wir hier
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - alias: Brightness 50
          condition: and
          conditions:
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 49.5
            below: 50.51
        - alias: Zeitplan Montag aktiv und Brightness 51
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_1_montag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 50.5
            below: 51.51
        - alias: Zeitplan Dienstag aktiv und Brightness 52
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_2_dienstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 51.5
            below: 52.51
        - alias: Zeitplan Mittwoch aktiv und Brightness 53
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_3_mittwoch
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 52.5
            below: 53.51
        - alias: Zeitplan Donnerstag aktiv und Brightness 54
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_4_donnerstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 53.5
            below: 54.51
        - alias: Zeitplan Freitag aktiv und Brightness 55
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_5_freitag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 54.5
            below: 55.51
        - alias: Zeitplan Samstag aktiv und Brightness 56
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_6_samstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 55.5
            below: 56.51
        - alias: Zeitplan Sonntag aktiv und Brightness 57
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_7_sonntag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_80_status_indicator_brightness
            above: 56.5
            below: 57.51
        - condition: state
          entity_id: sensor.zaptec_charger_pp_80_charger_mode
          state: Charge done
        alias: Wenn LED 50 oder LED 51-57 (Zeitplan aktiv) oder Charge done, dann
          gehen wir weiter
      sequence:
      - condition: state
        entity_id: number.zaptec_charger_pp_80_charger_max_current
        state:
        - '0.0'
        - '12.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - alias: Stelle den Wert Max Current auf 32
        device_id: 1064b2f7a64cab444f2917c20b791cff
        domain: number
        entity_id: a258998459fb974f35b252389d6a6934
        type: set_value
        value: 32
      - alias: Warten bis zu 2 Minuten auf Max Current 32 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_80_charger_max_current
          to: '32.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - device_id: 1064b2f7a64cab444f2917c20b791cff
        domain: number
        entity_id: c4da376875b6bb06638c2832ae91225b
        type: set_value
        value: 50
        alias: Stelle den Wert der LED auf 50
      - alias: Warten bis zu 2 Minuten auf LED 50 und fahre sonst fort
        wait_for_trigger:
        - trigger: numeric_state
          entity_id:
          - number.zaptec_charger_pp_80_status_indicator_brightness
          above: 49.5
          below: 50.51
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Setze maximale Ladeleistung  (Leistung 32A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: si.hess@bluewin.ch
      - data:
          title: 'HA-Info Einstellhalle: PP 80 - Setze maximale Ladeleistung (Leistung
            32A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_80_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_80_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_80_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
    default:
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          below: -10000
        alias: Wenn die Energiesensoren UMG604 15, 30 und 60 Minuten alle < -10000
          sind
      then:
      - condition: state
        entity_id: number.zaptec_charger_pp_80_charger_max_current
        state:
        - '0.0'
        - '32.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - condition: numeric_state
        entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
        below: -10000
      - alias: Stelle den Wert für Zaptec Charger PP 80 Charger max current auf 12
        device_id: 1064b2f7a64cab444f2917c20b791cff
        domain: number
        entity_id: a258998459fb974f35b252389d6a6934
        type: set_value
        value: 12
      - alias: Warten bis zu 2 Minuten auf Max Current 12 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_80_charger_max_current
          to: '12.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Starte Überschuss Ladung (Leistung 12A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: si.hess@bluewin.ch
      - data:
          title: 'HA-Info Einstellhalle: PP 80 - Starte Überschuss Ladung (Leistung
            12A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_80_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_80_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_80_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das Laden beendet werden kann
      else:
      - condition: state
        entity_id: number.zaptec_charger_pp_80_charger_max_current
        state:
        - '12.0'
        - '32.0'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          above: 0
        alias: Wenn einer der Energiesensoren UMG604 15, 30 oder 60 Minuten > 0 ist
      - alias: Stelle den Wert für Zaptec Charger PP 80 Charger max current auf 0
        device_id: 1064b2f7a64cab444f2917c20b791cff
        domain: number
        entity_id: a258998459fb974f35b252389d6a6934
        type: set_value
        value: 0
      - alias: Warten bis zu 2 Minuten auf Max Current 0 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_80_charger_max_current
          to: '0.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: si.hess@bluewin.ch
      - data:
          title: 'HA-Info Einstellhalle: PP 80 - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_80_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_80_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_80_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das nächste Laden erfolgen kann
  mode: parallel
  max: 10
- id: '1744100621103'
  alias: Zaptec Überschussladung PP 85
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /20
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    above: 0
  - trigger: state
    entity_id:
    - number.zaptec_charger_pp_85_status_indicator_brightness
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
        state: unavailable
      - condition: state
        entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
        state: unknown
    alias: Wenn LED den Status Nicht verfügbar oder Unbekannt hat, dann stoppen wir
      hier
  - condition: numeric_state
    entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
    above: 49.5
    below: 57.51
    alias: Wenn LED zwischen 49.50 und 57.51 ist,  gehen wir weiter
  - condition: numeric_state
    entity_id: automation.zaptec_uberschussladung_pp_85
    attribute: current
    below: 1
    alias: Wenn bereits eine parallele zweite Automation läuft, dann stoppen wir hier
  - condition: time
    after: 05:00:00
    before: '21:00:00'
  - condition: or
    conditions:
    - condition: state
      entity_id: number.zaptec_charger_pp_85_charger_max_current
      state:
      - '0.0'
      - '32.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: number.zaptec_charger_pp_85_charger_max_current
      state: '12.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    enabled: true
    alias: Wenn Max Current seit mindestens 5 Minuten 32A oder 12A ist, gehen wir
      weiter
  - condition: not
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
        above: 49.5
        below: 50.51
      - condition: state
        entity_id: number.zaptec_charger_pp_85_charger_max_current
        state: '32.0'
    alias: Wenn LED zwischen 49.50 und 50.51 und Max Current 32A ist, dann stoppen
      wir hier
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - alias: Brightness 50
          condition: and
          conditions:
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 49.5
            below: 50.51
        - alias: Zeitplan Montag aktiv und Brightness 51
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_1_montag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 50.5
            below: 51.51
        - alias: Zeitplan Dienstag aktiv und Brightness 52
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_2_dienstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 51.5
            below: 52.51
        - alias: Zeitplan Mittwoch aktiv und Brightness 53
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_3_mittwoch
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 52.5
            below: 53.51
        - alias: Zeitplan Donnerstag aktiv und Brightness 54
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_4_donnerstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 53.5
            below: 54.51
        - alias: Zeitplan Freitag aktiv und Brightness 55
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_5_freitag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 54.5
            below: 55.51
        - alias: Zeitplan Samstag aktiv und Brightness 56
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_6_samstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 55.5
            below: 56.51
        - alias: Zeitplan Sonntag aktiv und Brightness 57
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_7_sonntag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_85_status_indicator_brightness
            above: 56.5
            below: 57.51
        - condition: state
          entity_id: sensor.zaptec_charger_pp_85_charger_mode
          state: Charge done
        alias: Wenn LED 50 oder LED 51-57 (Zeitplan aktiv) oder Charge done, dann
          gehen wir weiter
      sequence:
      - condition: state
        entity_id: number.zaptec_charger_pp_85_charger_max_current
        state:
        - '0.0'
        - '12.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - alias: Stelle den Wert Max Current auf 32
        device_id: b481f1f85d8ede43a7420ce485ee0b56
        domain: number
        entity_id: 4268338178a99229f00dbd86685e92b2
        type: set_value
        value: 32
      - alias: Warten bis zu 2 Minuten auf Max Current 32 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_85_charger_max_current
          to: '32.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - device_id: b481f1f85d8ede43a7420ce485ee0b56
        domain: number
        entity_id: 7188dbab858bbb41b6f88e6797754373
        type: set_value
        value: 50
        alias: Stelle den Wert der LED auf 50
      - alias: Warten bis zu 2 Minuten auf LED 50 und fahre sonst fort
        wait_for_trigger:
        - trigger: numeric_state
          entity_id:
          - number.zaptec_charger_pp_85_status_indicator_brightness
          above: 49.5
          below: 50.51
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Setze maximale Ladeleistung  (Leistung 32A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: SBaumann@sbt-ag.ch
        enabled: false
      - data:
          title: 'HA-Info Einstellhalle: PP 85 - Setze maximale Ladeleistung (Leistung
            32A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_85_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_85_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_85_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
    default:
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          below: -10000
        alias: Wenn die Energiesensoren UMG604 15, 30 und 60 Minuten alle < -10000
          sind
      then:
      - condition: state
        entity_id: number.zaptec_charger_pp_85_charger_max_current
        state:
        - '0.0'
        - '32.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - condition: numeric_state
        entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
        below: -10000
      - alias: Stelle den Wert für Zaptec Charger PP 85 Charger max current auf 12
        device_id: b481f1f85d8ede43a7420ce485ee0b56
        domain: number
        entity_id: 4268338178a99229f00dbd86685e92b2
        type: set_value
        value: 12
      - alias: Warten bis zu 2 Minuten auf Max Current 12 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_85_charger_max_current
          to: '12.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Starte Überschuss Ladung (Leistung 12A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: SBaumann@sbt-ag.ch
        enabled: false
      - data:
          title: 'HA-Info Einstellhalle: PP 85 - Starte Überschuss Ladung (Leistung
            12A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_85_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_85_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_85_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das Laden beendet werden kann
      else:
      - condition: state
        entity_id: number.zaptec_charger_pp_85_charger_max_current
        state:
        - '12.0'
        - '32.0'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          above: 0
        alias: Wenn einer der Energiesensoren UMG604 15, 30 oder 60 Minuten > 0 ist
      - alias: Stelle den Wert für Zaptec Charger PP 85 Charger max current auf 0
        device_id: b481f1f85d8ede43a7420ce485ee0b56
        domain: number
        entity_id: 4268338178a99229f00dbd86685e92b2
        type: set_value
        value: 0
      - alias: Warten bis zu 2 Minuten auf Max Current 0 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_85_charger_max_current
          to: '0.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: SBaumann@sbt-ag.ch
        enabled: false
      - data:
          title: 'HA-Info Einstellhalle: PP 85 - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_85_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_85_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_85_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das nächste Laden erfolgen kann
  mode: parallel
  max: 10
- id: '1745134879688'
  alias: Transferiere Luxtronik DTA Dateien - 21
  description: ''
  triggers:
  - hours: '6'
    trigger: time_pattern
    enabled: true
    minutes: '21'
  conditions:
  - condition: time
    weekday:
    - sun
    enabled: true
  actions:
  - data: {}
    response_variable: scriptanswer
    action: shell_command.luxtronik21_to_ha
  - if:
    - condition: template
      value_template: '{{ scriptanswer[''stdout''] | regex_search(''Return:0-0-0-0-[0-9]*'')
        }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Info Heatpump 21 - Dateien gesichert mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0]-[0]-[0]-[0]-[0-9]*'))[0] }}
    else:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Alert Heatpump 21 - Dateien sichern FEHLGESCHLAGEN mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0-9]*-[0-9]*-[0-9]*-[0-9]*-[0-9]*'))[0] }}
  mode: single
- id: '1745141012478'
  alias: Transferiere Luxtronik DTA Dateien - 19
  description: ''
  triggers:
  - hours: '6'
    trigger: time_pattern
    enabled: true
    minutes: '19'
  conditions:
  - condition: time
    weekday:
    - sun
    enabled: true
  actions:
  - data: {}
    response_variable: scriptanswer
    action: shell_command.luxtronik19_to_ha
    enabled: true
  - if:
    - condition: template
      value_template: '{{ scriptanswer[''stdout''] | regex_search(''Return:0-0-0-0-[0-9]*'')
        }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Info Heatpump 19 - Dateien gesichert mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0]-[0]-[0]-[0]-[0-9]*'))[0] }}
    else:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Alert Heatpump 19 - Dateien sichern FEHLGESCHLAGEN mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0-9]*-[0-9]*-[0-9]*-[0-9]*-[0-9]*'))[0] }}
    enabled: true
  mode: single
- id: '1745141053335'
  alias: Transferiere Luxtronik DTA Dateien - 23
  description: ''
  triggers:
  - hours: '6'
    trigger: time_pattern
    enabled: true
    minutes: '23'
  conditions:
  - condition: time
    weekday:
    - sun
    enabled: true
  actions:
  - data: {}
    response_variable: scriptanswer
    action: shell_command.luxtronik23_to_ha
    enabled: true
  - if:
    - condition: template
      value_template: '{{ scriptanswer[''stdout''] | regex_search(''Return:0-0-0-0-[0-9]*'')
        }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Info Heatpump 23 - Dateien gesichert mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0]-[0]-[0]-[0]-[0-9]*'))[0] }}
    else:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Alert Heatpump 23 - Dateien sichern FEHLGESCHLAGEN mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0-9]*-[0-9]*-[0-9]*-[0-9]*-[0-9]*'))[0] }}
    enabled: true
  mode: single
- id: '1745141086702'
  alias: Transferiere Luxtronik DTA Dateien - 25
  description: ''
  triggers:
  - hours: '6'
    trigger: time_pattern
    enabled: true
    minutes: '25'
  conditions:
  - condition: time
    weekday:
    - sun
    enabled: true
  actions:
  - data: {}
    response_variable: scriptanswer
    action: shell_command.luxtronik25_to_ha
    enabled: true
  - if:
    - condition: template
      value_template: '{{ scriptanswer[''stdout''] | regex_search(''Return:0-0-0-0-[0-9]*'')
        }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Info Heatpump 25 - Dateien gesichert mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0]-[0]-[0]-[0]-[0-9]*'))[0] }}
    else:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        message: '{{scriptanswer[''stdout'']}}'
        title: HA-Alert Heatpump 25 - Dateien sichern FEHLGESCHLAGEN mit {{ (scriptanswer['stdout']
          | regex_findall('Return:[0-9]*-[0-9]*-[0-9]*-[0-9]*-[0-9]*'))[0] }}
    enabled: true
  mode: single
- id: '1749190070438'
  alias: Schalte CL - Setze CL Operation Mode Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_19_cl_operation_mode
    trigger: state
    from: '0'
    to: '1'
  - entity_id:
    - input_select.luxtronik_19_cl_operation_mode
    trigger: state
    from: '1'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Kühlung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''cooling_operation_mode'']
            != states(''input_select.luxtronik_19_cl_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 19
          value: '{{ states(''input_select.luxtronik_19_cl_operation_mode'')|int }}'
        action: script.schalte_kuhlung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_19_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Kühlung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Kühlung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''cooling_operation_mode'']
        != states(''input_select.luxtronik_19_cl_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - HZ Haus 19 Kühlung Operation Mode nicht gesetzt
        message: 'Kühlung Operation Mode Soll:  {{states(''input_select.luxtronik_19_cl_operation_mode'')|int}}

          Kühlung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''cooling_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_19_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Kühlung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1749190203042'
  alias: Schalte CL - Setze CL Operation Mode Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_21_cl_operation_mode
    trigger: state
    from: '0'
    to: '1'
  - entity_id:
    - input_select.luxtronik_21_cl_operation_mode
    trigger: state
    from: '1'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Kühlung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''cooling_operation_mode'']
            != states(''input_select.luxtronik_21_cl_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 21
          value: '{{ states(''input_select.luxtronik_21_cl_operation_mode'')|int }}'
        action: script.schalte_kuhlung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_21_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Kühlung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Kühlung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''cooling_operation_mode'']
        != states(''input_select.luxtronik_21_cl_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - HZ Haus 21 Kühlung Operation Mode nicht gesetzt
        message: 'Kühlung Operation Mode Soll:  {{states(''input_select.luxtronik_21_cl_operation_mode'')|int}}

          Kühlung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''cooling_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_21_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Kühlung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1749190251986'
  alias: Schalte CL - Setze CL Operation Mode Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_23_cl_operation_mode
    trigger: state
    from: '0'
    to: '1'
  - entity_id:
    - input_select.luxtronik_23_cl_operation_mode
    trigger: state
    from: '1'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Kühlung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''cooling_operation_mode'']
            != states(''input_select.luxtronik_23_cl_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 23
          value: '{{ states(''input_select.luxtronik_23_cl_operation_mode'')|int }}'
        action: script.schalte_kuhlung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_23_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Kühlung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Kühlung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''cooling_operation_mode'']
        != states(''input_select.luxtronik_23_cl_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - HZ Haus 23 Kühlung Operation Mode nicht gesetzt
        message: 'Kühlung Operation Mode Soll:  {{states(''input_select.luxtronik_23_cl_operation_mode'')|int}}

          Kühlung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''cooling_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_23_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Kühlung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1749190288951'
  alias: Schalte CL - Setze CL Operation Mode Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_select.luxtronik_25_cl_operation_mode
    trigger: state
    from: '0'
    to: '1'
  - entity_id:
    - input_select.luxtronik_25_cl_operation_mode
    trigger: state
    from: '1'
    to: '0'
  conditions: []
  actions:
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Kühlung Operation Mode gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''cooling_operation_mode'']
            != states(''input_select.luxtronik_25_cl_operation_mode'')|int) }}'
        - condition: template
          value_template: '{{ (repeat.index < 5) }}'
      sequence:
      - data:
          heatpump: 25
          value: '{{ states(''input_select.luxtronik_25_cl_operation_mode'')|int }}'
        action: script.schalte_kuhlung_operation_mode
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - data: {}
        target:
          entity_id: sensor.luxtronik_25_param_state
        action: homeassistant.update_entity
      - delay:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
    alias: Wiederhole, bis Parameter Kühlung Operation Mode gesetzt werden konnte
  - if:
    - condition: template
      alias: NOT Parameter Kühlung Operation Mode gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''cooling_operation_mode'']
        != states(''input_select.luxtronik_25_cl_operation_mode'')|int) }}'
    then:
    - data:
        title: HA-Alert Rotseepark - HZ Haus 25 Kühlung Operation Mode nicht gesetzt
        message: 'Kühlung Operation Mode Soll:  {{states(''input_select.luxtronik_25_cl_operation_mode'')|int}}

          Kühlung Operation Mode Ist :  {{state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''cooling_operation_mode'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_25_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          '
      action: notify.administrator_rotseepark
    alias: Sende eine Benachrichtigung, wenn die Kühlung Operation Mode nicht gesetzt
      werden konnte
  mode: single
- id: '1752209277834'
  alias: Zaptec Überschussladung PP 29
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /20
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    below: -10000
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_15_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_30_min
    above: 0
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_janitza_umg604_w_60_min
    above: 0
  - trigger: state
    entity_id:
    - number.zaptec_charger_pp_29_status_indicator_brightness
  conditions:
  - alias: Wenn LED den Status Nicht verfügbar oder Unbekannt hat, dann stoppen wir
      hier
    condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
        state: unavailable
      - condition: state
        entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
        state: unknown
  - condition: numeric_state
    entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
    above: 49.5
    below: 57.51
    alias: Wenn LED zwischen 49.50 und 57.51 ist,  gehen wir weiter
  - condition: numeric_state
    entity_id: automation.zaptec_uberschussladung_pp_29
    attribute: current
    below: 1
    alias: Wenn bereits eine parallele zweite Automation läuft, dann stoppen wir hier
  - condition: time
    after: 05:00:00
    before: '21:00:00'
  - condition: or
    conditions:
    - condition: state
      entity_id: number.zaptec_charger_pp_29_charger_max_current
      state:
      - '0.0'
      - '32.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - condition: state
      entity_id: number.zaptec_charger_pp_29_charger_max_current
      state: '12.0'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    enabled: true
    alias: Wenn Max Current seit mindestens 5 Minuten 32A oder 12A ist, gehen wir
      weiter
  - condition: not
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
        above: 49.5
        below: 50.51
      - condition: state
        entity_id: number.zaptec_charger_pp_29_charger_max_current
        state: '32.0'
    alias: Wenn LED zwischen 49.50 und 50.51 und Max Current 32A ist, dann stoppen
      wir hier
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - alias: Brightness 50
          condition: and
          conditions:
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 49.5
            below: 50.51
        - alias: Zeitplan Montag aktiv und Brightness 51
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_1_montag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 50.5
            below: 51.51
        - alias: Zeitplan Dienstag aktiv und Brightness 52
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_2_dienstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 51.5
            below: 52.51
        - alias: Zeitplan Mittwoch aktiv und Brightness 53
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_3_mittwoch
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 52.5
            below: 53.51
        - alias: Zeitplan Donnerstag aktiv und Brightness 54
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_4_donnerstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 53.5
            below: 54.51
        - alias: Zeitplan Freitag aktiv und Brightness 55
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_5_freitag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 54.5
            below: 55.51
        - alias: Zeitplan Samstag aktiv und Brightness 56
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_6_samstag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 55.5
            below: 56.51
        - alias: Zeitplan Sonntag aktiv und Brightness 57
          condition: and
          conditions:
          - condition: state
            entity_id: schedule.zaptec_charge_7_sonntag
            state: 'on'
          - condition: numeric_state
            entity_id: number.zaptec_charger_pp_29_status_indicator_brightness
            above: 56.5
            below: 57.51
        - condition: state
          entity_id: sensor.zaptec_charger_pp_29_charger_mode
          state: Charge done
        alias: Wenn LED 50 oder LED 51-57 (Zeitplan aktiv) oder Charge done, dann
          gehen wir weiter
      sequence:
      - condition: state
        entity_id: number.zaptec_charger_pp_29_charger_max_current
        state:
        - '0.0'
        - '12.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - alias: Stelle den Wert Max Current auf 32
        device_id: a4d825c6f9417e1c8677d631e7b3204f
        domain: number
        entity_id: e377a03f51033d07267624610c39a626
        type: set_value
        value: 32
      - alias: Warten bis zu 2 Minuten auf Max Current 32 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_29_charger_max_current
          to: '32.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - alias: Stelle den Wert der LED auf 50
        device_id: a4d825c6f9417e1c8677d631e7b3204f
        domain: number
        entity_id: 51f9f323120c714e4cce1e1306388a68
        type: set_value
        value: 50
      - alias: Warten bis zu 2 Minuten auf LED 50 und fahre sonst fort
        wait_for_trigger:
        - trigger: numeric_state
          entity_id:
          - number.zaptec_charger_pp_29_status_indicator_brightness
          above: 49.5
          below: 50.51
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Setze maximale Ladeleistung  (Leistung 32A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: pichler.melanie@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 29 - Setze maximale Ladeleistung (Leistung
            32A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_29_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_29_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_29_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      alias: Bedingungsloses laden in der Nacht oder bei Brightness 50
    default:
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          below: -10000
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          below: -10000
        alias: Wenn die Energiesensoren UMG604 15, 30 und 60 Minuten alle < -10000
          sind
      then:
      - condition: state
        entity_id: number.zaptec_charger_pp_29_charger_max_current
        state:
        - '0.0'
        - '32.0'
      - delay: '{{ (range(0, 6)|random|multiply(60))+(range(0, 3)|random|multiply(60))+(range(0,
          60)|random) }}'
        alias: Warte zufällig 0 bis 600 Sekunden
      - condition: numeric_state
        entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
        below: -10000
      - device_id: a4d825c6f9417e1c8677d631e7b3204f
        domain: number
        entity_id: e377a03f51033d07267624610c39a626
        type: set_value
        value: 12
        alias: Stelle den Wert für Zaptec Charger PP 29 Charger max current auf 12
      - alias: Warten bis zu 2 Minuten auf Max Current 12 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_29_charger_max_current
          to: '12.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Starte Überschuss Ladung (Leistung 12A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: pichler.melanie@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 29 - Starte Überschuss Ladung (Leistung
            12A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_29_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_29_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_29_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das Laden beendet werden kann
      else:
      - condition: state
        entity_id: number.zaptec_charger_pp_29_charger_max_current
        state:
        - '12.0'
        - '32.0'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_15_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
          above: 0
        - condition: numeric_state
          entity_id: sensor.energy_statistic_janitza_umg604_w_60_min
          above: 0
        alias: Wenn einer der Energiesensoren UMG604 15, 30 oder 60 Minuten > 0 ist
      - device_id: a4d825c6f9417e1c8677d631e7b3204f
        domain: number
        entity_id: e377a03f51033d07267624610c39a626
        type: set_value
        value: 0
        alias: Stelle den Wert für Zaptec Charger PP 29 Charger max current auf 0
      - alias: Warten bis zu 2 Minuten auf Max Current 0 und fahre sonst fort
        wait_for_trigger:
        - trigger: state
          entity_id:
          - number.zaptec_charger_pp_29_charger_max_current
          to: '0.0'
        timeout:
          hours: 0
          minutes: 2
          seconds: 0
          milliseconds: 0
      - action: notify.administrator_rotseepark
        metadata: {}
        data:
          title: Rotseepark Zaptec - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)
          message: 'Dies ist eine automatisch generierte Mitteilung von der Rotseepark
            Haus Automatisation. Wenn du diese Mitteilung nicht mehr erhalten möchtest,
            leite diese E-Mail weiter an e-mobility@rotseepark.ch und erkläre darin
            kurz, dass du diese Meldung nicht mehr erhalten möchtest. '
          target: pichler.melanie@gmail.com
      - data:
          title: 'HA-Info Einstellhalle: PP 29 - Aktuell keine Überschuss Ladung möglich  (Leistung
            0A)'
          message: 'UMG604-15 {{ states(''sensor.energy_statistic_janitza_umg604_w_15_min'')
            }}

            Charger Mode {{ states(''sensor.zaptec_charger_pp_29_charger_mode'') }}

            Max Current {{ states(''number.zaptec_charger_pp_29_charger_max_current'')
            }}

            LED Brightness {{ states(''number.zaptec_charger_pp_29_status_indicator_brightness'')
            }}'
        action: notify.administrator_rotseepark
      - delay:
          hours: 1
          minutes: 0
          seconds: 0
          milliseconds: 0
        alias: Warte 1h bis frühestens das nächste Laden erfolgen kann
  mode: parallel
  max: 10
- id: '1752818618522'
  alias: Monitoring TA Minimum und Schalten Kühlen AN (Automatik)
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 9
      minutes: 0
      seconds: 0
    above: 18
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 8
      minutes: 0
      seconds: 0
    above: 19
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 7
      minutes: 0
      seconds: 0
    above: 20
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 6
      minutes: 0
      seconds: 0
    above: 21
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 5
      minutes: 0
      seconds: 0
    above: 22
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_minimum
    for:
      hours: 4
      minutes: 0
      seconds: 0
    above: 23
  conditions:
  - condition: template
    value_template: "{{\n  (true if states('input_select.luxtronik_19_cl_operation_mode')|int
      != states('input_select.luxtronik_operation_mode_automatik_cooling')|int\n        or
      states('input_select.luxtronik_21_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_automatik_cooling')|int\n
      \       or states('input_select.luxtronik_23_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_automatik_cooling')|int\n
      \       or states('input_select.luxtronik_25_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_automatik_cooling')|int\n
      \       or states('input_select.luxtronik_19_cl_operation_mode')|int != state_attr('sensor.luxtronik_19_param_state','parameters')['cooling_operation_mode']|int
      \n        or states('input_select.luxtronik_21_cl_operation_mode')|int != state_attr('sensor.luxtronik_21_param_state','parameters')['cooling_operation_mode']|int\n
      \       or states('input_select.luxtronik_23_cl_operation_mode')|int != state_attr('sensor.luxtronik_23_param_state','parameters')['cooling_operation_mode']|int
      \n        or states('input_select.luxtronik_25_cl_operation_mode')|int != state_attr('sensor.luxtronik_25_param_state','parameters')['cooling_operation_mode']|int
      \n   else false)\n}}\n"
  actions:
  - action: script.kuhlen_an
    metadata: {}
    data: {}
  mode: single
- id: '1752818858750'
  alias: Monitoring TA Maximum und Schalten Kühlen AUS (Aus)
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 12
      minutes: 0
      seconds: 0
    below: 18
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 11
      minutes: 0
      seconds: 0
    below: 17
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 10
      minutes: 0
      seconds: 0
    below: 16
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 9
      minutes: 0
      seconds: 0
    below: 15
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 8
      minutes: 0
      seconds: 0
    below: 14
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik_ta_maximum
    for:
      hours: 7
      minutes: 0
      seconds: 0
    below: 13
  conditions:
  - condition: template
    value_template: "{{\n  (true if states('input_select.luxtronik_19_cl_operation_mode')|int
      != states('input_select.luxtronik_operation_mode_aus_cooling')|int\n        or
      states('input_select.luxtronik_21_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_aus_cooling')|int\n
      \       or states('input_select.luxtronik_23_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_aus_cooling')|int\n
      \       or states('input_select.luxtronik_25_cl_operation_mode')|int != states('input_select.luxtronik_operation_mode_aus_cooling')|int\n
      \       or states('input_select.luxtronik_19_cl_operation_mode')|int != state_attr('sensor.luxtronik_19_param_state','parameters')['cooling_operation_mode']|int
      \n        or states('input_select.luxtronik_21_cl_operation_mode')|int != state_attr('sensor.luxtronik_21_param_state','parameters')['cooling_operation_mode']|int\n
      \       or states('input_select.luxtronik_23_cl_operation_mode')|int != state_attr('sensor.luxtronik_23_param_state','parameters')['cooling_operation_mode']|int
      \n        or states('input_select.luxtronik_25_cl_operation_mode')|int != state_attr('sensor.luxtronik_25_param_state','parameters')['cooling_operation_mode']|int
      \n   else false)\n}}\n"
  actions:
  - action: script.kuhlen_aus
    metadata: {}
    data: {}
  mode: single
- id: '1758050016697'
  alias: Melde Tür - Öffnung oder Lichtänderung im Heizungsraum
  description: ''
  triggers:
  - type: opened
    device_id: ee5db3dc21cb64f5f52c1a2408b51429
    entity_id: f282fa75aa11eeeb32bae2a9e72b25af
    domain: binary_sensor
    trigger: device
    id: hz19_door_opened
  - type: opened
    device_id: 5894bb5f418a311b5cbd2cacd0b9b963
    entity_id: fec6a6f39d1a1b52a0e9cd4d39f07f87
    domain: binary_sensor
    trigger: device
    id: hz21_door_opened
  - type: opened
    device_id: 4b5d22ecaa1123a88e6295f349aa48ef
    entity_id: e44ffe86183663b66c900e64d7cf8438
    domain: binary_sensor
    trigger: device
    id: hz23_door_opened
  - type: opened
    device_id: 03fb1f12ba56f4c8af79e1b104ab6cec
    entity_id: 8a3b05c56f621d9f079940b229ef5d98
    domain: binary_sensor
    trigger: device
    id: hz25_door_opened
  - type: illuminance
    device_id: ee5db3dc21cb64f5f52c1a2408b51429
    entity_id: a0c98edf115e6367b205555ac88379a6
    domain: sensor
    trigger: device
    above: 0
    for:
      hours: 2
      minutes: 0
      seconds: 0
    id: hz19_room_light_2h
  - type: illuminance
    device_id: 5894bb5f418a311b5cbd2cacd0b9b963
    entity_id: 3b80ad08a6d36ec9b83d59c343696ee1
    domain: sensor
    trigger: device
    above: 0
    for:
      hours: 2
      minutes: 0
      seconds: 0
    id: hz21_room_light_2h
  - type: illuminance
    device_id: 4b5d22ecaa1123a88e6295f349aa48ef
    entity_id: 76e7a656d9e3c697d8049c912336fb60
    domain: sensor
    trigger: device
    above: 0
    for:
      hours: 2
      minutes: 0
      seconds: 0
    id: hz23_room_light_2h
  - type: illuminance
    device_id: 03fb1f12ba56f4c8af79e1b104ab6cec
    entity_id: c1b8d5a30211721eed997136e3a5cf5e
    domain: sensor
    trigger: device
    above: 0
    for:
      hours: 2
      minutes: 0
      seconds: 0
    id: hz25_room_light_2h
  - type: battery_level
    device_id: ee5db3dc21cb64f5f52c1a2408b51429
    entity_id: 035720f5f083a236112b1049907e842b
    domain: sensor
    trigger: device
    below: 10
    id: hz19_battery_below_10
  - type: battery_level
    device_id: 5894bb5f418a311b5cbd2cacd0b9b963
    entity_id: 0de55f125bf02317bbde4a04cd724a1f
    domain: sensor
    trigger: device
    below: 10
    id: hz21_battery_below_10
  - type: battery_level
    device_id: 4b5d22ecaa1123a88e6295f349aa48ef
    entity_id: 0c16b91f333a88287aa130c9f081458d
    domain: sensor
    trigger: device
    below: 10
    id: hz23_battery_below_10
  - type: battery_level
    device_id: 03fb1f12ba56f4c8af79e1b104ab6cec
    entity_id: 6ae1f07f8ba5afbf28668b5a778cead1
    domain: sensor
    trigger: device
    below: 10
    id: hz25_battery_below_10
  conditions: []
  actions:
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Rotseepark - HZ Haus 19-25 - Geräte Trigger - {% if trigger
        is defined and trigger.id is defined %}{{ trigger.id }}{% else %}undefiniert{%
        endif %}

        '
      message: "{% if trigger is defined and trigger.platform is defined %}\n  Trigger
        Plattform: {{ trigger.platform }}\n{% else %}\n  Trigger Plattform: undefiniert\n{%
        endif %}\n{% if trigger is defined and trigger.entity_id is defined %}\n  Trigger
        Entity: {{ trigger.entity_id }}\n{% else %}\n  Trigger Entity: undefiniert\n{%
        endif %}\n{% if trigger is defined and trigger.id is defined %}\n  Trigger
        ID: {{ trigger.id }}\n{% else %}\n  Trigger ID: undefiniert\n{% endif %}\n{%
        if trigger is defined and trigger.type is defined %}\n  Trigger Type: {{ trigger.type
        }}\n{% else %}\n  Trigger Type: undefiniert\n{% endif %}\n{% if trigger is
        defined and trigger.from_state is defined %}\n  Trigger From: {{ trigger.from_state
        }}\n{% else %}\n  Trigger From: undefiniert\n{% endif %}\n{% if trigger is
        defined and trigger.to_state is defined %}\n  Trigger To: {{ trigger.to_state
        }}\n{% else %}\n  Trigger To: undefiniert\n{% endif %}\n{% if trigger is defined
        and trigger.for is defined %}\n  Trigger For: {{ trigger.for }}\n{% else %}\n
        \ Trigger For: undefiniert\n{% endif %}\n{% if trigger is defined and trigger.above
        is defined %}\n  Trigger Above: {{ trigger.above }}\n{% else %}\n  Trigger
        Above: undefiniert\n{% endif %}\n{% if trigger is defined and trigger.below
        is defined %}\n  Trigger Below: {{ trigger.below }}\n{% else %}\n  Trigger
        Below: undefiniert\n{% endif %}\n"
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Heizung: Trigger {{ trigger.id
        }} ausgelöst <div style="display: none">technical</div>'
    enabled: true
  mode: single
- id: '1758866538480'
  alias: ' Schalte WW - Produziere Warmwasser (Nachtmodus) - Oktober bis März'
  description: ''
  triggers:
  - trigger: time
    at: '22:20:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sun
  conditions:
  - alias: Gültig vom Oktober bis März
    condition: template
    value_template: "{{ true if ( \n  ((now().month <= 3 or now().month >= 10)) \n)
      else false }}"
  actions:
  - variables:
      ww_19_todo: true
      ww_21_todo: true
      ww_23_todo: true
      ww_25_todo: true
  - alias: Verarbeite Haus 19, 21, 23 und 25 in Reihenfolge des Bedarfes
    repeat:
      count: 4
      sequence:
      - choose:
        - conditions:
          - alias: Vergleiche Haus 19 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 19 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik19_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_19_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 19
          - alias: Benachrichtigung über Warmwasser Produktion
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Nacht)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Nacht)
          - variables:
              ww_19_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik19_tbw_soll')|int
                \n     - states('sensor.luxtronik19_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_19_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_19_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_19_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 19, um die WW Produktion anzustossen
          - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
            delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_19_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 19 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik19_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_19_ww_solltemperatur
              action: input_number.set_value
          - alias: Warten bis Brauchwasser Produktion endet
            wait_for_trigger:
            - entity_id:
              - binary_sensor.luxtronik19_bup
              from: 'on'
              to: 'off'
              trigger: state
              for:
                hours: 0
                minutes: 5
                seconds: 0
            timeout:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
        - conditions:
          - alias: Vergleiche Haus 21 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 21 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik21_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_21_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 21
          - alias: Benachrichtigung über Warmwasser Produktion
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Nacht)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Nacht)
          - variables:
              ww_21_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik21_tbw_soll')|int
                \n     - states('sensor.luxtronik21_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_21_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_21_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_21_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 21, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_21_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 21 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik21_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_21_ww_solltemperatur
              action: input_number.set_value
          - alias: Warten bis Brauchwasser Produktion endet
            wait_for_trigger:
            - entity_id:
              - binary_sensor.luxtronik21_bup
              from: 'on'
              to: 'off'
              trigger: state
              for:
                hours: 0
                minutes: 5
                seconds: 0
            timeout:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
        - conditions:
          - alias: Vergleiche Haus 23 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 23 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik23_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_23_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 23
          - alias: Benachrichtigung über Warmwasser Produktion
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Nacht)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Nacht)
          - variables:
              ww_23_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik23_tbw_soll')|int
                \n     - states('sensor.luxtronik23_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_23_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_23_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_23_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 23, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_23_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 23 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik23_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_23_ww_solltemperatur
              action: input_number.set_value
          - alias: Warten bis Brauchwasser Produktion endet
            wait_for_trigger:
            - entity_id:
              - binary_sensor.luxtronik23_bup
              from: 'on'
              to: 'off'
              trigger: state
              for:
                hours: 0
                minutes: 5
                seconds: 0
            timeout:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
        - conditions:
          - alias: Vergleiche Haus 25 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 25 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik25_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_25_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
          sequence:
          - variables:
              haus: 25
          - alias: Benachrichtigung über Warmwasser Produktion
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Nacht)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Nacht)
          - variables:
              ww_25_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik25_tbw_soll')|int
                \n     - states('sensor.luxtronik25_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_25_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_25_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_25_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 25, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_25_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 25 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik25_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_25_ww_solltemperatur
              action: input_number.set_value
          - alias: Warten bis Brauchwasser Produktion endet
            wait_for_trigger:
            - entity_id:
              - binary_sensor.luxtronik25_bup
              from: 'on'
              to: 'off'
              trigger: state
              for:
                hours: 0
                minutes: 5
                seconds: 0
            timeout:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
  mode: single
- id: '1758876867041'
  alias: ' Schalte WW - Produziere Warmwasser (Tagmodus) - Oktober bis März'
  description: ''
  triggers:
  - trigger: time
    at: '10:20:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - trigger: time
    at: '10:20:00'
    weekday:
    - sat
  conditions:
  - alias: Gültig vom Oktober bis März
    condition: template
    value_template: "{{ true if ( \n  ((now().month <= 3 or now().month >= 10)) \n)
      else false }}"
  actions:
  - variables:
      ww_19_todo: true
      ww_21_todo: true
      ww_23_todo: true
      ww_25_todo: true
  - alias: Verarbeite Haus 19, 21, 23 und 25 in Reihenfolge des Bedarfes
    repeat:
      count: 4
      sequence:
      - choose:
        - conditions:
          - alias: Vergleiche Haus 19 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 19 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik19_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_19_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik19_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 19 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 19
          - alias: Benachrichtigung über Start der Produktion Version
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Tag)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Tag)
          - variables:
              ww_19_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik19_tbw_soll')|int
                \n     - states('sensor.luxtronik19_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_19_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_19_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_19_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 19, um die WW Produktion anzustossen
          - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
            delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_19_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 19 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik19_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_19_ww_solltemperatur
              action: input_number.set_value
          - if:
            - condition: time
              weekday:
              - sat
            then:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik19_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 30
                seconds: 0
                milliseconds: 0
            else:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik19_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 45
                seconds: 0
                milliseconds: 0
            alias: Timeout für Samstag 30 Minuten und sonst 45 Minuten
        - conditions:
          - alias: Vergleiche Haus 21 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 21 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik21_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_21_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik21_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 21 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 21
          - alias: Benachrichtigung über Start der Produktion Version
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Tag)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Tag)
          - variables:
              ww_21_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik21_tbw_soll')|int
                \n     - states('sensor.luxtronik21_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_21_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_21_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_21_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 21, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_21_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 21 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik21_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_21_ww_solltemperatur
              action: input_number.set_value
          - if:
            - condition: time
              weekday:
              - sat
            then:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik21_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 30
                seconds: 0
                milliseconds: 0
            else:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik21_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 45
                seconds: 0
                milliseconds: 0
            alias: Timeout für Samstag 30 Minuten und sonst 45 Minuten
        - conditions:
          - alias: Vergleiche Haus 23 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 23 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik23_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_23_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik23_tbw'') <= states(''sensor.luxtronik25_tbw'')
                or states(''binary_sensor.luxtronik25_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 23 Boiler kälter als Haus 25 oder der Boiler
                25 nicht schon läuft
          sequence:
          - variables:
              haus: 23
          - alias: Benachrichtigung über Start der Produktion Version
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Tag)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Tag)
          - variables:
              ww_23_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik23_tbw_soll')|int
                \n     - states('sensor.luxtronik23_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_23_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_23_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_23_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 23, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_23_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 23 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik23_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_23_ww_solltemperatur
              action: input_number.set_value
          - if:
            - condition: time
              weekday:
              - sat
            then:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik23_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 30
                seconds: 0
                milliseconds: 0
            else:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik23_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 45
                seconds: 0
                milliseconds: 0
            alias: Timeout für Samstag 30 Minuten und sonst 45 Minuten
        - conditions:
          - alias: Vergleiche Haus 25 gegen die anderen Häuser
            condition: and
            conditions:
            - alias: Prüfen, ob BPU von Haus 25 nicht läuft
              condition: state
              entity_id: binary_sensor.luxtronik25_bup_out
              state: 'off'
              enabled: true
              for:
                hours: 0
                minutes: 0
                seconds: 0
            - condition: template
              value_template: '{{ ww_25_todo }}'
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik19_tbw'')
                or states(''binary_sensor.luxtronik19_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 19 oder der Boiler
                19 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik21_tbw'')
                or states(''binary_sensor.luxtronik21_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 21 oder der Boiler
                21 nicht schon läuft
            - condition: template
              value_template: '{{states(''sensor.luxtronik25_tbw'') <= states(''sensor.luxtronik23_tbw'')
                or states(''binary_sensor.luxtronik23_bup_out'') == ''on'' }}'
              alias: Prüfen, ob Haus 25 Boiler kälter als Haus 23 oder der Boiler
                23 nicht schon läuft
          sequence:
          - variables:
              haus: 25
          - alias: Benachrichtigung über Start der Produktion Version
            continue_on_error: true
            action: script.send_a_notification_to_administrator_rotseepark
            data:
              title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet
                (Winter Tag)'
              message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (Winter
                Tag)
          - variables:
              ww_25_todo: false
          - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
            if:
            - condition: template
              value_template: "{{ (\n    (\n       states('sensor.luxtronik25_tbw_soll')|int
                \n     - states('sensor.luxtronik25_tbw')|int \n     - 1 \n    )|int\n
                \ ) <= 0 }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int
                  + 2 }}'
              target:
                entity_id: input_number.luxtronik_25_ww_solltemperatur
              action: input_number.set_value
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
            if:
            - condition: state
              entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
              state: 'on'
            then:
            - data:
                option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int
                  }}'
              target:
                entity_id: input_select.luxtronik_25_ww_operation_mode
              action: input_select.select_option
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
          - data:
              value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
                - 1 )|int }}'
            target:
              entity_id: input_number.luxtronik_25_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 25, um die WW Produktion anzustossen
          - delay:
              hours: 0
              minutes: 30
              seconds: 0
              milliseconds: 0
            alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu
              starten
          - data:
              value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int
                }}'
            target:
              entity_id: input_number.luxtronik_25_ww_hysterese
            action: input_number.set_value
            alias: Setzte die Hysterese Haus 25 wieder zurück
          - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
            if:
            - condition: template
              value_template: "{{ states('sensor.luxtronik25_tbw_soll')|int \n   !=
                \n   states('input_number.luxtronik_ww_normaltemperatur')|int }}"
            then:
            - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
              data:
                value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
              target:
                entity_id: input_number.luxtronik_25_ww_solltemperatur
              action: input_number.set_value
          - if:
            - condition: time
              weekday:
              - sat
            then:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik25_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 30
                seconds: 0
                milliseconds: 0
            else:
            - alias: Warten bis Brauchwasser Produktion endet
              wait_for_trigger:
              - entity_id:
                - binary_sensor.luxtronik25_bup
                from: 'on'
                to: 'off'
                trigger: state
                for:
                  hours: 0
                  minutes: 5
                  seconds: 0
              timeout:
                hours: 0
                minutes: 45
                seconds: 0
                milliseconds: 0
            alias: Timeout für Samstag 30 Minuten und sonst 45 Minuten
  mode: single
- id: '1759490971198'
  alias: Melde Ruhestörung im Militärmuseum
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '6'
  - trigger: time_pattern
    minutes: '36'
  conditions:
  - condition: state
    entity_id: schedule.ruhezeiten_militarmuseum
    state: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - condition: numeric_state
    entity_id: sensor.gplugde_haus_21_schutzraume_meter_wirkleistung_cons_w
    above: 1500
  actions:
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: HA-Info Rotseepark - HZ Haus 19-25 - Militärmuseum Ruhestörung {{ states('sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w')
        }} Watt
      message: '{{ states(''sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w'')
        }} Watt Stromverbrauch

        '
  - alias: Benachrichtigung senden an pichler.melanie@gmail.com und irenehodel@hotmail.com
    action: notify.administrator_rotseepark
    metadata: {}
    data:
      title: HA-Info Rotseepark - mögliche Ruhestörung Militärmuseum {{ states('sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w')
        }} Watt
      message: "{{ states('sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w')
        }} Watt Stromverbrauch\n\nLiebe Melanie, Liebe Irene\n\nDieses Mail wurde
        automatisch von unserer Haus Automatisierung erstellt. Ich messe den Stromverbrauch
        im Militärmuseum und wenn er > 600 Watt ist, dann liegt vermutlich eine Ruhestörung
        vor, weil Musik gespielt wird. \n\nIch würde das gerne mal so laufen lassen
        und bin euch dankbar, wenn ihr mir kurz bestätigen könnt, ob wirklich Musik
        hörbar war. So können wir Daten sammeln und dann ganz konkret die Vorfälle
        melden, damit die Ruhezeiten auch wirklich immer eingehalten werden. \n\nen
        Gruess\nStephan "
      target: pichler.melanie@gmail.com,irenehodel@hotmail.com
    enabled: false
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Militärmuseum: Unregelmässigkeit
        Stromverbrauch Schutzräume (Verbrauch zu hoch)'
  mode: single
- id: '1760247603139'
  alias: Monitoring Heatpump 19-25 - Brauchwasser Erzeugung, setze Energie Verbrauch
    TVL 50, 55 & 60 °C
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik19_tvl
    id: haus19-50
    above: 50
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik19_tvl
    id: haus19-55
    above: 55
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik19_tvl
    id: haus19-60
    above: 60
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik21_tvl
    id: haus21-50
    above: 50
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik21_tvl
    id: haus21-55
    above: 55
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik21_tvl
    id: haus21-60
    above: 60
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik23_tvl
    id: haus23-50
    above: 50
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik23_tvl
    id: haus23-55
    above: 55
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik23_tvl
    id: haus23-60
    above: 60
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik25_tvl
    id: haus25-50
    above: 50
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik25_tvl
    id: haus25-55
    above: 55
  - trigger: numeric_state
    entity_id:
    - sensor.luxtronik25_tvl
    id: haus25-60
    above: 60
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: haus19-50
      sequence:
      - target:
          entity_id: input_number.bwm19_variable_tvl_50_watt
        data:
          value: '{{ states(''sensor.solar_consumption_19_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus19-55
      sequence:
      - target:
          entity_id: input_number.bwm19_variable_tvl_55_watt
        data:
          value: '{{ states(''sensor.solar_consumption_19_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus19-60
      sequence:
      - target:
          entity_id: input_number.bwm19_variable_tvl_60_watt
        data:
          value: '{{ states(''sensor.solar_consumption_19_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus21-50
      sequence:
      - target:
          entity_id: input_number.bwm21_variable_tvl_50_watt
        data:
          value: '{{ states(''sensor.solar_consumption_21_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus21-55
      sequence:
      - target:
          entity_id: input_number.bwm21_variable_tvl_55_watt
        data:
          value: '{{ states(''sensor.solar_consumption_21_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus21-60
      sequence:
      - target:
          entity_id: input_number.bwm21_variable_tvl_60_watt
        data:
          value: '{{ states(''sensor.solar_consumption_21_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus23-50
      sequence:
      - target:
          entity_id: input_number.bwm23_variable_tvl_50_watt
        data:
          value: '{{ states(''sensor.solar_consumption_23_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus23-55
      sequence:
      - target:
          entity_id: input_number.bwm23_variable_tvl_55_watt
        data:
          value: '{{ states(''sensor.solar_consumption_23_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus23-60
      sequence:
      - target:
          entity_id: input_number.bwm23_variable_tvl_60_watt
        data:
          value: '{{ states(''sensor.solar_consumption_23_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus25-50
      sequence:
      - target:
          entity_id: input_number.bwm25_variable_tvl_50_watt
        data:
          value: '{{ states(''sensor.solar_consumption_25_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus25-55
      sequence:
      - target:
          entity_id: input_number.bwm25_variable_tvl_55_watt
        data:
          value: '{{ states(''sensor.solar_consumption_25_ww_wp'')|float }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id: haus25-60
      sequence:
      - target:
          entity_id: input_number.bwm25_variable_tvl_60_watt
        data:
          value: '{{ states(''sensor.solar_consumption_25_ww_wp'')|float }}'
        action: input_number.set_value
  mode: parallel
  max: 10
- id: '1761750159761'
  alias: Schalte WW - Produziere Warmwasser 19 - JETZT
  description: ''
  triggers: []
  conditions: []
  actions:
  - variables:
      haus: 19
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (manuelle
        Anforderung)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (manuelle Anforderung)
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik19_tbw_soll')|int
        \n     - states('sensor.luxtronik19_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_19_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
    if:
    - condition: state
      entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_19_ww_operation_mode
      action: input_select.select_option
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik19_tbw_soll'')|int - states(''sensor.luxtronik19_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_19_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 19, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_19_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 19 wieder zurück
  - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
    if:
    - condition: template
      value_template: "{{ states('sensor.luxtronik19_tbw_soll')|int \n   != \n   states('input_number.luxtronik_ww_normaltemperatur')|int
        }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
      target:
        entity_id: input_number.luxtronik_19_ww_solltemperatur
      action: input_number.set_value
  mode: single
- id: '1761750286067'
  alias: Schalte WW - Produziere Warmwasser 21 - JETZT
  description: ''
  triggers: []
  conditions: []
  actions:
  - variables:
      haus: 21
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (manuelle
        Anforderung)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (manuelle Anforderung)
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik21_tbw_soll')|int
        \n     - states('sensor.luxtronik21_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_21_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
    if:
    - condition: state
      entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_21_ww_operation_mode
      action: input_select.select_option
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik21_tbw_soll'')|int - states(''sensor.luxtronik21_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_21_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 21, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_21_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 21 wieder zurück
  - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
    if:
    - condition: template
      value_template: "{{ states('sensor.luxtronik21_tbw_soll')|int \n   != \n   states('input_number.luxtronik_ww_normaltemperatur')|int
        }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
      target:
        entity_id: input_number.luxtronik_21_ww_solltemperatur
      action: input_number.set_value
  mode: single
- id: '1761750321751'
  alias: Schalte WW - Produziere Warmwasser 23 - JETZT
  description: ''
  triggers: []
  conditions: []
  actions:
  - variables:
      haus: 23
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (manuelle
        Anforderung)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (manuelle Anforderung)
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik23_tbw_soll')|int
        \n     - states('sensor.luxtronik23_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_23_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
    if:
    - condition: state
      entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_23_ww_operation_mode
      action: input_select.select_option
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik23_tbw_soll'')|int - states(''sensor.luxtronik23_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_23_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 23, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_23_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 23 wieder zurück
  - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
    if:
    - condition: template
      value_template: "{{ states('sensor.luxtronik23_tbw_soll')|int \n   != \n   states('input_number.luxtronik_ww_normaltemperatur')|int
        }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
      target:
        entity_id: input_number.luxtronik_23_ww_solltemperatur
      action: input_number.set_value
  mode: single
- id: '1761750355789'
  alias: Schalte WW - Produziere Warmwasser 25 - JETZT
  description: ''
  triggers: []
  conditions: []
  actions:
  - variables:
      haus: 25
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: 'HA-Info Heatpump {{ haus }}: Die Boiler Ladung wird gestartet (manuelle
        Anforderung)'
      message: Die Boiler Ladung in Haus {{ haus }} wird gestartet (manuelle Anforderung)
  - alias: Prüfe, ob die Hysterese 0 ergibt und falls ja, erhöhe die Solltemperatur
    if:
    - condition: template
      value_template: "{{ (\n    (\n       states('sensor.luxtronik25_tbw_soll')|int
        \n     - states('sensor.luxtronik25_tbw')|int \n     - 1 \n    )|int\n  )
        <= 0 }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur plus 2 Grad
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int + 2 }}'
      target:
        entity_id: input_number.luxtronik_25_ww_solltemperatur
      action: input_number.set_value
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - alias: Prüfe, ob aktuell Sperrzeit ist und falls ja, Schalte auf Party
    if:
    - condition: state
      entity_id: schedule.luxtronik_zeitplan_sperrzeit_warmwasser
      state: 'on'
    then:
    - data:
        option: '{{ states(''input_select.luxtronik_operation_mode_party'')|int }}'
      target:
        entity_id: input_select.luxtronik_25_ww_operation_mode
      action: input_select.select_option
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
  - data:
      value: '{{ (states(''sensor.luxtronik25_tbw_soll'')|int - states(''sensor.luxtronik25_tbw'')|int
        - 1 )|int }}'
    target:
      entity_id: input_number.luxtronik_25_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 25, um die WW Produktion anzustossen
  - alias: Verzögere, um der WP Zeit zu geben die Warmwasser Produktion zu starten
    delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - data:
      value: '{{ states(''input_number.luxtronik_ww_normalhysterese'')|int }}'
    target:
      entity_id: input_number.luxtronik_25_ww_hysterese
    action: input_number.set_value
    alias: Setzte die Hysterese Haus 25 wieder zurück
  - alias: Prüfe, ob die TBW Soll abweicht, d.h. umgestellt wurde
    if:
    - condition: template
      value_template: "{{ states('sensor.luxtronik25_tbw_soll')|int \n   != \n   states('input_number.luxtronik_ww_normaltemperatur')|int
        }}"
    then:
    - alias: Setzte Luxtronik Solltemperatur zu Normal Temperatur
      data:
        value: '{{states(''input_number.luxtronik_ww_normaltemperatur'')|int}}'
      target:
        entity_id: input_number.luxtronik_25_ww_solltemperatur
      action: input_number.set_value
  mode: single
- id: '1761912237840'
  alias: Melde Licht brennt im Militärmuseum
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.energy_statistic_gplug_haus_21_schutzraume_w
    for:
      hours: 6
      minutes: 0
      seconds: 0
    above: 250
  conditions: []
  actions:
  - action: script.send_a_notification_to_administrator_rotseepark
    data:
      title: HA-Info Rotseepark - HZ Haus 19-25 - Militärmuseum Licht brennt seit
        6h {{ states('sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w')
        }} Watt
      message: '{{ states(''sensor.gplugde_haus_21_allgemein_meter_wirkleistung_cons_w'')
        }} Watt Stromverbrauch

        '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Militärmuseum: Unregelmässigkeit
        Stromverbrauch Licht (Verbrauch zu hoch) <div style="display: none">technical</div>'
  mode: single
- id: '1762533730983'
  alias: Status Wärmepumpe der Häuser schreiben (Dashboard Kachel Heizung XX)
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '4'
    seconds: '50'
  - trigger: time_pattern
    minutes: '9'
    seconds: '50'
  - trigger: time_pattern
    minutes: '14'
    seconds: '50'
  - trigger: time_pattern
    minutes: '19'
    seconds: '50'
  - trigger: time_pattern
    minutes: '24'
    seconds: '50'
  - trigger: time_pattern
    minutes: '29'
    seconds: '50'
  - trigger: time_pattern
    minutes: '34'
    seconds: '50'
  - trigger: time_pattern
    minutes: '39'
    seconds: '50'
  - trigger: time_pattern
    minutes: '44'
    seconds: '50'
  - trigger: time_pattern
    minutes: '49'
    seconds: '50'
  - trigger: time_pattern
    minutes: '54'
    seconds: '50'
  - trigger: time_pattern
    minutes: '59'
    seconds: '50'
  conditions: []
  actions:
  - alias: Status Heizung Haus 19 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik19_hup
      state: 'on'
    then:
    - if:
      - condition: numeric_state
        entity_id: sensor.luxtronik19_spz_trl_soll_ext
        below: 0
      then:
      - alias: Status Heizung Haus 19 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus19-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#ADD8E6;">{{ states(''sensor.luxtronik19_spz_trl_soll_ext'')}}
            °C</span></p>'
      else:
      - alias: Status Heizung Haus 19 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus19-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#FF6666;">+{{ states(''sensor.luxtronik19_spz_trl_soll_ext'')}}
            °C</span></p>'
    - alias: Status Heizung Haus 19 (Wärmequelle Wärmepumpe/Wärmespeicher)
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik19_hup_out
        state: 'on'
      then:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik19_vd1
            state: 'on'
          - condition: state
            entity_id: binary_sensor.luxtronik19_vd2
            state: 'on'
        then:
        - alias: Status Heizung Haus 19 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus19-1.txt
            value: '<p>Quelle: <b>Erdsonde</b>  <span style="color:#FF6666;">B2</span></p>'
        else:
        - alias: Status Heizung Haus 19 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus19-1.txt
            value: '<p>Quelle: <b>Erdsonde</b></p>'
      else:
      - alias: Status Heizung Haus 19 (Wärmespeicher)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus19-1.txt
          value: '<p>Quelle: <b>Speicher</b></p>'
    - alias: Status Heizung Haus 19 (Vorlauf)
      action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus19-1.txt
        value: '<p>Vorlauf: <b>{{states(''sensor.luxtronik_19_m2f_degc'')}} °C</b></p>'
    else:
    - alias: Status Heizung Haus 19 (aus)
      action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus19-1.txt
        value: '<p>Heizung: <b>aus</b></p>'
  - alias: Status Heizung Haus 19 (Sonde)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus19-1.txt
      value: '<p>Sonde: <b>{{states(''sensor.sql_erdsonde_haus_19_temperature'')}}
        °C</b></p>'
  - alias: Status Brauchwasser Haus 19 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik19_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus19-1.txt
        value: '<p>Warmwasser: <b>läuft</b></p>'
      alias: Status Warmwasser Haus 19 (läuft)
    else:
    - if:
      - condition: state
        entity_id: sensor.luxtronik19_hs3
        state: '9'
        alias: Status Warmwasser Haus 19 (Desinfektion)
      then:
      - alias: Status Warmwasser Haus 19 (Desinfektion)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus19-1.txt
          value: '<p>Warmwasser: <b>TDI</b></p>'
      else:
      - alias: Status Warmwasser Haus 19 (OK)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus19-1.txt
          value: '<p>Warmwasser: <b>OK</b></p>'
  - alias: Status Heizung Haus 21 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik21_hup
      state: 'on'
    then:
    - if:
      - condition: numeric_state
        entity_id: sensor.luxtronik21_spz_trl_soll_ext
        below: 0
      then:
      - alias: Status Heizung Haus 21 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus21-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#ADD8E6;">{{ states(''sensor.luxtronik21_spz_trl_soll_ext'')}}
            °C</span></p>'
      else:
      - alias: Status Heizung Haus 21 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus21-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#FF6666;">+{{ states(''sensor.luxtronik21_spz_trl_soll_ext'')}}
            °C</span></p>'
    - alias: Status Heizung Haus 21 (Wärmequelle Wärmepumpe/Wärmespeicher)
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik21_hup_out
        state: 'on'
      then:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik21_vd1
            state: 'on'
          - condition: state
            entity_id: binary_sensor.luxtronik21_vd2
            state: 'on'
        then:
        - alias: Status Heizung Haus 21 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus21-1.txt
            value: '<p>Quelle: <b>Erdsonde</b>  <span style="color:#FF6666;">B2</span></p>'
        else:
        - alias: Status Heizung Haus 21 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus21-1.txt
            value: '<p>Quelle: <b>Erdsonde</b></p>'
      else:
      - alias: Status Heizung Haus 21 (Wärmespeicher)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus21-1.txt
          value: '<p>Quelle: <b>Speicher</b></p>'
    - alias: Status Heizung Haus 21 (Vorlauf)
      action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus21-1.txt
        value: '<p>Vorlauf: <b>{{states(''sensor.luxtronik_21_m2f_degc'')}} °C</b></p>'
    else:
    - alias: Status Heizung Haus 21 (aus)
      action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/haus21-1.txt
        value: '<p>Heizung: <b>aus</b></p>'
  - alias: Status Heizung Haus 21 (Sonde)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus21-1.txt
      value: '<p>Sonde: <b>{{states(''sensor.sql_erdsonde_haus_21_temperature'')}}
        °C</b></p>'
  - alias: Status Brauchwasser Haus 21 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik21_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus21-1.txt
        value: '<p>Warmwasser: <b>läuft</b></p>'
      alias: Status Warmwasser Haus 21 (läuft)
    else:
    - if:
      - condition: state
        entity_id: sensor.luxtronik21_hs3
        state: '9'
        alias: Status Warmwasser Haus 21 (Desinfektion)
      then:
      - alias: Status Warmwasser Haus 21 (Desinfektion)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus21-1.txt
          value: '<p>Warmwasser: <b>TDI</b></p>'
      else:
      - alias: Status Warmwasser Haus 21 (OK)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus21-1.txt
          value: '<p>Warmwasser: <b>OK</b></p>'
  - alias: Status Heizung Haus 23 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik23_hup
      state: 'on'
    then:
    - if:
      - condition: numeric_state
        entity_id: sensor.luxtronik23_spz_trl_soll_ext
        below: 0
      then:
      - alias: Status Heizung Haus 23 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus23-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#ADD8E6;">{{ states(''sensor.luxtronik23_spz_trl_soll_ext'')}}
            °C</span></p>'
      else:
      - alias: Status Heizung Haus 23 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus23-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#FF6666;">+{{ states(''sensor.luxtronik23_spz_trl_soll_ext'')}}
            °C</span></p>'
    - alias: Status Heizung Haus 23 (Wärmequelle Wärmepumpe/Wärmespeicher)
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik23_hup_out
        state: 'on'
      then:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik23_vd1
            state: 'on'
          - condition: state
            entity_id: binary_sensor.luxtronik23_vd2
            state: 'on'
        then:
        - alias: Status Heizung Haus 23 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus23-1.txt
            value: '<p>Quelle: <b>Erdsonde</b>  <span style="color:#FF6666;">B2</span></p>'
        else:
        - alias: Status Heizung Haus 23 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus23-1.txt
            value: '<p>Quelle: <b>Erdsonde</b></p>'
      else:
      - alias: Status Heizung Haus 23 (Wärmespeicher)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus23-1.txt
          value: '<p>Quelle: <b>Speicher</b></p>'
    - alias: Status Heizung Haus 23 (Vorlauf)
      action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus23-1.txt
        value: '<p>Vorlauf: <b>{{states(''sensor.luxtronik_23_m2f_degc'')}} °C</b></p>'
    else:
    - alias: Status Heizung Haus 23 (aus)
      action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/haus23-1.txt
        value: '<p>Heizung: <b>aus</b></p>'
  - alias: Status Heizung Haus 23 (Sonde)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus23-1.txt
      value: '<p>Sonde: <b>{{states(''sensor.sql_erdsonde_haus_23_temperature'')}}
        °C</b></p>'
  - alias: Status Brauchwasser Haus 23 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik23_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus23-1.txt
        value: '<p>Warmwasser: <b>läuft</b></p>'
      alias: Status Warmwasser Haus 23 (läuft)
    else:
    - if:
      - condition: state
        entity_id: sensor.luxtronik23_hs3
        state: '9'
        alias: Status Warmwasser Haus 23 (Desinfektion)
      then:
      - alias: Status Warmwasser Haus 23 (Desinfektion)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus23-1.txt
          value: '<p>Warmwasser: <b>TDI</b></p>'
      else:
      - alias: Status Warmwasser Haus 23 (OK)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus23-1.txt
          value: '<p>Warmwasser: <b>OK</b></p>'
  - alias: Status Heizung Haus 25 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik25_hup
      state: 'on'
    then:
    - if:
      - condition: numeric_state
        entity_id: sensor.luxtronik25_spz_trl_soll_ext
        below: 0
      then:
      - alias: Status Heizung Haus 25 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus25-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#ADD8E6;">{{ states(''sensor.luxtronik25_spz_trl_soll_ext'')}}
            °C</span></p>'
      else:
      - alias: Status Heizung Haus 25 (ein)
        action: shell_command.write_line_to_file
        data:
          mode: new
          file: /share/rotseepark.ch/haus25-1.txt
          value: '<p>Heizung: <b>ein</b>  <span style="color:#FF6666;">+{{ states(''sensor.luxtronik25_spz_trl_soll_ext'')}}
            °C</span></p>'
    - alias: Status Heizung Haus 25 (Wärmequelle Wärmepumpe/Wärmespeicher)
      if:
      - condition: state
        entity_id: binary_sensor.luxtronik25_hup_out
        state: 'on'
      then:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.luxtronik25_vd1
            state: 'on'
          - condition: state
            entity_id: binary_sensor.luxtronik25_vd2
            state: 'on'
        then:
        - alias: Status Heizung Haus 25 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus25-1.txt
            value: '<p>Quelle: <b>Erdsonde</b>  <span style="color:#FF6666;">B2</span></p>'
        else:
        - alias: Status Heizung Haus 25 (Wärmepumpe)
          action: shell_command.write_line_to_file
          data:
            mode: add
            file: /share/rotseepark.ch/haus25-1.txt
            value: '<p>Quelle: <b>Erdsonde</b></p>'
      else:
      - alias: Status Heizung Haus 25 (Wärmespeicher)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus25-1.txt
          value: '<p>Quelle: <b>Speicher</b></p>'
    - alias: Status Heizung Haus 25 (Vorlauf)
      action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus25-1.txt
        value: '<p>Vorlauf: <b>{{states(''sensor.luxtronik_25_m2f_degc'')}} °C</b></p>'
    else:
    - alias: Status Heizung Haus 25 (aus)
      action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/haus25-1.txt
        value: '<p>Heizung: <b>aus</b></p>'
  - alias: Status Heizung Haus 25 (Sonde)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus25-1.txt
      value: '<p>Sonde: <b>{{states(''sensor.sql_erdsonde_haus_25_temperature'')}}
        °C</b></p>'
  - alias: Status Brauchwasser Haus 25 (Generell ein/aus)
    if:
    - condition: state
      entity_id: binary_sensor.luxtronik25_bup
      state: 'on'
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add
        file: /share/rotseepark.ch/haus25-1.txt
        value: '<p>Warmwasser: <b>läuft</b></p>'
      alias: Status Warmwasser Haus 25 (läuft)
    else:
    - if:
      - condition: state
        entity_id: sensor.luxtronik25_hs3
        state: '9'
        alias: Status Warmwasser Haus 25 (Desinfektion)
      then:
      - alias: Status Warmwasser Haus 25 (Desinfektion)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus25-1.txt
          value: '<p>Warmwasser: <b>TDI</b></p>'
      else:
      - alias: Status Warmwasser Haus 25 (OK)
        action: shell_command.write_line_to_file
        data:
          mode: add
          file: /share/rotseepark.ch/haus25-1.txt
          value: '<p>Warmwasser: <b>OK</b></p>'
  mode: single
- id: '1762535932638'
  alias: Status Verbräuche der Häuser schreiben (Dashboard Kachel Verbräuche XX)
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '4'
    seconds: '50'
  - trigger: time_pattern
    minutes: '9'
    seconds: '50'
  - trigger: time_pattern
    minutes: '14'
    seconds: '50'
  - trigger: time_pattern
    minutes: '19'
    seconds: '50'
  - trigger: time_pattern
    minutes: '24'
    seconds: '50'
  - trigger: time_pattern
    minutes: '29'
    seconds: '50'
  - trigger: time_pattern
    minutes: '34'
    seconds: '50'
  - trigger: time_pattern
    minutes: '39'
    seconds: '50'
  - trigger: time_pattern
    minutes: '44'
    seconds: '50'
  - trigger: time_pattern
    minutes: '49'
    seconds: '50'
  - trigger: time_pattern
    minutes: '54'
    seconds: '50'
  - trigger: time_pattern
    minutes: '59'
    seconds: '50'
  conditions: []
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/haus19-2.txt
      value: '<p>Wärme: <b>{{ states(''sensor.sql_gwf_19_hz_kw_1day'')|int }} </b>kWh/d</p>'
    alias: Status Wärme Haus 19 (kWh/d)
  - alias: Status Wärme Haus 19 (kWh/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus19-2.txt
      value: '<p>Wärme: <b>{% set sensor_value = states(''sensor.gwf_19_hz_kw_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>kWh/h</p>'
  - alias: Status Wärme Haus 19 (l/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus19-2.txt
      value: '<p>Durchfluss: <b>{% set sensor_value = states(''sensor.gwf_19_hz_l_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>l/h</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus19-2.txt
      value: '<p>Warmwasser: <b>{{ states(''sensor.bwm19_gwf_ww_l_day'')|int }} l/d</b></p>'
    alias: Status Warmwasser Haus 19 (l/d)
  - alias: Status Kaltwasser Haus 19 (l/d)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus19-2.txt
      value: '<p>Kaltwasser: <b>{{ states(''sensor.bwm19_gwf_kw_l_day'')|int }} </b>l/d</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/haus21-2.txt
      value: '<p>Wärme: <b>{{ states(''sensor.sql_gwf_21_hz_kw_1day'')|int }} </b>kWh/d</p>'
    alias: Status Wärme Haus 21 (kWh/d)
  - alias: Status Wärme Haus 21 (kWh/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus21-2.txt
      value: '<p>Wärme: <b>{% set sensor_value = states(''sensor.gwf_21_hz_kw_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>kWh/h</p>'
  - alias: Status Wärme Haus 21 (l/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus21-2.txt
      value: '<p>Durchfluss: <b>{% set sensor_value = states(''sensor.gwf_21_hz_l_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>l/h</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus21-2.txt
      value: '<p>Warmwasser: <b>{{ states(''sensor.bwm21_gwf_ww_l_day'')|int }} </b>l/d</p>'
    alias: Status Warmwasser Haus 21 (l/d)
  - alias: Status Kaltwasser Haus 21 (l/d)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus21-2.txt
      value: '<p>Kaltwasser: <b>{{ states(''sensor.bwm21_gwf_kw_l_day'')|int }} </b>l/d</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/haus23-2.txt
      value: '<p>Wärme: <b>{{ states(''sensor.sql_gwf_23_hz_kw_1day'')|int }} </b>kWh/d</p>'
    alias: Status Wärme Haus 23 (kWh/d)
  - alias: Status Wärme Haus 23 (kWh/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus23-2.txt
      value: '<p>Wärme: <b>{% set sensor_value = states(''sensor.gwf_23_hz_kw_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>kWh/h</p>'
  - alias: Status Wärme Haus 23 (l/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus23-2.txt
      value: '<p>Durchfluss: <b>{% set sensor_value = states(''sensor.gwf_23_hz_l_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>l/h</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus23-2.txt
      value: '<p>Warmwasser: <b>{{ states(''sensor.bwm23_gwf_ww_l_day'')|int }} </b>l/d</p>'
    alias: Status Warmwasser Haus 23 (l/d)
  - alias: Status Kaltwasser Haus 23 (l/d)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus23-2.txt
      value: '<p>Kaltwasser: <b>{{ states(''sensor.bwm23_gwf_kw_l_day'')|int }} </b>l/d</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/haus25-2.txt
      value: '<p>Wärme: <b>{{ states(''sensor.sql_gwf_25_hz_kw_1day'')|int }} </b>kWh/d</p>'
    alias: Status Wärme Haus 25 (kWh/d)
  - alias: Status Wärme Haus 25 (kWh/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus25-2.txt
      value: '<p>Wärme: <b>{% set sensor_value = states(''sensor.gwf_25_hz_kw_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>kWh/h</p>'
  - alias: Status Wärme Haus 25 (l/h)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus25-2.txt
      value: '<p>Durchfluss: <b>{% set sensor_value = states(''sensor.gwf_25_hz_l_diff'')
        %}{{ sensor_value|float|int if sensor_value|float(default=None) is not none
        else ''NA'' }} </b>l/h</p>'
  - action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus25-2.txt
      value: '<p>Warmwasser: <b>{{ states(''sensor.bwm25_gwf_ww_l_day'')|int }} </b>l/d</p>'
    alias: Status Warmwasser Haus 25 (l/d)
  - alias: Status Kaltwasser Haus 25 (l/d)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/haus25-2.txt
      value: '<p>Kaltwasser: <b>{{ states(''sensor.bwm25_gwf_kw_l_day'')|int }} </b>l/d</p>'
  mode: single
- id: '1762538178062'
  alias: Status Solaranlage schreiben (Dashboard Kachel Solaranlage)
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '4'
    seconds: '50'
  - trigger: time_pattern
    minutes: '9'
    seconds: '50'
  - trigger: time_pattern
    minutes: '14'
    seconds: '50'
  - trigger: time_pattern
    minutes: '19'
    seconds: '50'
  - trigger: time_pattern
    minutes: '24'
    seconds: '50'
  - trigger: time_pattern
    minutes: '29'
    seconds: '50'
  - trigger: time_pattern
    minutes: '34'
    seconds: '50'
  - trigger: time_pattern
    minutes: '39'
    seconds: '50'
  - trigger: time_pattern
    minutes: '44'
    seconds: '50'
  - trigger: time_pattern
    minutes: '49'
    seconds: '50'
  - trigger: time_pattern
    minutes: '54'
    seconds: '50'
  - trigger: time_pattern
    minutes: '59'
    seconds: '50'
  conditions: []
  actions:
  - alias: Überschuss Prüfung
    if:
    - condition: numeric_state
      entity_id: sensor.energy_statistic_janitza_umg604_w_30_min
      below: 0
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/allgemein-1.txt
        value: '<p>Überschuss: <b>ein</b></p>'
      alias: Status Überschuss (ein)
    else:
    - action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/allgemein-1.txt
        value: '<p>Überschuss: <b>aus</b></p>'
      alias: Status Überschuss (aus)
  - alias: Status Produktion (kWh)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-1.txt
      value: '<p>Jetzt: <b>{{ (states(''sensor.energy_statistic_solar_w'')|int/1000)|round(1)
        }} kWh</b></p>'
  - alias: Status Tageswert (kWh)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-1.txt
      value: '<p>Tag: <b>{{ (states(''sensor.solar_yield_19_day'')|int + states(''sensor.solar_yield_21_day'')|int
        + states(''sensor.solar_yield_23_day'')|int + states(''sensor.solar_yield_25_day'')|int
        ) }} kWh</b></p>'
  - alias: Status Monatswert (kWh)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-1.txt
      value: '<p>Monat: <b>{{ (states(''sensor.solar_yield_19_month'')|int + states(''sensor.solar_yield_21_month'')|int
        + states(''sensor.solar_yield_23_month'')|int + states(''sensor.solar_yield_25_month'')|int
        ) }} kWh</b></p>'
  - alias: Status Jahreswert (MWh)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-1.txt
      value: '<p>Jahr: <b>{{ (((states(''sensor.solar_yield_19_year'')|int + states(''sensor.solar_yield_21_year'')|int
        + states(''sensor.solar_yield_23_year'')|int + states(''sensor.solar_yield_25_year'')|int
        ) / 100)|int)/10 }} MWh</b></p>'
  mode: single
- id: '1762539063814'
  alias: Status Allgemein schreiben (Dashboard Kachel Allgemein)
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '4'
    seconds: '50'
  - trigger: time_pattern
    minutes: '9'
    seconds: '50'
  - trigger: time_pattern
    minutes: '14'
    seconds: '50'
  - trigger: time_pattern
    minutes: '19'
    seconds: '50'
  - trigger: time_pattern
    minutes: '24'
    seconds: '50'
  - trigger: time_pattern
    minutes: '29'
    seconds: '50'
  - trigger: time_pattern
    minutes: '34'
    seconds: '50'
  - trigger: time_pattern
    minutes: '39'
    seconds: '50'
  - trigger: time_pattern
    minutes: '44'
    seconds: '50'
  - trigger: time_pattern
    minutes: '49'
    seconds: '50'
  - trigger: time_pattern
    minutes: '54'
    seconds: '50'
  - trigger: time_pattern
    minutes: '59'
    seconds: '50'
  conditions: []
  actions:
  - alias: Status Temperatur (°C)
    action: shell_command.write_line_to_file
    data:
      mode: new
      file: /share/rotseepark.ch/allgemein-2.txt
      value: '<p>Temperatur: <b>{{ (((states(''sensor.luxtronik19_ta'')|float + states(''sensor.luxtronik21_ta'')|float
        + states(''sensor.luxtronik23_ta'')|float + states(''sensor.luxtronik25_ta'')|float
        )/4*10)|int)/10 }} °C</b></p>'
  - alias: Status Temperatur Mittel (°C)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-2.txt
      value: '<p>Mittel 24h: <b>{{ (((states(''sensor.luxtronik19_ta_mittel'')|float
        + states(''sensor.luxtronik21_ta_mittel'')|float + states(''sensor.luxtronik23_ta_mittel'')|float
        + states(''sensor.luxtronik25_ta_mittel'')|float )/4*10)|int)/10 }} °C</b></p>'
  - alias: Status Aktualisiert (TT.MM.YYY HH:MI)
    action: shell_command.write_line_to_file
    data:
      mode: add
      file: /share/rotseepark.ch/allgemein-2.txt
      value: <p>Aktualisiert am</p><p>{{ now().strftime('%d.%m.%Y %H:%M') }}</p>
  mode: single
- id: '1762546047000'
  alias: Status Bilanz schreiben
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '*'
    id: Stunde
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '5'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '10'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '15'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '20'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '25'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '30'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '35'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '40'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '45'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '50'
  - trigger: time_pattern
    hours: '*'
    id: Dazwischen
    minutes: '55'
  conditions: []
  actions:
  - variables:
      datum: '{{ now().strftime(''%d.%m.%y'') }}'
  - variables:
      zeit: '{{ now().strftime(''%H:%M'') }}'
  - variables:
      Sonnenstrom: '{{states(''sensor.solar_power_production'') | float | round(1)
        }}'
  - variables:
      Verbrauch: '0'
  - variables:
      Eigenverbrauch: '0'
  - variables:
      Wohnungen: '{{ states(''sensor.hauser_power_consumption'') | float | round(1)
        }}'
  - variables:
      Allgemein: '{{ states(''sensor.allgemein_power_consumption'') | float | round(1)
        }}'
  - variables:
      Lüftung: '{{ states(''sensor.gplug_haus_21_luftung_power_consumption'') | float
        | round(1) }}'
  - variables:
      Cooling: '{{ states(''sensor.heatpump_co_power_consumption'') | float | round(1)
        }}'
  - variables:
      Warmwasser: '{{ states(''sensor.heatpump_ww_power_consumption'') | float | round(1)
        }}'
  - variables:
      Heizung: '{{ states(''sensor.heatpump_hz_power_consumption'') | float | round(1)
        }}'
  - variables:
      eMobilität: '{{ states(''sensor.emobilitat_power_consumption'') | float | round(1)
        }}'
  - variables:
      Secomat: '{{ states(''sensor.shelly_secomat_power_consumption'') | float | round(1)
        }}'
  - if:
    - condition: template
      value_template: '{{ trigger.id  == "Stunde" }}'
    then:
    - alias: Verbrauchswerte (kummulativ stündlich)
      action: shell_command.write_line_to_file
      data:
        mode: add-bilanz
        file: /share/rotseepark.ch/bilanz.csv
        value: '{{ datum }};{{ zeit }};{{ Sonnenstrom }};{{ Verbrauch }};{{ Eigenverbrauch
          }};{{ Wohnungen }};{{ Allgemein }};{{ Lüftung }};{{ Cooling }};{{ Warmwasser
          }};{{ Heizung }};{{ eMobilität }};{{ Secomat }}'
    - alias: Verbrauchswerte (kummulativ aktuell)
      action: shell_command.write_line_to_file
      data:
        mode: empty
        file: /share/rotseepark.ch/bilanz.new.csv
        value: ''
    else:
    - alias: Verbrauchswerte (kummulativ aktuell)
      action: shell_command.write_line_to_file
      data:
        mode: new
        file: /share/rotseepark.ch/bilanz.new.csv
        value: '{{ datum }};{{ zeit }};{{ Sonnenstrom }};{{ Verbrauch }};{{ Eigenverbrauch
          }};{{ Wohnungen }};{{ Allgemein }};{{ Lüftung }};{{ Cooling }};{{ Warmwasser
          }};{{ Heizung }};{{ eMobilität }};{{ Secomat }}'
  mode: single
- id: '1762604612037'
  alias: Status Umgebung Strom schreiben (23:00 Uhr Überwachung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '23'
  conditions:
  - condition: numeric_state
    entity_id: sensor.gplug_haus_21_umgebung_power
    below: 300
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Umgebung: Unregelmässigkeit
        Stromverbrauch Umgebung (Verbrauch zu tief)'
  mode: single
- id: '1762604801319'
  alias: Status Lüftung Strom schreiben (02:00 Uhr Überwachung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '2'
  conditions:
  - condition: numeric_state
    entity_id: sensor.gplug_haus_21_luftung_power
    below: 1000
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};W;Lüftung: Unregelmässigkeit
        Stromverbrauch Lüftung (Verbrauch zu tief)'
  mode: single
- id: '1762605295869'
  alias: Status Solaranlage Strom schreiben (12:00 Uhr Überwachung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '12'
  conditions: []
  actions:
  - alias: Prüfe Produktion Solaranlage Haus 19
    choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_19_solaranlage_w
        below: 1
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};E;Haus 19: Störung Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_19_solaranlage_w'')
            }} W] möglicher Defekt'
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_19_solaranlage_w
        below: 500
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};W;Haus 19: Geringe Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_19_solaranlage_w'')
            }} W] Bewölkung oder Schnee'
  - alias: Prüfe Produktion Solaranlage Haus 21
    choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_21_solaranlage_w
        below: 1
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};E;Haus 21: Störung Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_21_solaranlage_w'')
            }} W] möglicher Defekt'
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_21_solaranlage_w
        below: 500
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};W;Haus 21: Geringe Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_21_solaranlage_w'')
            }} W] Bewölkung oder Schnee'
  - alias: Prüfe Produktion Solaranlage Haus 23
    choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_23_solaranlage_w
        below: 1
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};E;Haus 23: Störung Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_23_solaranlage_w'')
            }} W] möglicher Defekt'
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_23_solaranlage_w
        below: 500
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};W;Haus 23: Geringe Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_23_solaranlage_w'')
            }} W] Bewölkung oder Schnee'
  - alias: Prüfe Produktion Solaranlage Haus 25
    choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_25_solaranlage_w
        below: 1
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};E;Haus 25: Störung Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_25_solaranlage_w'')
            }} W] möglicher Defekt'
    - conditions:
      - condition: numeric_state
        entity_id: sensor.energy_statistic_gplug_haus_25_solaranlage_w
        below: 500
      sequence:
      - action: shell_command.write_line_to_file
        data:
          mode: add-top100
          file: /share/rotseepark.ch/betriebsmeldungen.txt
          value: '{{ now().strftime(''%d.%m.%Y;%H:%M'') }};W;Haus 25: Geringe Solar
            Produktion  [{{ states(''sensor.energy_statistic_gplug_haus_25_solaranlage_w'')
            }} W] Bewölkung oder Schnee'
  mode: single
- id: '1762671360204'
  alias: Add E-Mail Body to Gebäudemeldung
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_text.email_body_gebaudemeldung
  conditions: []
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/gebaudemeldungen.txt
      value: '{{ states(''input_text.email_body_gebaudemeldung'')|replace(''&#x3A;'','':'')|replace(''&#x2F;'',''/'')|replace(''&#x3F;'',''?'')|replace(''&#x3D;'',''='')|replace(''&#x5B;'',''['')|replace(''&#x2C;'','','')|replace(''&#x5D;'','']'')|replace(''&#x26;'',''&'')|replace(''&lt;'',''<'')|replace(''&gt;'',''>'')
        }}'
  mode: single
- id: '1762674098312'
  alias: Add E-Mail Body to Betriebsmeldung
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_text.email_body_betriebsmeldung
  conditions: []
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{ states(''input_text.email_body_betriebsmeldung'')|replace(''&#x3A;'','':'')|replace(''&#x2F;'',''/'')|replace(''&#x3F;'',''?'')|replace(''&#x3D;'',''='')|replace(''&#x5B;'',''['')|replace(''&#x2C;'','','')|replace(''&#x5D;'','']'')|replace(''&#x26;'',''&'')|replace(''&lt;'',''<'')|replace(''&gt;'',''>'')
        }}'
  mode: single
- id: '1762764268306'
  alias: Status Solaranlage Forecast schreiben (09:00 Statusmitteilung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '9'
  conditions: []
  actions:
  - if:
    - condition: numeric_state
      entity_id: sensor.forecast_solar_production_today_remaining
      above: 300
    then:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Solaranlage: Heute wird
          {{ states(''sensor.forecast_solar_production_today_remaining'') }} kWh Sonnenstrom
          prognostiziert. (Überschuss wahrscheinlich)'
    else:
    - action: shell_command.write_line_to_file
      data:
        mode: add-top100
        file: /share/rotseepark.ch/betriebsmeldungen.txt
        value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Solaranlage: Heute wird
          {{ states(''sensor.forecast_solar_production_today_remaining'') }} kWh Sonnenstrom
          prognostiziert (Überschuss unwahrscheinlich)'
  mode: single
- id: '1762854173270'
  alias: Status Warmwasser und Kaltwasser Verbrauch schreiben (23:59 Statusmitteilung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '23'
    minutes: '59'
  conditions: []
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Warmwasser: Tagesverbrauch
        19: {{ states(''sensor.bwm19_gwf_ww_l_day'')|int}} l - 21: {{ states(''sensor.bwm21_gwf_ww_l_day'')|int}}
        l - 23: {{ states(''sensor.bwm23_gwf_ww_l_day'')|int}} l - 25: {{ states(''sensor.bwm25_gwf_ww_l_day'')|int}}
        l '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Kaltwasser: Tagesverbrauch
        19: {{ states(''sensor.bwm19_gwf_kw_l_day'')|int}} l - 21: {{ states(''sensor.bwm21_gwf_kw_l_day'')|int}}
        l - 23: {{ states(''sensor.bwm23_gwf_kw_l_day'')|int}} l - 25: {{ states(''sensor.bwm25_gwf_kw_l_day'')|int}}
        l '
  mode: single
- id: '1762928780711'
  alias: Status Solaranlage Produktion schreiben (22:00 Statusmitteilung)
  description: ''
  triggers:
  - trigger: time_pattern
    hours: '22'
  conditions: []
  actions:
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Solaranlage: Tagesproduktion
        19: {{ states(''sensor.solar_yield_19_day'')|int}} kWh - 21: {{ states(''sensor.solar_yield_21_day'')|int}}
        kWh - 23: {{ states(''sensor.solar_yield_23_day'')|int}} kWh - 25: {{ states(''sensor.solar_yield_25_day'')|int}}
        kWh'
  mode: single
- id: '1764109112883'
  alias: Speichere Strom Sensoren jede Minute einmal
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: /1
    id: minute
  - trigger: homeassistant
    event: start
    id: start
  - trigger: homeassistant
    event: shutdown
    id: stop
  conditions: []
  actions:
  - alias: Minute Hauser Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.hauser_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.hauser_power_consumption'') }}'
      target:
        entity_id: input_text.minute_hauser_power_value
  - alias: Minute Allgemein Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.allgemein_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.allgemein_power_consumption'') }}'
      target:
        entity_id: input_text.minute_allgemein_power_value
  - alias: Minute Luftung Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.gplug_haus_21_luftung_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.gplug_haus_21_luftung_power_consumption'') }}'
      target:
        entity_id: input_text.minute_luftung_power_value
  - alias: Minute Cooling Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.heatpump_co_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.heatpump_co_power_consumption'') }}'
      target:
        entity_id: input_text.minute_cooling_power_value
  - alias: Minute Warmwasser Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.heatpump_ww_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.heatpump_ww_power_consumption'') }}'
      target:
        entity_id: input_text.minute_warmwasser_power_value
  - alias: Minute Heizung Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.heatpump_hz_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.heatpump_hz_power_consumption'') }}'
      target:
        entity_id: input_text.minute_heizung_power_value
  - alias: Minute eMobilität Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.emobilitat_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.emobilitat_power_consumption'') }}'
      target:
        entity_id: input_text.minute_emobilitat_power_value
  - alias: Minute Secomat Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.shelly_secomat_power_consumption'')
        %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.shelly_secomat_power_consumption'') }}'
      target:
        entity_id: input_text.minute_secomat_power_value
  - alias: Minute Solar Power Value
    if:
    - condition: template
      value_template: '{% set value = states(''sensor.solar_power_production'') %}

        {{ value | float(default=none) != none and value | float(0) > 0}}'
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: '{{ states(''sensor.solar_power_production'') }}'
      target:
        entity_id: input_text.minute_solar_power_value
  mode: single
- id: '1764487826767'
  alias: Schalte HZ - Setze HZ Hysterese Haus 19 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_19_hz_hysterese
    trigger: state
  conditions: []
  actions:
  - variables:
      haus: 19
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''returnTemperatureHysteresis'']
            != states(''input_number.luxtronik_19_hz_hysterese'')|float) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - alias: Führe Script zur Schaltung Heizung Hysterese aus
        continue_on_error: true
        action: script.schalte_heizung_hysterese
        data:
          heatpump: 19
          value: '{{ states(''input_number.luxtronik_19_hz_hysterese'')|float }}'
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole maximal 3 mal, bis Parameter Heizung Hysterese gesetzt werden
      konnte
  - alias: Sende eine Benachrichtigung, wenn die Heizung Hysterese nicht gesetzt werden
      konnte
    if:
    - condition: template
      alias: NOT Parameter Heizung Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_19_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        != states(''input_number.luxtronik_19_hz_hysterese'')|float) }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_hz_hysterese'')|float}}

          Heizung Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus {{ haus }}: HZ Hysterese
        wurde auf {{ state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: queued
  trace:
    stored_traces: 10
  max: 10
- id: '1764489473903'
  alias: Schalte HZ - Setze HZ Hysterese Haus 21 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_21_hz_hysterese
    trigger: state
  conditions: []
  actions:
  - variables:
      haus: 21
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''returnTemperatureHysteresis'']
            != states(''input_number.luxtronik_21_hz_hysterese'')|float) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - alias: Führe Script zur Schaltung Heizung Hysterese aus
        continue_on_error: true
        action: script.schalte_heizung_hysterese
        data:
          heatpump: 21
          value: '{{ states(''input_number.luxtronik_21_hz_hysterese'')|float }}'
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole maximal 3 mal, bis Parameter Heizung Hysterese gesetzt werden
      konnte
  - alias: Sende eine Benachrichtigung, wenn die Heizung Hysterese nicht gesetzt werden
      konnte
    if:
    - condition: template
      alias: NOT Parameter Heizung Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_21_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        != states(''input_number.luxtronik_21_hz_hysterese'')|float) }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_hz_hysterese'')|float}}

          Heizung Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus {{ haus }}: HZ Hysterese
        wurde auf {{ state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: queued
  trace:
    stored_traces: 10
  max: 10
- id: '1764489516970'
  alias: Schalte HZ - Setze HZ Hysterese Haus 23 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_23_hz_hysterese
    trigger: state
  conditions: []
  actions:
  - variables:
      haus: 23
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''returnTemperatureHysteresis'']
            != states(''input_number.luxtronik_23_hz_hysterese'')|float) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - alias: Führe Script zur Schaltung Heizung Hysterese aus
        continue_on_error: true
        action: script.schalte_heizung_hysterese
        data:
          heatpump: 23
          value: '{{ states(''input_number.luxtronik_23_hz_hysterese'')|float }}'
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole maximal 3 mal, bis Parameter Heizung Hysterese gesetzt werden
      konnte
  - alias: Sende eine Benachrichtigung, wenn die Heizung Hysterese nicht gesetzt werden
      konnte
    if:
    - condition: template
      alias: NOT Parameter Heizung Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_23_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        != states(''input_number.luxtronik_23_hz_hysterese'')|float) }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_hz_hysterese'')|float}}

          Heizung Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus {{ haus }}: HZ Hysterese
        wurde auf {{ state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: queued
  trace:
    stored_traces: 10
  max: 10
- id: '1764489552152'
  alias: Schalte HZ - Setze HZ Hysterese Haus 25 (bei Änderung)
  description: ''
  triggers:
  - entity_id:
    - input_number.luxtronik_25_hz_hysterese
    trigger: state
  conditions: []
  actions:
  - variables:
      haus: 25
  - repeat:
      while:
      - condition: and
        conditions:
        - condition: template
          alias: NOT Parameter Heizung Hysterese gesetzt
          value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''returnTemperatureHysteresis'']
            != states(''input_number.luxtronik_25_hz_hysterese'')|float) }}'
        - condition: template
          value_template: '{{ (repeat.index < 3) }}'
      sequence:
      - alias: Führe Script zur Schaltung Heizung Hysterese aus
        continue_on_error: true
        action: script.schalte_heizung_hysterese
        data:
          heatpump: 25
          value: '{{ states(''input_number.luxtronik_25_hz_hysterese'')|float }}'
      - delay:
          hours: 0
          minutes: 2
          seconds: 30
          milliseconds: 0
    alias: Wiederhole maximal 3 mal, bis Parameter Heizung Hysterese gesetzt werden
      konnte
  - alias: Sende eine Benachrichtigung, wenn die Heizung Hysterese nicht gesetzt werden
      konnte
    if:
    - condition: template
      alias: NOT Parameter Heizung Hysterese gesetzt
      value_template: '{{ (state_attr(''sensor.luxtronik_25_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        != states(''input_number.luxtronik_25_hz_hysterese'')|float) }}'
    then:
    - action: script.send_a_notification_to_administrator_rotseepark
      data:
        title: 'HA-Alert Rotseepark - WW Haus {{ haus }} Warmwasser Hysterese nicht
          gesetzt

          '
        message: 'Warmwasser Hysterese Soll:  {{states(''input_number.luxtronik_''
          ~ haus ~ ''_hz_hysterese'')|float}}

          Heizung Hysterese Ist :  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']}}

          Zeitpunkt: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''rawDeviceTimeCalc'']}}

          Status Standard: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_state_string'']}}

          Status Extended: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_value_state'',''values'')[''heatpump_extendet_state_string'']}}

          Heizung Operation Modus: {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode'']}}
          /  {{state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''heating_operation_mode_string'']}}

          '
  - action: shell_command.write_line_to_file
    data:
      mode: add-top100
      file: /share/rotseepark.ch/betriebsmeldungen.txt
      value: '{{  now().strftime(''%d.%m.%Y;%H:%M'')  }};I;Haus {{ haus }}: HZ Hysterese
        wurde auf {{ state_attr(''sensor.luxtronik_'' ~ haus ~ ''_param_state'',''parameters'')[''returnTemperatureHysteresis'']
        }} °C gestellt <div style="display: none">technical</div>'
  mode: queued
  trace:
    stored_traces: 10
  max: 10
