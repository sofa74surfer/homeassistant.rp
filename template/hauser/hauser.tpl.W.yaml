# ####### ####################### #######
# ####### Wattage Sensoren Häuser #######
# ####### ####################### #######

# Die Häuser verbrauchen
# - Den Strom, der von UMG604 gemessen wird (Netzbezug)
# + Solarstrom (4*)
# - Allgemeinstrom (4*)
# - Wärmepumpe (4*)
# - Einstellhalle (Haus 21)
# - Umgebung (Haus 21)
# - Lüftung (Haus 21)
# - Schutzräume (Haus 21)
# - Elektromobilität (Haus 25)
# - Brandanlage (Haus 25)

- sensor:
    - name: "Häuser Power"
      state: "{{ (0
               + (0 if states('sensor.janitza_umg604_power') == 'unknown' 
                    or states('sensor.janitza_umg604_power') == 'unavailable'
                    else states('sensor.janitza_umg604_power')|float) 
               + (0 if states('sensor.gplug_haus_19_solaranlage_production') == 'unknown' 
                    or states('sensor.gplug_haus_19_solaranlage_production') == 'unavailable'
                    else states('sensor.gplug_haus_19_solaranlage_production')|float) 
               - (0 if states('sensor.gplug_haus_19_allgemein_power') == 'unknown' 
                    or states('sensor.gplug_haus_19_allgemein_power') == 'unavailable'
                    else states('sensor.gplug_haus_19_allgemein_power')|float) 
               - (0 if states('sensor.gplug_haus_19_warmepumpe_power') == 'unknown' 
                    or states('sensor.gplug_haus_19_warmepumpe_power') == 'unavailable'
                    else states('sensor.gplug_haus_19_warmepumpe_power')|float) 
               + (0 if states('sensor.gplug_haus_21_solaranlage_production') == 'unknown' 
                    or states('sensor.gplug_haus_21_solaranlage_production') == 'unavailable'
                    else states('sensor.gplug_haus_21_solaranlage_production')|float) 
               - (0 if states('sensor.gplug_haus_21_allgemein_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_allgemein_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_allgemein_power')|float) 
               - (0 if states('sensor.gplug_haus_21_warmepumpe_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_warmepumpe_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_warmepumpe_power')|float) 
               - (0 if states('sensor.gplug_haus_21_einstellhalle_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_einstellhalle_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_einstellhalle_power')|float) 
               - (0 if states('sensor.gplug_haus_21_umgebung_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_umgebung_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_umgebung_power')|float) 
               - (0 if states('sensor.gplug_haus_21_luftung_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_luftung_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_luftung_power')|float) 
               - (0 if states('sensor.gplug_haus_21_schutzraume_power') == 'unknown' 
                    or states('sensor.gplug_haus_21_schutzraume_power') == 'unavailable'
                    else states('sensor.gplug_haus_21_schutzraume_power')|float) 
               + (0 if states('sensor.gplug_haus_23_solaranlage_production') == 'unknown' 
                    or states('sensor.gplug_haus_23_solaranlage_production') == 'unavailable'
                    else states('sensor.gplug_haus_23_solaranlage_production')|float) 
               - (0 if states('sensor.gplug_haus_23_allgemein_power') == 'unknown' 
                    or states('sensor.gplug_haus_23_allgemein_power') == 'unavailable'
                    else states('sensor.gplug_haus_23_allgemein_power')|float) 
               - (0 if states('sensor.gplug_haus_23_warmepumpe_power') == 'unknown' 
                    or states('sensor.gplug_haus_23_warmepumpe_power') == 'unavailable'
                    else states('sensor.gplug_haus_23_warmepumpe_power')|float) 
               + (0 if states('sensor.gplug_haus_25_solaranlage_production') == 'unknown' 
                    or states('sensor.gplug_haus_25_solaranlage_production') == 'unavailable'
                    else states('sensor.gplug_haus_25_solaranlage_production')|float) 
               - (0 if states('sensor.gplug_haus_25_allgemein_power') == 'unknown' 
                    or states('sensor.gplug_haus_25_allgemein_power') == 'unavailable'
                    else states('sensor.gplug_haus_25_allgemein_power')|float) 
               - (0 if states('sensor.gplug_haus_25_warmepumpe_power') == 'unknown' 
                    or states('sensor.gplug_haus_25_warmepumpe_power') == 'unavailable'
                    else states('sensor.gplug_haus_25_warmepumpe_power')|float) 
               - (0 if states('sensor.gplug_haus_25_brandanlage_power') == 'unknown' 
                    or states('sensor.gplug_haus_25_brandanlage_power') == 'unavailable'
                    else states('sensor.gplug_haus_25_brandanlage_power')|float) 
               - (0 if states('sensor.gplug_haus_25_elektromobilitat_power') == 'unknown' 
                    or states('sensor.gplug_haus_25_elektromobilitat_power') == 'unavailable'
                    else states('sensor.gplug_haus_25_elektromobilitat_power')|float) 
          )|round(0) }}"
      device_class: power
      unit_of_measurement: "W"
      unique_id: template.sensor_hauser_power
