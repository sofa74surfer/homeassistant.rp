# ####### Wattage Sensoren Solar Produktion #######
# ####### Wattage Sensoren Solar Eigenverbrauch #######
# ####### Wattage Sensoren Solar Heizung nach Betriebsart #######

# ####### ################################# #######
# ####### Wattage Sensoren Solar Produktion #######
# ####### ################################# #######

- sensor:

  # Solar Produktion
    - name: "Solar Power 25"
      # friendly_name: "Solar Power 25 W"
      unique_id: template.sensor_solar_power_25
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ 0 if states('sensor.solarlog_25_power_ac') == 'unknown' 
           or states('sensor.solarlog_25_power_ac') == 'unavailable' 
           else states('sensor.solarlog_25_power_ac')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Produktion Tag
    - name: "Solar Yield 25 Day"
      # friendly_name: "Solar Yield 25 Day kWh"
      unique_id: template.sensor_solar_yield_25_day
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_yield_day') == 'unknown' 
           or states('sensor.solarlog_25_yield_day') == 'unavailable' 
           else states('sensor.solarlog_25_yield_day')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Produktion Vortag
    - name: "Solar Yield 25 Yesterday"
      # friendly_name: "Solar Yield 25 Yesterday kWh"
      unique_id: template.sensor_solar_yield_25_yesterday
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_yield_yesterday') == 'unknown' 
           or states('sensor.solarlog_25_yield_yesterday') == 'unavailable' 
           else states('sensor.solarlog_25_yield_yesterday')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Produktion Monat
    - name: "Solar Yield 25 Month"
      # friendly_name: "Solar Yield 25 Month kWh"
      unique_id: template.sensor_solar_yield_25_month
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_yield_month') == 'unknown' 
           or states('sensor.solarlog_25_yield_month') == 'unavailable'
           else states('sensor.solarlog_25_yield_month')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Produktion Jahr
    - name: "Solar Yield 25 Year"
      # friendly_name: "Solar Yield 25 Year kWh"
      unique_id: template.sensor_solar_yield_25_year
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_yield_year') == 'unknown' 
           or states('sensor.solarlog_25_yield_year') == 'unavailable'
           else states('sensor.solarlog_25_yield_year')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

# Wattage Sensoren Solar Eigenverbrauch
# ####### ##################################### #######
# ####### Wattage Sensoren Solar Eigenverbrauch #######
# ####### ##################################### #######
  # Solar Eigenverbrauch
    - name: "Solar Consumption 25"
      # friendly_name: "Solar Consumption 25 W"
      unique_id: template.sensor_solar_consumption_25
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ 0 if states('sensor.solarlog_25_consumption_ac') == 'unknown' 
           or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
           else states('sensor.solarlog_25_consumption_ac')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Eigenverbrauch Tag
    - name: "Solar Consumption 25 Day"
      # friendly_name: "Solar Consumption 25 Day kWh"
      unique_id: template.sensor_solar_consumption_25_day
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_consumption_day') == 'unknown' 
           or states('sensor.solarlog_25_consumption_day') == 'unavailable'
           else states('sensor.solarlog_25_consumption_day')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Eigenverbrauch Vortag
    - name: "Solar Consumption 25 Yesterday"
      # friendly_name: "Solar Consumption 25 Yesterday kWh"
      unique_id: template.sensor_solar_consumption_25_yesterday
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_consumption_yesterday') == 'unknown' 
           or states('sensor.solarlog_25_consumption_yesterday') == 'unavailable'
           else states('sensor.solarlog_25_consumption_yesterday')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Eigenverbrauch Monat
    - name: "Solar Consumption 25 Month"
      # friendly_name: "Solar Consumption 25 Month kWh"
      unique_id: template.sensor_solar_consumption_25_month
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_consumption_month') == 'unknown' 
           or states('sensor.solarlog_25_consumption_month') == 'unavailable'
           else states('sensor.solarlog_25_consumption_month')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Solar Eigenverbrauch Jahr
    - name: "Solar Consumption 25 Year"
      # friendly_name: "Solar Consumption 25 Year kWh"
      unique_id: template.sensor_solar_consumption_25_year
      device_class: power
      unit_of_measurement: "kWh"
      state: >
        {{ 0 if states('sensor.solarlog_25_consumption_year') == 'unknown' 
           or states('sensor.solarlog_25_consumption_year') == 'unavailable'
           else states('sensor.solarlog_25_consumption_year')|float|round(0)
        }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

# Wattage Sensoren Solar Heizung nach Betriebsart
  # Warmwasserbetrieb
    - name: "Solar Consumption 25 Ww"
      # friendly_name: "Solar Consumption 25 WW W"
      unique_id: template.sensor_solar_consumption_25_ww
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ ((
          (0 if states('sensor.solar_consumption_25_ww_wp') == 'unknown' 
             or states('sensor.solar_consumption_25_ww_wp') == 'unavailable'
             else states('sensor.solar_consumption_25_ww_wp')|float) +
          (0 if states('sensor.solar_consumption_25_ww_el') == 'unknown' 
             or states('sensor.solar_consumption_25_ww_el') == 'unavailable'
             else states('sensor.solar_consumption_25_ww_el')|float) 
        ))|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Warmwasserbetrieb Wärmepumpe
    - name: "Solar Consumption 25 Ww Wp"
      # friendly_name: "Solar Consumption 25 WW WP W"
      unique_id: template.sensor_solar_consumption_25_ww_wp
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ (0
        if states('sensor.luxtronik25_bz') == 'unknown' 
        or states('sensor.luxtronik25_bz') == 'unavailable'
        or states('sensor.solarlog_25_consumption_ac') == 'unknown' 
        or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
        else (states('sensor.solarlog_25_consumption_ac') 
              if states('sensor.luxtronik25_bz')|int == 1 
              and (   states('sensor.luxtronik25_hs3')|int == 5 
                   or states('sensor.luxtronik25_hs3')|int == 9
                  )
              else 0)
        )|float|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Warmwasserbetrieb Elektro
    - name: "Solar Consumption 25 Ww El"
      # friendly_name: "Solar Consumption 25 WW EL W"
      unique_id: template.sensor_solar_consumption_25_ww_el
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ (0
        if states('sensor.luxtronik25_bz') == 'unknown' 
        or states('sensor.luxtronik25_bz') == 'unavailable'
        or states('sensor.solarlog_25_consumption_ac') == 'unknown' 
        or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
        else (states('sensor.solarlog_25_consumption_ac') 
              if   states('sensor.luxtronik25_bz')|int == 5 
              and (        states('sensor.luxtronik25_hs3')|int == 9 
                   or (    states('sensor.luxtronik25_hs3')|int == 10 
                       and states('binary_sensor.luxtronik25_zw2sst') == 'on'
                      )
                  )
              and states('sensor.solarlog_25_consumption_ac')|int >= 15000
              else 0)
        )|float|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Standbybetrieb
    - name: "Solar Consumption 25 Standby"
      # friendly_name: "Solar Consumption 25 Standby W"
      unique_id: template.sensor_solar_consumption_25_standby
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ (0
        if states('sensor.luxtronik25_bz') == 'unknown' 
        or states('sensor.luxtronik25_bz') == 'unavailable'
        or states('sensor.solarlog_25_consumption_ac') == 'unknown' 
        or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
        else (states('sensor.solarlog_25_consumption_ac') 
              if states('sensor.luxtronik25_bz')|int != 0 
              and states('sensor.luxtronik25_bz')|int != 1 
              and states('sensor.luxtronik25_hs3')|int != 9
              and states('sensor.solarlog_25_consumption_ac')|int <= 250
              else 0)
        )|float|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Heizbetrieb
    - name: "Solar Consumption 25 Hz"
      # friendly_name: "Solar Consumption 25 HZ W"
      unique_id: template.sensor_solar_consumption_25_hz
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ (0
        if states('sensor.luxtronik25_bz') == 'unknown' 
        or states('sensor.luxtronik25_bz') == 'unavailable'
        or states('sensor.solarlog_25_consumption_ac') == 'unknown' 
        or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
        else (states('sensor.solarlog_25_consumption_ac') 
              if states('sensor.luxtronik25_bz')|int == 0 
              and states('input_boolean.luxtronik_heizphase_haus_25')
              else 0)
        )|float|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"

  # Kühlbetrieb
    - name: "Solar Consumption 25 Co"
      # friendly_name: "Solar Consumption 25 CO W"
      unique_id: template.sensor_solar_consumption_25_co
      device_class: power
      unit_of_measurement: "W"
      state: >
        {{ (0 
        if states('sensor.luxtronik25_bz') == 'unknown' 
        or states('sensor.luxtronik25_bz') == 'unavailable'
        or states('sensor.solarlog_25_consumption_ac') == 'unknown' 
        or states('sensor.solarlog_25_consumption_ac') == 'unavailable'
        else (states('sensor.solarlog_25_consumption_ac') 
              if  states('sensor.luxtronik25_bz')|int == 5 
              and states('input_boolean.luxtronik_kuhlphase_haus_25')
              and states('sensor.luxtronik25_hs3')|int == 10 
              and (    states('binary_sensor.luxtronik25_zw2sst') == 'off'
                   or (    states('binary_sensor.luxtronik25_zw2sst') == 'on'
                       and states('sensor.solarlog_25_consumption_ac')|int <= 1000
                      )
                  )
              else 0)
        )|float|round(0) }}
      attributes:
        last_updated: "{{ now().strftime('%d.%m.%Y %H:%M') }}"
